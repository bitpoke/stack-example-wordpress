(function(e){var d={},c={},f,g,a,b;f=function(){var h=g.inputs[g.mode];if(!h){return}if(g.editors[g.mode]){g.editors[g.mode].save()}e.post(ajaxurl,{action:"debug_bar_console",mode:g.mode,data:h.val(),nonce:b},a.render);return false};a={data:"",mode:"formatted",render:function(i){var h;if(arguments.length){a.data=i}else{i=a.data}if(a.mode==="formatted"){c.body.text(i);h=c.body.html();h=h.replace(/ /g,"&nbsp;").replace(/[\r\n]+/g,"<br />");c.body.html(h)}else{c.body.html(i)}},refresh:function(){return a.render()}};g={mode:"php",tabs:{},inputs:{},change:function(h){if(h==g.mode){return}if(g.tabs[g.mode]){g.tabs[g.mode].removeClass("debug-bar-console-tab-active")}d.form.removeClass("debug-bar-console-mode-"+g.mode);d.form.addClass("debug-bar-console-mode-"+h);g.mode=h;if(g.tabs[g.mode]){g.tabs[g.mode].addClass("debug-bar-console-tab-active")}g.maybeInitEditor()},editors:{},codemirror:{modes:{php:"application/x-httpd-php",sql:"text/x-mysql"},defaults:{lineNumbers:true,lineWrapping:true,matchBrackets:true,indentUnit:4,indentWithTabs:true,enterMode:"keep",extraKeys:{"Shift-Enter":f}}},maybeInitEditor:function(){var h,i;if(!g.codemirror.modes[g.mode]||!g.inputs[g.mode]){return}if(!g.editors[g.mode]){h=e.extend({},g.codemirror.defaults,{mode:g.codemirror.modes[g.mode]});g.editors[g.mode]=CodeMirror.fromTextArea(g.inputs[g.mode][0],h);d.form.show()}i=g.editors[g.mode];i.focus();i.setCursor(i.lineCount())}};e(document).ready(function(){e.extend(d,{form:e("#debug-bar-console"),submit:e("#debug-bar-console-submit a"),input:e("#debug-bar-console-wrap"),output:e("#debug-bar-console-output")});d.wrap=d.form.parent();b=e("#_wpnonce_debug_bar_console").val();c.css=e("#debug-bar-console-iframe-css").val();c.container=e("iframe",d.output);c.contents=c.container.contents();c.document=c.contents[0];c.body=e(c.document.body);e("head",c.contents).append('<link type="text/css" href="'+c.css+'" rel="stylesheet" />');d.submit.click(f);d.wrap.bind("debug-bar-show",function(){g.maybeInitEditor()});e(".debug-bar-console-tab",d.input).each(function(){var j=e(this),i=j.find("input").val(),h;if(i){g.tabs[i]=j;j.data("console-tab",i);h=e("#debug-bar-console-input-"+i);if(h.length){g.inputs[i]=h}}}).click(function(){g.change(e(this).data("console-tab"))});e(".debug-bar-console-tab",d.output).click(function(){var h=e(this);a.mode=h.data("outputMode");a.refresh();h.siblings().removeClass("debug-bar-console-tab-active");h.addClass("debug-bar-console-tab-active")})})})(jQuery);
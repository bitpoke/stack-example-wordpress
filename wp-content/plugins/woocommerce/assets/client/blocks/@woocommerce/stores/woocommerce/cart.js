import*as e from"@wordpress/interactivity";var t={7908:e=>{e.exports=import("@woocommerce/stores/store-notices")},4317:e=>{e.exports=import("@wordpress/a11y")}},r={};function o(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const s=(n={getConfig:()=>e.getConfig,store:()=>e.store},i={},o.d(i,n),i),a=({preserveCartData:e=!1})=>{((e,{bubbles:t=!1,cancelable:r=!1,element:o,detail:s={}})=>{if(!CustomEvent)return;o||(o=document.body);const a=new CustomEvent(e,{bubbles:t,cancelable:r,detail:s});o.dispatchEvent(a)})("wc-blocks_added_to_cart",{bubbles:!0,cancelable:!0,detail:{preserveCartData:e}})};var n,i;function c(e){return"name"in e}function d(e,t){return!e.ok}function l(e){return Object.assign(new Error(e.message||"Unknown error."),{code:e.code||"unknown_error"})}const y=e=>({notice:e.message,type:"error",dismissible:!0}),p=e=>({notice:e,type:"notice",dismissible:!0}),m=(e,t,r)=>{const o=e.items,s=t.items,{productsPendingAdd:a=[],cartItemsPendingQuantity:n=[],cartItemsPendingDelete:i=[]}=r,d=o.filter((e=>e.key&&c(e)&&!s.some((t=>e.key===t.key))&&!i.includes(e.key))),l=s.filter((e=>{if(!c(e))return!1;const t=o.find((t=>t.key===e.key));return t?!n.includes(e.key)&&e.quantity!==t.quantity:!a.includes(e.id)}));return[...d.map((e=>p('"%s" was removed from your cart.'.replace("%s",e.name)))),...l.map((e=>p('The quantity of "%1$s" was changed to %2$d.'.replace("%1$s",e.name).replace("%2$d",e.quantity.toString()))))]};let u=!1,h=3e3;function f({quantityChanges:e}){window.dispatchEvent(new CustomEvent("wc-blocks_store_sync_required",{detail:{type:"from_iAPI",quantityChanges:e}}))}const{state:v,actions:g}=(0,s.store)("woocommerce",{actions:{*removeCartItem(e){const t=JSON.stringify(v.cart);v.cart.items=v.cart.items.filter((t=>t.key!==e));try{const t=yield fetch(`${v.restUrl}wc/store/v1/cart/remove-item`,{method:"POST",cache:"no-store",headers:{Nonce:v.nonce,"Content-Type":"application/json"},body:JSON.stringify({key:e})}),r=yield t.json();if(d(t))throw l(r);const o={cartItemsPendingDelete:[e]},s=m(v.cart,r,o),a=r.errors.map(y);yield g.updateNotices([...s,...a],!0),v.cart=r,f({quantityChanges:o})}catch(e){v.cart=JSON.parse(t),g.showNoticeError(e)}},*addCartItem({id:e,key:t,quantity:r,variation:n},{showCartUpdatesNotices:i=!0}={}){const p=Promise.resolve().then(o.bind(o,4317));let u=v.cart.items.find((r=>"variation"===r.type?!(e!==r.id||!r.variation||!n||r.variation.length!==n.length)&&((e,t)=>!(!Array.isArray(e.variation)||!Array.isArray(t))&&e.variation.length===t.length&&e.variation.every((({raw_attribute:e,value:r})=>t.some((t=>t.attribute===e&&(t.value.toLowerCase()===r.toLowerCase()||t.value&&""===r))))))(r,n):t?t===r.key:e===r.id));const h=u?"update-item":"add-item",w=JSON.stringify(v.cart),b={};let C=null;if(u){const e=c(u)&&u.sold_individually;C={...u,quantity:r},u.key&&!e&&(b.cartItemsPendingQuantity=[u.key],u.quantity=r)}else u={id:e,quantity:r,...n&&{variation:n}},b.productsPendingAdd=[e],v.cart.items.push(u),C=u;try{const e=yield fetch(`${v.restUrl}wc/store/v1/cart/${h}`,{method:"POST",cache:"no-store",headers:{Nonce:v.nonce,"Content-Type":"application/json"},body:JSON.stringify(C)}),t=yield e.json();if(d(e))throw l(t);const r=i?m(v.cart,t,b):[],o=t.errors.map(y);yield g.updateNotices([...r,...o],!0),v.cart=t,a({preserveCartData:!0});const{messages:n}=(0,s.getConfig)("woocommerce");if(n?.addedToCartText){const{speak:e}=yield p;e(n.addedToCartText,"polite")}f({quantityChanges:b})}catch(e){v.cart=JSON.parse(w),g.showNoticeError(e)}},*batchAddCartItems(e,{showCartUpdatesNotices:t=!0}={}){const r=Promise.resolve().then(o.bind(o,4317)),n=JSON.stringify(v.cart),i={};try{const o=e.map((e=>{const t=v.cart.items.find((({id:t})=>e.id===t));var r;return t?(t.quantity=e.quantity,t.key&&(i.cartItemsPendingQuantity=[...null!==(r=i.cartItemsPendingQuantity)&&void 0!==r?r:[],t.key]),{method:"POST",path:"/wc/store/v1/cart/update-item",cache:"no-store",headers:{Nonce:v.nonce,"Content-Type":"application/json"},body:t}):(e={id:e.id,quantity:e.quantity,...e.variation&&{variation:e.variation}},v.cart.items.push(e),i.productsPendingAdd=i.productsPendingAdd?[...i.productsPendingAdd,e.id]:[e.id],{method:"POST",path:"/wc/store/v1/cart/add-item",cache:"no-store",headers:{Nonce:v.nonce,"Content-Type":"application/json"},body:e})})),n=yield fetch(`${v.restUrl}wc/store/v1/batch`,{method:"POST",cache:"no-store",headers:{Nonce:v.nonce,"Content-Type":"application/json"},body:JSON.stringify({requests:o})}),c=yield n.json();if(d(n))throw l(c);const p=Array.isArray(c.responses)?c.responses.filter((e=>e.status<200||e.status>=300)):[],u=Array.isArray(c.responses)?c.responses.filter((e=>e.status>=200&&e.status<300)):[];if(u.length>0){const e=u[u.length-1]?.body,o=t?m(v.cart,e,i):[],n=u.flatMap((e=>{var t;return(null!==(t=e.body.errors)&&void 0!==t?t:[]).map(y)}));yield g.updateNotices([...o,...n],!0),v.cart=e,a({preserveCartData:!0});const{messages:c}=(0,s.getConfig)("woocommerce");if(c?.addedToCartText){const{speak:e}=yield r;e(c.addedToCartText,"polite")}f({quantityChanges:i})}yield g.updateNotices(p.filter((e=>e.body&&"object"==typeof e.body)).map((({body:e})=>y(e))))}catch(e){v.cart=JSON.parse(n),g.showNoticeError(e)}},*refreshCartItems(){if(!u){u=!0;try{const e=yield fetch(`${v.restUrl}wc/store/v1/cart`,{method:"GET",cache:"no-store",headers:{"Content-Type":"application/json"}}),t=yield e.json();if(d(e))throw l(t);v.cart=t,h=3e3}catch(e){setTimeout(g.refreshCartItems,h),h*=2}finally{u=!1}}},*showNoticeError(e){yield Promise.resolve().then(o.bind(o,7908));const{actions:t}=(0,s.store)("woocommerce/store-notices",{},{lock:"I acknowledge that using a private store means my plugin will inevitably break on the next store release."}),{code:r,message:a}=e,n=v.errorMessages?.[r]||a;t.addNotice({notice:n,type:"error",dismissible:!0}),console.error(e)},*updateNotices(e=[],t=!1){yield Promise.resolve().then(o.bind(o,7908));const{state:r,actions:a}=(0,s.store)("woocommerce/store-notices",{},{lock:"I acknowledge that using a private store means my plugin will inevitably break on the next store release."}),n=e.map((e=>a.addNotice(e))),{notices:i}=r;t&&i.map((({id:e})=>e)).filter((e=>!n.includes(e))).forEach((e=>a.removeNotice(e)))}}},{lock:!0});window.addEventListener("wc-blocks_store_sync_required",(async e=>{"from_@wordpress/data"===e.detail.type&&g.refreshCartItems()}));
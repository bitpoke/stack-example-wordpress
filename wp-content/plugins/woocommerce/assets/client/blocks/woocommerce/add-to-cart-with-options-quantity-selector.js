import*as t from"@woocommerce/stores/woocommerce/cart";import*as e from"@woocommerce/stores/woocommerce/product-data";import*as o from"@wordpress/interactivity";var r={8228:(t,e,o)=>{o.d(e,{q:()=>r});const r=(t,e)=>{if(!t||!Object.keys(t).length||!Array.isArray(e)||0===e.length)return null;const o=Object.entries(t).find((([t,o])=>Object.entries(o.attributes).every((([t,o])=>e.some((e=>!(e.attribute!==t)&&(e.value===o||e.value&&""===o)))))));return o?{...o[1],variation_id:Number(o[0])}:null}},3132:(t,e,o)=>{o.d(e,{E:()=>c});var r=o(2833),n=(o(4021),o(8228));const a="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",{state:i}=(0,r.store)("woocommerce",{},{lock:a}),{state:s}=(0,r.store)("woocommerce/product-data",{},{lock:a}),c=(t,e)=>{const{products:o}=(0,r.getConfig)("woocommerce");if(!o||!o[t])return null;let a={id:t,...o[t]};if("variable"===a.type&&e&&e.length>0){const t=(0,n.q)(a.variations,e);t&&(a={...t,id:t.variation_id,type:"variation"})}const i="number"==typeof a.min?a.min:1,s="number"==typeof a.max?Math.max(a.max,0):1/0,c="number"==typeof a.step&&a.step>0?a.step:1;return{...a,min:i,max:s,step:c}},{actions:u,state:l}=(0,r.store)("woocommerce/add-to-cart-with-options",{state:{noticeIds:[],get validationErrors(){const t=(0,r.getContext)();return t&&t.validationErrors?t.validationErrors:[]},get isFormValid(){return 0===l.validationErrors.length},get allowsAddingToCart(){var t;const{productData:e}=l;return null===(t=e?.is_in_stock)||void 0===t||t},get quantity(){return(0,r.getContext)().quantity},get selectedAttributes(){return(0,r.getContext)().selectedAttributes||[]},get productData(){const{selectedAttributes:t}=(0,r.getContext)();return c(s.productId,t)}},actions:{validateQuantity(t,e){if(u.clearErrors("invalid-quantities"),"number"!=typeof e)return;const{selectedAttributes:o}=(0,r.getContext)(),n=c(t,o);if(0===e||n&&(e<n.min||e>n.max)){const{errorMessages:t}=(0,r.getConfig)();u.addError({code:"invalidQuantities",message:t?.invalidQuantities||"",group:"invalid-quantities"})}},setQuantity(t,e){const o=(0,r.getContext)(),n=(0,r.getContext)("woocommerce/add-to-cart-with-options-quantity-selector"),a=n?.inputElement,{products:i}=(0,r.getConfig)("woocommerce"),s=i?.[t].variations,c=Number.isNaN(a?.valueAsNumber);s?[t,...Object.keys(s)].forEach((t=>{c&&(o.quantity[Number(t)]=null),o.quantity[Number(t)]=e})):(c&&(o.quantity={...o.quantity,[t]:null}),o.quantity={...o.quantity,[t]:e}),"grouped"===l.productData?.type?u.validateGroupedProductQuantity():u.validateQuantity(t,e),a&&(t=>{const e=new Event("change",{bubbles:!0});t.dispatchEvent(e)})(a)},addError:t=>{const{validationErrors:e}=l;return e.push(t),t.code},clearErrors:t=>{const{validationErrors:e}=l;if(t){const o=e.filter((e=>e.group!==t));e.splice(0,e.length,...o)}else e.length=0},*addToCart(){yield Promise.resolve().then(o.bind(o,1401));const{selectedAttributes:t}=(0,r.getContext)(),e=s.variationId||s.productId,n=s.variationId?"variation":c(e,t)?.type;if(!n)return;if("grouped"===n)return void(yield u.batchAddToCart());const{quantity:l}=(0,r.getContext)(),d=((t,e,o)=>{const r=i.cart?.items.find((e=>{return"variation"===e.type?!(e.id!==t||!e.variation||!o||e.variation.length!==o.length)&&(r=e,n=o,!(!Array.isArray(r.variation)||!Array.isArray(n))&&r.variation.length===n.length&&r.variation.every((({raw_attribute:t,value:e})=>n.some((o=>o.attribute===t&&(o.value.toLowerCase()===e.toLowerCase()||o.value&&""===e)))))):e.id===t;var r,n}));return(r?.quantity||0)+e})(e,l[e],t),{actions:m}=(0,r.store)("woocommerce",{},{lock:a});yield m.addCartItem({id:e,quantity:d,variation:t,type:n},{showCartUpdatesNotices:!1})},*handleSubmit(t){t.preventDefault();const{isFormValid:e}=l;if(e)yield u.addToCart();else{yield Promise.resolve().then(o.bind(o,7908));const{actions:t}=(0,r.store)("woocommerce/store-notices",{},{lock:a}),{noticeIds:e,validationErrors:n}=l;e.forEach((e=>{t.removeNotice(e)})),e.splice(0,e.length);const i=n.map((e=>t.addNotice({notice:e.message,type:"error",dismissible:!0})));e.push(...i)}}}},{lock:a})},7908:t=>{t.exports=import("@woocommerce/stores/store-notices")},1401:e=>{e.exports=t},4021:(t,e,o)=>{var r;t.exports=(r={},o.d(r,{}),r)},2833:(t,e,r)=>{var n,a;t.exports=(n={getConfig:()=>o.getConfig,getContext:()=>o.getContext,getElement:()=>o.getElement,store:()=>o.store},a={},r.d(a,n),a)}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={exports:{}};return r[t](o,o.exports,a),o.exports}a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i=a(2833),s=(a(4021),a(3132));const c="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",u=(0,i.store)("woocommerce/add-to-cart-with-options",{},{lock:c});(0,i.store)("woocommerce/add-to-cart-with-options-quantity-selector",{state:{get allowsQuantityChange(){const{productData:t}=u.state;return!t||t.is_in_stock&&!t.sold_individually},get allowsDecrease(){const{quantity:t,selectedAttributes:e}=u.state,{allowZero:o,productId:r}=(0,i.getContext)(),n=(0,s.E)(r,e);if(!n)return!0;const{id:a,min:c,step:l}=n,d=t[a]||0;return o&&d>0||d-l>=c},get allowsIncrease(){const{quantity:t,selectedAttributes:e}=u.state,{productId:o}=(0,i.getContext)(),r=(0,s.E)(o,e);if(!r)return!0;const{id:n,max:a,step:c}=r;return(t[n]||0)+c<=a},get inputQuantity(){const{productId:t}=(0,i.getContext)(),e=u.state.quantity?.[t];return void 0===e?0:e}},actions:{increaseQuantity:()=>{const{productId:t,inputElement:e}=(0,i.getContext)();if(!(e instanceof HTMLInputElement))return;const o=Number(e.value)||0,{selectedAttributes:r}=u.state,n=(0,s.E)(t,r);let a=o+1;if(n){const{max:t,min:e,step:r}=n;a=o+r,a=Math.max(e,Math.min(t,a))}u.actions.setQuantity(t,a)},decreaseQuantity:()=>{const{allowZero:t,productId:e,inputElement:o}=(0,i.getContext)();if(!(o instanceof HTMLInputElement))return;const r=Number(o.value)||0,{selectedAttributes:n}=u.state,a=(0,s.E)(e,n);let c=r-1;if(a){const{max:e,min:o,step:n}=a;c=r-n,c=t&&c<o&&r===o?0:Math.min(e,Math.max(o,c))}c!==r&&u.actions.setQuantity(e,c)},handleQuantityBlur:()=>{var t;const{allowZero:e,productId:o,inputElement:r}=(0,i.getContext)(),{selectedAttributes:n}=u.state,a=(0,s.E)(o,n);if(!a)return;const c=Number.isNaN(r?.valueAsNumber),{min:l}=a;if(e&&(c||0===r?.valueAsNumber))return void u.actions.setQuantity(o,0);const d=null!==(t=r?.valueAsNumber)&&void 0!==t?t:NaN,m=!isNaN(d)&&d>0?d:l;u.actions.setQuantity(o,m)},handleQuantityCheckboxChange:()=>{const t=(0,i.getElement)();if(!(t.ref instanceof HTMLInputElement))return;const{productId:e}=(0,i.getContext)();u.actions.setQuantity(e,t.ref.checked?1:0)}},callbacks:{storeInputElementRef:()=>{const{ref:t}=(0,i.getElement)();if(t){const e=(0,i.getContext)(),o=t.querySelector(".qty");e.inputElement=o}}}},{lock:c});
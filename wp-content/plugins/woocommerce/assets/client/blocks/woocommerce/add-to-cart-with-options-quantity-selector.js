import*as t from"@woocommerce/stores/woocommerce/cart";import*as e from"@woocommerce/stores/woocommerce/product-data";import*as r from"@wordpress/interactivity";var o={5694:(t,e,r)=>{r.d(e,{q:()=>o});const o=(t,e)=>{if(!t||!Object.keys(t).length||!Array.isArray(e)||0===e.length)return null;const r=Object.entries(t).find((([t,r])=>Object.entries(r.attributes).every((([t,r])=>e.some((e=>!(e.attribute!==t)&&(e.value===r||e.value&&""===r)))))));return r?{...r[1],variation_id:Number(r[0])}:null}},6938:(t,e,r)=>{r.d(e,{E:()=>c});var o=r(2833),a=(r(4021),r(5694));const n="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",{state:i}=(0,o.store)("woocommerce",{},{lock:n}),{state:s}=(0,o.store)("woocommerce/product-data",{},{lock:n}),c=(t,e)=>{const{products:r}=(0,o.getConfig)("woocommerce");if(!r||!r[t])return null;let n={id:t,...r[t]};if("variable"===n.type&&e&&e.length>0){const t=(0,a.q)(n.variations,e);t&&(n={...t,id:t.variation_id,type:"variation"})}const i="number"==typeof n.min?n.min:1,s="number"==typeof n.max?Math.max(n.max,0):1/0,c="number"==typeof n.step&&n.step>0?n.step:1;return{...n,min:i,max:s,step:c}},{actions:u,state:d}=(0,o.store)("woocommerce/add-to-cart-with-options",{state:{noticeIds:[],get validationErrors(){const t=(0,o.getContext)();return t&&t.validationErrors?t.validationErrors:[]},get isFormValid(){return 0===d.validationErrors.length},get allowsAddingToCart(){var t;const{productData:e}=d;return null===(t=e?.is_in_stock)||void 0===t||t},get quantity(){return(0,o.getContext)().quantity||{}},get selectedAttributes(){return(0,o.getContext)().selectedAttributes||[]},get productData(){const{selectedAttributes:t}=(0,o.getContext)();return c(s.productId,t)}},actions:{validateQuantity(t,e){if(u.clearErrors("invalid-quantities"),"number"!=typeof e)return;const{selectedAttributes:r}=(0,o.getContext)(),a=c(t,r);if(0===e||a&&(e<a.min||e>a.max)){const{errorMessages:t}=(0,o.getConfig)();u.addError({code:"invalidQuantities",message:t?.invalidQuantities||"",group:"invalid-quantities"})}},setQuantity(t,e){const r=(0,o.getContext)(),{products:a}=(0,o.getConfig)("woocommerce"),n=a?.[t].variations;n?[t,...Object.keys(n)].forEach((t=>{r.quantity[Number(t)]=e})):r.quantity={...r.quantity,[t]:e},"grouped"===d.productData?.type?u.validateGroupedProductQuantity():u.validateQuantity(t,e)},addError:t=>{const{validationErrors:e}=d;return e.push(t),t.code},clearErrors:t=>{const{validationErrors:e}=d;if(t){const r=e.filter((e=>e.group!==t));e.splice(0,e.length,...r)}else e.length=0},*addToCart(){yield Promise.resolve().then(r.bind(r,1401));const{selectedAttributes:t}=(0,o.getContext)(),e=s.variationId||s.productId,a=s.variationId?"variation":c(e,t)?.type;if(!a)return;if("grouped"===a)return void(yield u.batchAddToCart());const{quantity:d}=(0,o.getContext)(),l=((t,e,r)=>{const o=i.cart?.items.find((e=>{return"variation"===e.type?!(e.id!==t||!e.variation||!r||e.variation.length!==r.length)&&(o=e,a=r,!(!Array.isArray(o.variation)||!Array.isArray(a))&&o.variation.length===a.length&&o.variation.every((({raw_attribute:t,value:e})=>a.some((r=>r.attribute===t&&(r.value.toLowerCase()===e.toLowerCase()||r.value&&""===e)))))):e.id===t;var o,a}));return(o?.quantity||0)+e})(e,d[e],t),{actions:m}=(0,o.store)("woocommerce",{},{lock:n});yield m.addCartItem({id:e,quantity:l,variation:t,type:a},{showCartUpdatesNotices:!1})},*handleSubmit(t){t.preventDefault();const{isFormValid:e}=d;if(e)yield u.addToCart();else{yield Promise.resolve().then(r.bind(r,7908));const{actions:t}=(0,o.store)("woocommerce/store-notices",{},{lock:n}),{noticeIds:e,validationErrors:a}=d;e.forEach((e=>{t.removeNotice(e)})),e.splice(0,e.length);const i=a.map((e=>t.addNotice({notice:e.message,type:"error",dismissible:!0})));e.push(...i)}}}},{lock:n})},7908:t=>{t.exports=import("@woocommerce/stores/store-notices")},1401:e=>{e.exports=t},4021:(t,e,r)=>{var o;t.exports=(o={},r.d(o,{}),o)},2833:(t,e,o)=>{var a,n;t.exports=(a={getConfig:()=>r.getConfig,getContext:()=>r.getContext,getElement:()=>r.getElement,store:()=>r.store},n={},o.d(n,a),n)}},a={};function n(t){var e=a[t];if(void 0!==e)return e.exports;var r=a[t]={exports:{}};return o[t](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};n.d(i,{V:()=>l});var s=n(2833),c=(n(4021),n(6938));const u="I acknowledge that using a private store means my plugin will inevitably break on the next store release.",d=(0,s.store)("woocommerce/add-to-cart-with-options",{},{lock:u}),l=t=>{const e=new Event("change",{bubbles:!0});t.dispatchEvent(e)};(0,s.store)("woocommerce/add-to-cart-with-options-quantity-selector",{state:{get allowsQuantityChange(){const{productData:t}=d.state;return!t||t.is_in_stock&&!t.sold_individually},get allowsDecrease(){const{productData:t,quantity:e}=d.state;if(!t)return!0;if("grouped"===t.type){const{productId:t}=(0,s.getContext)();return e[t]>0}const{id:r,min:o,step:a}=t;return(e[r]||0)-a>=o},get allowsIncrease(){const{quantity:t,selectedAttributes:e}=d.state,{productId:r}=(0,s.getContext)(),o=(0,c.E)(r,e);if(!o)return!0;const{id:a,max:n,step:i}=o;return(t[a]||0)+i<=n}},actions:{increaseQuantity:t=>{const e=t.target.parentElement?.querySelector(".qty");if(!(e instanceof HTMLInputElement))return;const r=Number(e.value)||0,{productId:o}=(0,s.getContext)(),{selectedAttributes:a}=d.state,n=(0,c.E)(o,a);let i=r+1;if(n){const{max:t,min:e,step:o}=n;i=r+o,i=Math.max(e,Math.min(t,i))}d.actions.setQuantity(o,i),e.value=i.toString(),l(e)},decreaseQuantity:t=>{const e=t.target.parentElement?.querySelector(".qty");if(!(e instanceof HTMLInputElement))return;const r=Number(e.value)||0,{productId:o}=(0,s.getContext)(),{productData:a,selectedAttributes:n}=d.state,i=a;let u=i;"grouped"===i?.type&&(u=(0,c.E)(o,n));let m=r-1;if(u){const{min:t,step:e}=u;m=r-e,m<t&&(m="grouped"===i?.type?r>t?t:0:t)}m!==r&&(d.actions.setQuantity(o,m),e.value=m.toString(),l(e))},handleQuantityBlur:t=>{const{productData:e,selectedAttributes:r}=d.state;let o=1;if(!e)return;const{productId:a}=(0,s.getContext)();if((Number.isNaN(t.target.valueAsNumber)||0===t.target.valueAsNumber)&&"grouped"===e.type)return d.actions.setQuantity(a,0),Number.isNaN(t.target.valueAsNumber)&&(t.target.value=""),void l(t.target);const n="grouped"===e.type?(0,c.E)(a,r):e;if(!n)return;o=n.min;const i=Number.isFinite(t.target.valueAsNumber)&&t.target.valueAsNumber>0?t.target.valueAsNumber:o;d.actions.setQuantity(a,i),t.target.value=i.toString(),l(t.target)},handleQuantityCheckboxChange:()=>{const t=(0,s.getElement)();if(!(t.ref instanceof HTMLInputElement))return;const{productId:e}=(0,s.getContext)();d.actions.setQuantity(e,t.ref.checked?1:0)}}},{lock:u});var m=i.V;export{m as dispatchChangeEvent};
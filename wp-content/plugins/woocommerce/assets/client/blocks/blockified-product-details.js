(()=>{"use strict";const e=window.wp.blocks,t=window.wp.data,o=window.wc.wcTypes;class i{blocks=new Map;initialized=!1;attemptedRegisteredBlocks=new Set;constructor(){this.initializeSubscriptions()}static getInstance(){return i.instance||(i.instance=new i),i.instance}parseTemplateId(e){const t=(0,o.isNumber)(e)?void 0:e;return t?.split("//")[1]}initializeSubscriptions(){if(this.initialized)return;const e=(0,t.subscribe)((()=>{const o=(0,t.select)("core/edit-site"),i=(0,t.select)("core/edit-post");if(o||i)if(o){const i=o.getEditedPostId();e(),this.currentTemplateId="string"==typeof i?this.parseTemplateId(i):void 0,(0,t.subscribe)((()=>{const e=this.currentTemplateId;this.currentTemplateId=this.parseTemplateId(o.getEditedPostId()),e!==this.currentTemplateId&&this.handleTemplateChange(e)}),"core/edit-site"),this.initialized=!0}else i&&(e(),this.blocks.forEach((e=>{if(e.isAvailableOnPostEditor){const t=e.variationName||e.blockName;this.hasAttemptedRegistration(t)||this.registerBlock(e)}})),this.initialized=!0)}))}handleTemplateChange(e){(this.currentTemplateId?.includes("single-product")||e?.includes("single-product"))&&this.blocks.forEach((e=>{this.unregisterBlock(e),this.registerBlock(e)}))}hasAttemptedRegistration(e){return this.attemptedRegisteredBlocks.has(e)}unregisterBlock(t){const{blockName:o,isVariationBlock:i,variationName:c}=t;try{i&&c?((0,e.unregisterBlockVariation)(o,c),this.attemptedRegisteredBlocks.delete(c)):((0,e.unregisterBlockType)(o),this.attemptedRegisteredBlocks.delete(o))}catch(e){console.debug(`Failed to unregister block ${o}:`,e)}}registerBlock(i){const{blockName:c,settings:s,isVariationBlock:r,variationName:n,isAvailableOnPostEditor:a}=i;try{const i=n||c;if(this.hasAttemptedRegistration(i))return;const l=(0,t.select)("core/edit-site");if(!l&&!a)return;if(r)(0,e.registerBlockVariation)(c,s);else{const t=(0,o.isEmpty)(s?.ancestor)?["woocommerce/single-product"]:s?.ancestor,i=l&&this.currentTemplateId?.includes("single-product");(0,e.registerBlockType)(c,{...s,ancestor:i?void 0:t})}this.attemptedRegisteredBlocks.add(i)}catch(e){console.error(`Failed to register block ${c}:`,e)}}registerBlockConfig(e){const t=e.variationName||e.blockName;this.blocks.set(t,e),this.registerBlock(e)}}const c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woocommerce/blockified-product-details","title":"Blockified Product Details","description":"Display a product\'s description, attributes, and reviews","category":"woocommerce","textdomain":"woocommerce","ancestor":["woocommerce/single-product","woocommerce/product-template","core/post-template"],"supports":{"interactivity":{"clientNavigation":true},"align":["wide","full"]},"attributes":{},"usesContext":["query","queryId","postId","postType"]}'),s=window.wp.blockEditor,r=window.ReactJSXRuntime,n=window.wp.i18n,a=[["woocommerce/accordion-group",{},[["woocommerce/accordion-item",{openByDefault:!0},[["woocommerce/accordion-header",{title:(0,n.__)("Description","woocommerce")},[]],["woocommerce/accordion-panel",{},[["woocommerce/product-description",{},[]]]]]],["woocommerce/accordion-item",{},[["woocommerce/accordion-header",{title:(0,n.__)("Additional Information","woocommerce")},[]],["woocommerce/accordion-panel",{},[["woocommerce/product-specifications",{}]]]]],["woocommerce/accordion-item",{},[["woocommerce/accordion-header",{title:(0,n.__)("Reviews","woocommerce")},[]],["woocommerce/accordion-panel",{},[["woocommerce/blockified-product-reviews",{}]]]]]]]],l=window.wp.primitives;(e=>{const t=e.name;if(!t)return void console.error("registerProductBlockType: Block name is required for registration");const o=(({name:e,...t})=>t)(e),{isVariationBlock:c,variationName:s,isAvailableOnPostEditor:r,...n}={...o,...{isAvailableOnPostEditor:!0}||{}},a={blockName:t,settings:{...n},isVariationBlock:null!=c&&c,variationName:null!=s?s:void 0,isAvailableOnPostEditor:null!=r&&r};i.getInstance().registerBlockConfig(a)})({...c,icon:(0,r.jsxs)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",fill:"currentColor",d:"M5 5.5H19C19.1326 5.5 19.2598 5.55268 19.3536 5.64645C19.4473 5.74021 19.5 5.86739 19.5 6V7.5C19.5 7.63261 19.4473 7.75979 19.3536 7.85355C19.2598 7.94732 19.1326 8 19 8H5C4.86739 8 4.74021 7.94732 4.64645 7.85355C4.55268 7.75979 4.5 7.63261 4.5 7.5V6C4.5 5.86739 4.55268 5.74021 4.64645 5.64645C4.74021 5.55268 4.86739 5.5 5 5.5V5.5ZM4 9.232C3.69597 9.05647 3.4435 8.804 3.26796 8.49997C3.09243 8.19594 3.00001 7.85106 3 7.5V6C3 5.46957 3.21071 4.96086 3.58579 4.58579C3.96086 4.21071 4.46957 4 5 4H19C19.5304 4 20.0391 4.21071 20.4142 4.58579C20.7893 4.96086 21 5.46957 21 6V7.5C21 7.85106 20.9076 8.19594 20.732 8.49997C20.5565 8.804 20.304 9.05647 20 9.232V18C20 18.5304 19.7893 19.0391 19.4142 19.4142C19.0391 19.7893 18.5304 20 18 20H6C5.46957 20 4.96086 19.7893 4.58579 19.4142C4.21071 19.0391 4 18.5304 4 18V9.232ZM5.5 9.5V18C5.5 18.1326 5.55268 18.2598 5.64645 18.3536C5.74021 18.4473 5.86739 18.5 6 18.5H18C18.1326 18.5 18.2598 18.4473 18.3536 18.3536C18.4473 18.2598 18.5 18.1326 18.5 18V9.5H5.5Z"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 13.25V11.75H16V13.25L8 13.25Z"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 16.25V14.75H16V16.25H8Z"})]}),edit:({clientId:e,context:o})=>{const i=(0,s.useBlockProps)(),c=(0,s.useInnerBlocksProps)(i,{template:a}),l=((e,o)=>(0,t.useSelect)((t=>t(s.store).getBlockParentsByBlockName(e,"core/post-template").length>0&&"product"!==o),[e,o]))(e,o.postType);return l?(0,r.jsx)("div",{...i,children:(0,r.jsx)(s.Warning,{children:(0,n.__)("The Product Details block requires a product context. When used in a Query Loop, the Query Loop must be configured to display products.","woocommerce")})}):(0,r.jsx)("div",{...c})},save:function(){const e=s.useBlockProps.save(),t=s.useInnerBlocksProps.save(e);return(0,r.jsx)("div",{...t})}}),((this.wc=this.wc||{}).blocks=this.wc.blocks||{})["blockified-product-details"]={}})();
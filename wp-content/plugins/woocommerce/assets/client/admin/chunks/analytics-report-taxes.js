"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[8068],{36736:(e,t,r)=>{r.d(t,{Y:()=>A});var a=r(27723),o=r(38443),s=r(56427),c=r(47143),i=r(40314),n=r(86087),l=r(1455),d=r.n(l);const m=5e3;var u=r(39793);function p(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:l}=function(){const[e,t]=(0,n.useState)(null),[r,o]=(0,n.useState)(!0),[s,c]=(0,n.useState)(null),[i,l]=(0,n.useState)(!1),u=(0,n.useRef)(null),p=(0,n.useCallback)((async()=>{try{const e=await d()({path:"/wc-analytics/imports/status",method:"GET"});t(e),c(null)}catch(e){c(e instanceof Error?e.message:(0,a.__)("Failed to fetch status","woocommerce"))}finally{o(!1)}}),[]),_=(0,n.useCallback)((async()=>{l(!0);try{await d()({path:"/wc-analytics/imports/trigger",method:"POST"}),await p()}catch(e){throw c(e instanceof Error?e.message:(0,a.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[p]);return(0,n.useEffect)((()=>{p()}),[p]),(0,n.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(p,m):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,p]),{status:e,isLoading:r,error:s,triggerImport:_,isTriggeringImport:i}}(),{createNotice:p}=(0,c.useDispatch)("core/notices"),{wcAdminSettings:_}=(0,i.useSettings)("wc_admin",["wcAdminSettings"]);if(!_?.woocommerce_analytics_scheduled_import||"no"===_.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,a.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,a.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(h=e?.last_processed_date||null,h?(0,o.dateI18n)("M j H:i",h,void 0):(0,a.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,a.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(e=>e?(0,o.dateI18n)((0,a.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,a.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(s.Button,{variant:"tertiary",onClick:async()=>{try{await r(),p("success",(0,a.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){p("error",e instanceof Error?e.message:(0,a.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,a.__)("Analytics data import in progress","woocommerce"):(0,a.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,u.jsx)(s.Spinner,{}):(0,a.__)("Update now","woocommerce")})]})})]});var h}var _=r(29491),y=r(66087),h=r(27752),g=r(98846),x=r(77374),w=r(83306),b=r(94111),f=r(56109);class v extends n.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,w.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,a=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(a)&&r();const o={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(o.filter_variation=e["filter-variations"]||"all"),(0,w.recordEvent)("analytics_filter",o)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:a}=this.props;switch(e){case"add":(0,w.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,w.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,y.snakeCase)(r)]=t[r],e)),{});a(),(0,w.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,w.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,w.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:a,showDatePicker:o,defaultDateRange:s}=this.props,{period:c,compare:i,before:n,after:l}=(0,x.getDateParamsFromQuery)(a,s),{primary:d,secondary:m}=(0,x.getCurrentDates)(a,s),p={period:c,compare:i,before:n,after:l,primaryDate:d,secondaryDate:m},_=this.context;return(0,u.jsx)(g.ReportFilters,{query:a,siteLocale:f.ne.siteLocale,currency:_.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:o,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:p,isoDateFormat:x.isoDateFormat})}}v.contextType=b.CurrencyContext;const S=(0,_.compose)((0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(i.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,c.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(h.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(v);function A(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(S,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(p,{})]})}},9622:(e,t,r)=>{r.d(t,{Qc:()=>u,eg:()=>m,uW:()=>_});var a=r(27723),o=r(52619),s=r(27752),c=r(40314),i=r(47143),n=r(33958),l=r(32639);const{addCesSurveyForAnalytics:d}=(0,i.dispatch)(s.STORE_KEY),m=(0,o.applyFilters)("woocommerce_admin_taxes_report_charts",[{key:"total_tax",label:(0,a.__)("Total tax","woocommerce"),order:"desc",orderby:"total_tax",type:"currency"},{key:"order_tax",label:(0,a.__)("Order tax","woocommerce"),order:"desc",orderby:"order_tax",type:"currency"},{key:"shipping_tax",label:(0,a.__)("Shipping tax","woocommerce"),order:"desc",orderby:"shipping_tax",type:"currency"},{key:"orders_count",label:(0,a.__)("Orders","woocommerce"),order:"desc",orderby:"orders_count",type:"number"}]),u=(0,o.applyFilters)("woocommerce_admin_taxes_report_advanced_filters",{filters:{},title:(0,a._x)("Taxes match <select/> filters","A sentence describing filters for Taxes. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce")}),p=[{label:(0,a.__)("All taxes","woocommerce"),value:"all"},{label:(0,a.__)("Comparison","woocommerce"),value:"compare-taxes",chartMode:"item-comparison",settings:{type:"taxes",param:"taxes",getLabels:(0,n.Dn)(c.NAMESPACE+"/taxes",(e=>({id:e.id,key:e.id,label:(0,l.H)(e)}))),labels:{helpText:(0,a.__)("Check at least two tax codes below to compare","woocommerce"),placeholder:(0,a.__)("Search for tax codes to compare","woocommerce"),title:(0,a.__)("Compare Tax Codes","woocommerce"),update:(0,a.__)("Compare","woocommerce")},onClick:d}}];Object.keys(u.filters).length&&p.push({label:(0,a.__)("Advanced filters","woocommerce"),value:"advanced"});const _=(0,o.applyFilters)("woocommerce_admin_taxes_report_filters",[{label:(0,a.__)("Show","woocommerce"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>!0,filters:p}])},15415:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var a=r(86087),o=r(27723),s=r(9622),c=r(95272),i=r(55737),n=r(68224),l=r(66087),d=r(98846),m=r(96476),u=r(43577),p=r(94111),_=r(32639),y=r(79899),h=r(39793);class g extends a.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,o.__)("Tax code","woocommerce"),key:"tax_code",required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,o.__)("Rate","woocommerce"),key:"rate",isSortable:!0,isNumeric:!0},{label:(0,o.__)("Total tax","woocommerce"),key:"total_tax",isSortable:!0},{label:(0,o.__)("Order tax","woocommerce"),key:"order_tax",isSortable:!0},{label:(0,o.__)("Shipping tax","woocommerce"),key:"shipping_tax",isSortable:!0},{label:(0,o.__)("Orders","woocommerce"),key:"orders_count",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0}]}getRowsContent(e){const{render:t,formatDecimal:r,getCurrencyConfig:a}=this.context;return(0,l.map)(e,(e=>{const{query:o}=this.props,{order_tax:s,orders_count:c,tax_rate:i,tax_rate_id:n,total_tax:l,shipping_tax:p}=e,y=(0,_.H)(e),g=(0,m.getPersistedQuery)(o),x=(0,m.getNewPath)(g,"/analytics/orders",{filter:"advanced",tax_rate_includes:n});return[{display:(0,h.jsx)(d.Link,{href:x,type:"wc-admin",children:y}),value:y},{display:i.toFixed(2)+"%",value:i},{display:t(l),value:r(l)},{display:t(s),value:r(s)},{display:t(p),value:r(p)},{display:(0,u.formatValue)(a(),"number",c),value:c}]}))}getSummary(e,t=0){const{tax_codes:r=0,total_tax:a=0,order_tax:s=0,shipping_tax:c=0,orders_count:i=0}=e,{formatAmount:n,getCurrencyConfig:l}=this.context,d=l();return[{label:(0,o._n)("tax","taxes",t,"woocommerce"),value:(0,u.formatValue)(d,"number",t)},{label:(0,o._n)("distinct code","distinct codes",r,"woocommerce"),value:(0,u.formatValue)(d,"number",r)},{label:(0,o.__)("total tax","woocommerce"),value:n(a)},{label:(0,o.__)("order tax","woocommerce"),value:n(s)},{label:(0,o.__)("shipping tax","woocommerce"),value:n(c)},{label:(0,o._n)("order","orders",i,"woocommerce"),value:(0,u.formatValue)(d,"number",i)}]}render(){const{advancedFilters:e,filters:t,isRequesting:r,query:a}=this.props;return(0,h.jsx)(y.A,{compareBy:"taxes",endpoint:"taxes",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["tax_codes","total_tax","order_tax","shipping_tax","orders_count"],isRequesting:r,itemIdField:"tax_rate_id",query:a,searchBy:"taxes",tableQuery:{orderby:a.orderby||"tax_rate_id"},title:(0,o.__)("Taxes","woocommerce"),columnPrefsKey:"taxes_report_columns",filters:t,advancedFilters:e})}}g.contextType=p.CurrencyContext;const x=g;var w=r(36736);class b extends a.Component{getChartMeta(){const{query:e}=this.props,t="compare-taxes"===e.filter?"item-comparison":"time-comparison";return{itemsLabel:(0,o.__)("%d taxes","woocommerce"),mode:t}}render(){const{isRequesting:e,query:t,path:r}=this.props,{mode:o,itemsLabel:l}=this.getChartMeta(),d={...t};return"item-comparison"===o&&(d.segmentby="tax_rate_id"),(0,h.jsxs)(a.Fragment,{children:[(0,h.jsx)(w.Y,{query:t,path:r,filters:s.uW,advancedFilters:s.Qc,report:"taxes"}),(0,h.jsx)(n.A,{charts:s.eg,endpoint:"taxes",query:d,selectedChart:(0,c.A)(t.chart,s.eg),filters:s.uW,advancedFilters:s.Qc}),(0,h.jsx)(i.A,{charts:s.eg,filters:s.uW,advancedFilters:s.Qc,mode:o,endpoint:"taxes",query:d,path:r,isRequesting:e,itemsLabel:l,selectedChart:(0,c.A)(t.chart,s.eg)}),(0,h.jsx)(x,{isRequesting:e,query:t,filters:s.uW,advancedFilters:s.Qc})]})}}const f=b},32639:(e,t,r)=>{r.d(t,{H:()=>o});var a=r(27723);function o(e){return[e.country,e.state,e.name||(0,a.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},33958:(e,t,r)=>{r.d(t,{Dn:()=>u,U4:()=>_,aG:()=>p,b8:()=>w,jx:()=>g,p0:()=>h,wd:()=>y,xP:()=>x});var a=r(27723),o=r(93832),s=r(1455),c=r.n(s),i=r(66087),n=r(96476),l=r(40314),d=r(32639),m=r(56109);function u(e,t=i.identity){return function(r="",a){const s="function"==typeof e?e(a):e,i=(0,n.getIdsFromQuery)(r);if(i.length<1)return Promise.resolve([]);const l={include:i.join(","),per_page:i.length};return c()({path:(0,o.addQueryArgs)(s,l)}).then((e=>e.map(t)))}}u(l.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const p=u(l.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),_=u(l.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),y=u(l.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),h=u(l.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),g=u(l.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,d.H)(e)})));function x({attributes:e,name:t}){const r=(0,m.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(r)>-1)return t;const o=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,a.sprintf)((0,a.__)("Any %s","woocommerce"),e)),t))).join(", ");return o?t+r+o:t}const w=u((({products:e})=>e?l.NAMESPACE+`/products/${e}/variations`:l.NAMESPACE+"/variations"),(e=>({key:e.id,label:x(e)})))},95272:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(66087);function o(e,t=[]){return(0,a.find)(t,{key:e})||t[0]}}}]);
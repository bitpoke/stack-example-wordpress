"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[3151],{36736:(e,t,r)=>{r.d(t,{Y:()=>k});var o=r(27723),s=r(38443),a=r(56427),n=r(47143),i=r(40314),c=r(86087),l=r(1455),d=r.n(l);const m=5e3;var u=r(39793);function p(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:l}=function(){const[e,t]=(0,c.useState)(null),[r,s]=(0,c.useState)(!0),[a,n]=(0,c.useState)(null),[i,l]=(0,c.useState)(!1),u=(0,c.useRef)(null),p=(0,c.useCallback)((async()=>{try{const e=await d()({path:"/wc-analytics/imports/status",method:"GET"});t(e),n(null)}catch(e){n(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{s(!1)}}),[]),_=(0,c.useCallback)((async()=>{l(!0);try{await d()({path:"/wc-analytics/imports/trigger",method:"POST"}),await p()}catch(e){throw n(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[p]);return(0,c.useEffect)((()=>{p()}),[p]),(0,c.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(p,m):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,p]),{status:e,isLoading:r,error:a,triggerImport:_,isTriggeringImport:i}}(),{createNotice:p}=(0,n.useDispatch)("core/notices"),{wcAdminSettings:_}=(0,i.useSettings)("wc_admin",["wcAdminSettings"]);if(!_?.woocommerce_analytics_scheduled_import||"no"===_.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(a.Spinner,{}):(h=e?.last_processed_date||null,h?(0,s.dateI18n)("M j H:i",h,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(a.Spinner,{}):(e=>e?(0,s.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(a.Button,{variant:"tertiary",onClick:async()=>{try{await r(),p("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){p("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,u.jsx)(a.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var h}var _=r(29491),y=r(66087),h=r(27752),g=r(98846),w=r(77374),v=r(83306),b=r(94111),f=r(56109);class S extends c.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,v.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const s={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(s.filter_variation=e["filter-variations"]||"all"),(0,v.recordEvent)("analytics_filter",s)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,v.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,v.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,y.snakeCase)(r)]=t[r],e)),{});o(),(0,v.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,v.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,v.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:s,defaultDateRange:a}=this.props,{period:n,compare:i,before:c,after:l}=(0,w.getDateParamsFromQuery)(o,a),{primary:d,secondary:m}=(0,w.getCurrentDates)(o,a),p={period:n,compare:i,before:c,after:l,primaryDate:d,secondaryDate:m},_=this.context;return(0,u.jsx)(g.ReportFilters,{query:o,siteLocale:f.ne.siteLocale,currency:_.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:s,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:p,isoDateFormat:w.isoDateFormat})}}S.contextType=b.CurrencyContext;const x=(0,_.compose)((0,n.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(i.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,n.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(h.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(S);function k(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(x,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(p,{})]})}},94693:(e,t,r)=>{r.d(t,{Qc:()=>i,eg:()=>n,uW:()=>l});var o=r(27723),s=r(52619);const a=(0,r(56109).Qk)("usesNewFullRefundData",!0),n=(0,s.applyFilters)("woocommerce_admin_revenue_report_charts",[{key:"gross_sales",label:(0,o.__)("Gross sales","woocommerce"),order:"desc",orderby:"gross_sales",type:"currency",isReverseTrend:!1},{key:"refunds",label:(0,o.__)("Returns","woocommerce"),order:"desc",orderby:"refunds",type:"currency",isReverseTrend:!0,labelTooltipText:a?(0,o.__)("Returns include returned shipping and tax amounts.","woocommerce"):null},{key:"coupons",label:(0,o.__)("Coupons","woocommerce"),order:"desc",orderby:"coupons",type:"currency",isReverseTrend:!1},{key:"net_revenue",label:(0,o.__)("Net sales","woocommerce"),orderby:"net_revenue",type:"currency",isReverseTrend:!1,labelTooltipText:a?null:(0,o.__)("Full refunds are not deducted from tax or net sales totals","woocommerce")},{key:"taxes",label:(0,o.__)("Taxes","woocommerce"),order:"desc",orderby:"taxes",type:"currency",isReverseTrend:!1,labelTooltipText:a?null:(0,o.__)("Full refunds are not deducted from tax or net sales totals","woocommerce")},{key:"shipping",label:(0,o.__)("Shipping","woocommerce"),orderby:"shipping",type:"currency",isReverseTrend:!1},{key:"total_sales",label:(0,o.__)("Total sales","woocommerce"),order:"desc",orderby:"total_sales",type:"currency",isReverseTrend:!1}]),i=(0,s.applyFilters)("woocommerce_admin_revenue_report_advanced_filters",{filters:{},title:(0,o._x)("Revenue Matches <select/> Filters","A sentence describing filters for Revenue. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce")}),c=[];Object.keys(i.filters).length&&(c.push({label:(0,o.__)("All Revenue","woocommerce"),value:"all"}),c.push({label:(0,o.__)("Advanced Filters","woocommerce"),value:"advanced"}));const l=(0,s.applyFilters)("woocommerce_admin_revenue_report_filters",[{label:(0,o.__)("Show","woocommerce"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>c.length>0,filters:c}])},95220:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var o=r(86087),s=r(27723),a=r(94693),n=r(95272),i=r(55737),c=r(68224),l=r(38443),d=r(47143),m=r(29491),u=r(66087),p=r(98846),_=r(43577),y=r(40314),h=r(77374),g=r(4594),w=r(94111),v=r(79899),b=r(56109),f=r(39793);const S=[],x=["orders_count","gross_sales","total_sales","refunds","coupons","taxes","shipping","net_revenue"];class k extends o.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,s.__)("Date","woocommerce"),key:"date",required:!0,defaultSort:!0,isLeftAligned:!0,isSortable:!0},{label:(0,s.__)("Orders","woocommerce"),key:"orders_count",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Gross sales","woocommerce"),key:"gross_sales",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Returns","woocommerce"),key:"refunds",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Coupons","woocommerce"),key:"coupons",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Net sales","woocommerce"),key:"net_revenue",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Taxes","woocommerce"),key:"taxes",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Shipping","woocommerce"),key:"shipping",required:!1,isSortable:!0,isNumeric:!0},{label:(0,s.__)("Total sales","woocommerce"),key:"total_sales",required:!1,isSortable:!0,isNumeric:!0}]}getRowsContent(e=[]){const t=(0,b.Qk)("dateFormat",h.defaultTableDateFormat),{formatAmount:r,render:o,formatDecimal:s,getCurrencyConfig:a}=this.context;return e.map((e=>{const{coupons:n,gross_sales:i,total_sales:c,net_revenue:d,orders_count:m,refunds:u,shipping:y,taxes:h}=e.subtotals,g=(0,f.jsx)(p.Link,{href:`edit.php?post_type=shop_order&order_date_type=${this.props.dateType}&m=`+(0,l.format)("Ymd",e.date_start),type:"wp-admin",children:(0,_.formatValue)(a(),"number",m)});return[{display:(0,f.jsx)(p.Date,{date:e.date_start,visibleFormat:t}),value:e.date_start},{display:g,value:Number(m)},{display:o(i),value:s(i)},{display:r(u),value:s(u)},{display:r(n),value:s(n)},{display:o(d),value:s(d)},{display:o(h),value:s(h)},{display:o(y),value:s(y)},{display:o(c),value:s(c)}]}))}getSummary(e,t=0){const{orders_count:r=0,gross_sales:o=0,total_sales:a=0,refunds:n=0,coupons:i=0,taxes:c=0,shipping:l=0,net_revenue:d=0}=e,{formatAmount:m,getCurrencyConfig:u}=this.context,p=u();return[{label:(0,s._n)("day","days",t,"woocommerce"),value:(0,_.formatValue)(p,"number",t)},{label:(0,s._n)("order","orders",r,"woocommerce"),value:(0,_.formatValue)(p,"number",r)},{label:(0,s.__)("Gross sales","woocommerce"),value:m(o)},{label:(0,s.__)("Returns","woocommerce"),value:m(n)},{label:(0,s.__)("Coupons","woocommerce"),value:m(i)},{label:(0,s.__)("Net sales","woocommerce"),value:m(d)},{label:(0,s.__)("Taxes","woocommerce"),value:m(c)},{label:(0,s.__)("Shipping","woocommerce"),value:m(l)},{label:(0,s.__)("Total sales","woocommerce"),value:m(a)}]}render(){const{advancedFilters:e,filters:t,tableData:r,query:o}=this.props;return(0,f.jsx)(v.A,{endpoint:"revenue",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:x,query:o,tableData:r,title:(0,s.__)("Revenue","woocommerce"),columnPrefsKey:"revenue_report_columns",filters:t,advancedFilters:e})}}k.contextType=w.CurrencyContext;const F=(0,u.memoize)(((e,t,r,o,s)=>({tableData:{items:{data:(0,u.get)(o,["data","intervals"],S),totalResults:(0,u.get)(o,["totalResults"],0)},isError:e,isRequesting:t,query:r},dateType:s})),((e,t,r,o,s)=>[e,t,(0,g.stringify)(r),(0,u.get)(o,["totalResults"],0),(0,u.get)(o,["data","intervals"],S).length,s].join(":"))),C=(0,u.memoize)(((e,t,r,o,s)=>({interval:"day",orderby:t,order:e,page:r,per_page:o,after:(0,h.appendTimestamp)(s.primary.after,"start"),before:(0,h.appendTimestamp)(s.primary.before,"end")})),((e,t,r,o,s)=>[e,t,r,o,s.primary.after,s.primary.before].join(":"))),T=(0,m.compose)((0,d.withSelect)(((e,t)=>{const{query:r,filters:o,advancedFilters:s}=t,{woocommerce_default_date_range:a}=e(y.settingsStore).getSetting("wc_admin","wcAdminSettings"),{getOption:n}=e(y.optionsStore),i=n("woocommerce_date_type")||"date_paid",c=(0,h.getCurrentDates)(r,a),{getReportStats:l,getReportStatsError:d,isResolving:m}=e(y.reportsStore),u=C(r.order||"desc",r.orderby||"date",r.paged||1,r.per_page||y.QUERY_DEFAULTS.pageSize,c),p=(0,y.getReportTableQuery)({endpoint:"revenue",query:r,select:e,tableQuery:u,filters:o,advancedFilters:s}),_=l("revenue",p),g=Boolean(d("revenue",p)),w=m("getReportStats",["revenue",p]);return F(g,w,u,_,i)})))(k);var R=r(36736),A=r(84179);class j extends o.Component{render(){const{path:e,query:t}=this.props;return(0,f.jsxs)(o.Fragment,{children:[(0,f.jsx)(R.Y,{query:t,path:e,report:"revenue",filters:a.uW,advancedFilters:a.Qc}),(0,f.jsx)(c.A,{charts:a.eg,endpoint:"revenue",query:t,selectedChart:(0,n.A)(t.chart,a.eg),filters:a.uW,advancedFilters:a.Qc}),(0,f.jsx)(i.A,{charts:a.eg,endpoint:"revenue",path:e,query:t,selectedChart:(0,n.A)(t.chart,a.eg),filters:a.uW,advancedFilters:a.Qc}),(0,f.jsx)(T,{query:t,filters:a.uW,advancedFilters:a.Qc}),(0,f.jsx)(A.F,{optionName:"woocommerce_revenue_report_date_tour_shown",headingText:(0,s.__)("Revenue is now reported from paid orders âœ…","woocommerce")})]})}}},84179:(e,t,r)=>{r.d(t,{F:()=>m});var o=r(98846),s=r(27723),a=r(40314),n=r(86087),i=r(47143),c=r(15703),l=r(39793);const d="woocommerce_date_type",m=({optionName:e,headingText:t})=>{const[r,m]=(0,n.useState)(!1),{updateOptions:u}=(0,i.useDispatch)(a.optionsStore),{shouldShowTour:p,isResolving:_}=(0,i.useSelect)((t=>{const{getOption:r,hasFinishedResolution:o}=t(a.optionsStore);return{shouldShowTour:"yes"!==r(e)&&!1===r(d),isResolving:!o("getOption",[e])||!o("getOption",[d])}}),[e]);if(r||!p||_)return null;const y={steps:[{referenceElements:{desktop:".woocommerce-filters-filter > .components-dropdown"},focusElement:{desktop:".woocommerce-filters-filter > .components-dropdown"},meta:{name:"product-feedback-",heading:t,descriptions:{desktop:(0,n.createInterpolateElement)((0,s.__)("We now collect orders in this table based on when the payment went through, rather than when they were placed. You can change this in <link>settings</link>.","woocommerce"),{link:(0,n.createElement)("a",{href:(0,c.getAdminLink)("admin.php?page=wc-admin&path=/analytics/settings"),"aria-label":(0,s.__)("Analytics date settings","woocommerce")})})},primaryButton:{text:(0,s.__)("Got it","woocommerce")}},options:{classNames:{desktop:"woocommerce-revenue-report-date-tour"}}}],closeHandler:()=>{u({[e]:"yes"}),m(!0)}};return(0,l.jsx)(o.TourKit,{config:y})}},95272:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(66087);function s(e,t=[]){return(0,o.find)(t,{key:e})||t[0]}}}]);
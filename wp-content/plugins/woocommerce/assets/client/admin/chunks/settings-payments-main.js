"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[5712],{9845:(e,t,n)=>{n.d(t,{ZP:()=>a});var s=n(25209);const o=["a","b","em","i","strong","p","br"],i=["target","href","rel","name","download"],a=e=>({__html:(0,s.sanitize)(e,{ALLOWED_TAGS:o,ALLOWED_ATTR:i})})},5073:(e,t,n)=>{n.d(t,{l$:()=>u,My:()=>g,D2:()=>d,ls:()=>p}),n(97030);var s=n(65736),o=n(55609),i=n(69307),a=n(9818),c=n(67221),r=n(10431),l=n(14599),m=n(81514);const d=({gatewayId:e,gatewayState:t,settingsHref:n,onboardingHref:d,isOffline:_,acceptIncentive:u=()=>{},gatewayHasRecommendedPaymentMethods:g,installingPlugin:p,buttonText:h=(0,s.__)("Enable","woocommerce"),incentive:y=null})=>{const[v,w]=(0,i.useState)(!1),{createErrorNotice:x}=(0,a.dispatch)("core/notices"),{togglePaymentGateway:j,invalidateResolutionForStoreSelector:b}=(0,a.useDispatch)(c.paymentSettingsStore),f=()=>{x((0,s.__)("An error occurred. You will be redirected to the settings page, try enabling the payment gateway there.","woocommerce"),{type:"snackbar",explicitDismiss:!0})};return(0,m.jsx)(o.Button,{variant:"primary",isBusy:v,disabled:v||!!p,onClick:o=>{if(o.preventDefault(),t.enabled)return;(0,l.recordEvent)("settings_payments_provider_enable_click",{provider_id:e});const i=window.woocommerce_admin.nonces?.gateway_toggle||"";if(!i)return f(),void(window.location.href=n);w(!0),y&&u(y.promo_id),j(e,window.woocommerce_admin.ajax_url,i).then((o=>{if("needs_setup"===o.data)if(t.account_connected)x((0,s.__)("The provider could not be enabled. Check the Manage page for details.","woocommerce"),{type:"snackbar",explicitDismiss:!0,actions:[{label:(0,s.__)("Manage","woocommerce"),url:n}]});else{if((0,l.recordEvent)("settings_payments_provider_enable",{provider_id:e}),!g)return void(window.location.href=d);(0,r.getHistory)().push((0,r.getNewPath)({},"/payment-methods"))}b(_?"getOfflinePaymentGateways":"getPaymentProviders"),w(!1)})).catch((()=>{w(!1),f(),window.location.href=n}))},href:n,children:h})};var _=n(44443);const u=({acceptIncentive:e,installingPlugin:t,buttonText:n=(0,s.__)("Activate payments","woocommerce"),incentive:a=null})=>{const[c,r]=(0,i.useState)(!1);return(0,m.jsx)(o.Button,{variant:"primary",isBusy:c,disabled:c||!!t,onClick:()=>{r(!0),a&&e(a.promo_id),window.location.href=(0,_.vA)()},children:n})},g=({gatewayId:e,gatewayState:t,onboardingState:n,settingsHref:a,onboardingHref:c,gatewayHasRecommendedPaymentMethods:d,installingPlugin:_,buttonText:u=(0,s.__)("Complete setup","woocommerce")})=>{const[g,p]=(0,i.useState)(!1),h=t.account_connected,y=n.started,v=n.completed;return(0,m.jsx)(o.Button,{variant:"primary",isBusy:g,disabled:g||!!_,onClick:()=>{if((0,l.recordEvent)("settings_payments_provider_complete_setup_click",{provider_id:e,onboarding_started:n.started,onboarding_completed:n.completed,onboarding_test_mode:n.test_mode}),p(!0),h&&y)return h&&y&&!v?void(window.location.href=c):void(window.location.href=a);d?((0,r.getHistory)().push((0,r.getNewPath)({},"/payment-methods")),p(!1)):window.location.href=c},children:u},e)},p=({gatewayId:e,settingsHref:t,isInstallingPlugin:n,buttonText:i=(0,s.__)("Manage","woocommerce")})=>(0,m.jsx)(o.Button,{variant:"secondary",href:t,disabled:n,onClick:()=>{(0,l.recordEvent)("settings_payments_provider_manage_click",{provider_id:e})},children:i})},76456:(e,t,n)=>{n.r(t),n.d(t,{SettingsPaymentsMain:()=>ee,default:()=>te});var s=n(99196),o=n(65736),i=n(67221),a=n(9818),c=n(69307),r=n(86989),l=n.n(r),m=n(10431),d=n(14599),_=n(55609);function u(e){const{createNotice:t}=(0,a.dispatch)("core/notices");e.error_data&&e.errors&&Object.keys(e.errors).length?Object.keys(e.errors).forEach((n=>{t("error",e.errors[n].join(" "))})):e.message&&t(e.code?"error":"success",e.message)}var g=n(67878),p=n(22629),h=n(94333),y=n(81514);const v=()=>(0,y.jsxs)("div",{className:"other-payment-gateways__content__grid-item",children:[(0,y.jsx)("div",{className:"grid-item-placeholder__img"}),(0,y.jsxs)("div",{className:"other-payment-gateways__content__grid-item__content grid-item-placeholder__content",children:[(0,y.jsx)("span",{className:"grid-item-placeholder__title"}),(0,y.jsx)("span",{className:"grid-item-placeholder__description"}),(0,y.jsx)("div",{className:"grid-item-placeholder__actions"})]})]});var w=n(86020),x=n(91978);const j=({variant:e})=>{const[t,n]=(0,c.useState)(!1),s=(0,h.useDebounce)((()=>{n(!1)}),1e3);return(0,y.jsx)(w.Pill,{className:"woocommerce-official-extension-badge",children:(0,y.jsxs)("span",{className:"woocommerce-official-extension-badge__container",tabIndex:0,role:"button",onClick:()=>n(!t),onMouseEnter:()=>s.cancel(),onMouseLeave:s,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n(!t)},children:[(0,y.jsx)("img",{src:x.vm+"images/icons/official-extension.svg",alt:(0,o.__)("Official WooCommerce extension badge","woocommerce")}),"expanded"===e&&(0,y.jsx)("span",{children:(0,o.__)("Official","woocommerce")}),t&&(0,y.jsx)(_.Popover,{className:"woocommerce-official-extension-badge-popover",placement:"top-start",offset:4,variant:"unstyled",focusOnMount:!0,noArrow:!0,shift:!0,onClose:s,children:(0,y.jsx)("div",{className:"components-popover__content-container",children:(0,y.jsx)("p",{children:(0,c.createInterpolateElement)((0,o.__)("This is an Official WooCommerce payment extension. <learnMoreLink />","woocommerce"),{learnMoreLink:(0,y.jsx)(w.Link,{href:"https://woocommerce.com/learn-more-about-official-partner-badging/",target:"_blank",rel:"noreferrer",type:"external",children:(0,o.__)("Learn more","woocommerce")})})})})})]})})};var b=n(59550),f=n(33002);const N=({status:e,message:t,popoverContent:n})=>{const[s,i]=(0,c.useState)(!1),a=(0,h.useDebounce)((()=>{i(!1)}),1e3);return(0,y.jsxs)(w.Pill,{className:`woocommerce-status-badge ${(()=>{switch(e){case"active":case"has_incentive":return"woocommerce-status-badge--success";case"needs_setup":case"test_mode":case"test_account":return"woocommerce-status-badge--warning";case"recommended":case"inactive":return"woocommerce-status-badge--info";default:return""}})()}`,children:[t||(()=>{switch(e){case"active":return(0,o.__)("Active","woocommerce");case"inactive":return(0,o.__)("Inactive","woocommerce");case"needs_setup":return(0,o.__)("Action needed","woocommerce");case"test_mode":return(0,o.__)("Test mode","woocommerce");case"test_account":return(0,o.__)("Test account","woocommerce");case"recommended":return(0,o.__)("Recommended","woocommerce");default:return""}})(),n&&(0,y.jsxs)("span",{className:"woocommerce-status-badge__icon-container",onClick:()=>i(!s),onMouseEnter:()=>a.cancel(),onMouseLeave:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||i(!s)},tabIndex:0,role:"button",children:[(0,y.jsx)(b.Z,{className:"woocommerce-status-badge-icon",size:16,icon:f.Z}),s&&(0,y.jsx)(_.Popover,{className:"woocommerce-status-badge-popover",placement:"top-start",offset:6,variant:"unstyled",focusOnMount:!0,noArrow:!0,shift:!0,onClose:a,children:(0,y.jsx)("div",{className:"components-popover__content-container",children:n})})]})]})},k=({incentive:e})=>(0,y.jsx)(N,{status:"has_incentive",message:e.badge,popoverContent:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("p",{className:"woocommerce-incentive-popover__title",children:e.title}),(0,y.jsx)("p",{className:"woocommerce-incentive-popover__terms",children:(0,c.createInterpolateElement)((0,o.__)("See <termsLink /> for details.","woocommerce"),{termsLink:(0,y.jsx)(w.Link,{href:e.tc_url,target:"_blank",rel:"noreferrer",type:"external",children:(0,o.__)("Terms and Conditions","woocommerce")})})})]})}),P=({suggestions:e,suggestionCategories:t,installingPlugin:n,setupPlugin:s,isFetching:i,morePaymentOptionsLink:a})=>{const r="expanded"===new URLSearchParams(window.location.search).get("other_pes_section"),[l,m]=(0,c.useState)(r),[d,u]=(0,c.useState)(""),w=(0,h.useDebounce)((()=>{u("")}),1e3),x=(0,c.useMemo)((()=>t.map((t=>({category:t,suggestions:e.filter((e=>e._type===t.id))})))),[e,t]),b=(0,c.useMemo)((()=>i?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"other-payment-gateways__header__title-image-placeholder"}),(0,y.jsx)("div",{className:"other-payment-gateways__header__title-image-placeholder"}),(0,y.jsx)("div",{className:"other-payment-gateways__header__title-image-placeholder"})]}):x.map((({suggestions:e})=>0===e.length?null:e.map((e=>(0,y.jsx)("img",{src:e.icon,alt:e.title+" small logo",width:"24",height:"24",className:"other-payment-gateways__header__title-image"},e.id)))))),[x,i]),f=(0,c.useMemo)((()=>i?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(v,{}),(0,y.jsx)(v,{}),(0,y.jsx)(v,{})]}):x.map((({category:e,suggestions:t})=>0===t.length?null:(0,y.jsxs)("div",{className:"other-payment-gateways__content__category-container",children:[(0,y.jsxs)("div",{className:"other-payment-gateways__content__title",children:[(0,y.jsx)("h3",{className:"other-payment-gateways__content__title__h3",children:(0,p.decodeEntities)(e.title)}),(0,y.jsxs)("span",{className:"other-payment-gateways__content__title__icon-container",onClick:()=>u(e.id===d?"":e.id),onMouseEnter:()=>w.cancel(),onMouseLeave:w,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||u(e.id===d?"":e.id)},tabIndex:0,role:"button",children:[(0,y.jsx)(g.Z,{icon:"info-outline",className:"other-payment-gateways__content__title__icon"}),e.id===d&&(0,y.jsx)(_.Popover,{className:"other-payment-gateways__content__title-popover",placement:"top-start",offset:4,variant:"unstyled",focusOnMount:!0,noArrow:!0,shift:!0,onClose:w,children:(0,y.jsx)("div",{className:"components-popover__content-container",children:(0,y.jsx)("p",{children:(0,p.decodeEntities)(e.description)})})})]})]}),(0,y.jsx)("div",{className:"other-payment-gateways__content__grid",children:t.map((e=>(0,y.jsxs)("div",{className:"other-payment-gateways__content__grid-item",children:[(0,y.jsx)("img",{className:"other-payment-gateways__content__grid-item-image",src:e.icon,alt:(0,p.decodeEntities)(e.title)+" logo"}),(0,y.jsxs)("div",{className:"other-payment-gateways__content__grid-item__content",children:[(0,y.jsxs)("span",{className:"other-payment-gateways__content__grid-item__content__title",children:[e.title,e?._incentive&&(0,y.jsx)(k,{incentive:e._incentive}),(0,y.jsx)(j,{variant:"expanded"})]}),(0,y.jsx)("span",{className:"other-payment-gateways__content__grid-item__content__description",children:(0,p.decodeEntities)(e.description)}),(0,y.jsx)("div",{className:"other-payment-gateways__content__grid-item__content__actions",children:(0,y.jsx)(_.Button,{variant:"link",onClick:()=>{var t;return s(e.id,e.plugin.slug,null,"not_installed"===e.plugin.status&&null!==(t=e._links?.attach?.href)&&void 0!==t?t:null)},isBusy:n===e.id,disabled:!!n,children:n===e.id?(0,o.__)("Installing","woocommerce"):(0,o.__)("Install","woocommerce")})})]})]},e.id)))})]},e.id)))),[x,n,s,i,d]);return(0,y.jsxs)("div",{className:"other-payment-gateways"+(l?" is-expanded":""),children:[(0,y.jsxs)("div",{className:"other-payment-gateways__header",onClick:()=>{m(!l)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||m(!l)},role:"button",tabIndex:0,"aria-expanded":l,children:[(0,y.jsxs)("div",{className:"other-payment-gateways__header__title",children:[(0,y.jsx)("span",{children:(0,o.__)("Other payment options","woocommerce")}),!l&&(0,y.jsx)(y.Fragment,{children:b})]}),(0,y.jsx)(g.Z,{className:"other-payment-gateways__header__arrow",icon:l?"chevron-up":"chevron-down"})]}),l&&(0,y.jsxs)("div",{className:"other-payment-gateways__content",children:[f,(0,y.jsx)("div",{className:"other-payment-gateways__content__external-icon",children:a})]})]})};var S=n(80225),C=n(74617),E=n(55),I=n(28302),M=n(41708),T=n(58176),B=n(56592);const D=(e,t)=>{const n=t,{changes:s,type:o,props:i}=n,{items:a}=i,{selectedItem:c}=e;switch(o){case M.L7.stateChangeTypes.ItemClick:return{...s,isOpen:!0,highlightedIndex:e.highlightedIndex};case M.L7.stateChangeTypes.ToggleButtonKeyDownArrowDown:return{selectedItem:a[c?Math.min(a.indexOf(c)+1,a.length-1):0],isOpen:!0};case M.L7.stateChangeTypes.ToggleButtonKeyDownArrowUp:return{selectedItem:a[c?Math.max(a.indexOf(c)-1,0):a.length-1],isOpen:!0};default:return s}},L=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),O=({name:e,className:t,label:n,describedBy:i,options:a,onChange:r,value:l,placeholder:m,children:d})=>{var u;const[g,p]=(0,s.useState)(""),v=(0,h.useThrottle)((0,c.useCallback)(((e,t)=>new Set(t.filter((t=>{var n;return`${L(null!==(n=t.name)&&void 0!==n?n:"")}`.toLowerCase().includes(L(e.toLowerCase()))})))),[]),200),w=""!==g?null!==(u=v(g,a))&&void 0!==u?u:new Set:new Set(a),{getToggleButtonProps:j,getMenuProps:f,getItemProps:N,isOpen:k,highlightedIndex:P,selectedItem:C,closeMenu:E}=(0,M.L7)({initialSelectedItem:l,items:[...w],stateReducer:D}),I=((e,t)=>{const n=t.find((t=>t.key===e));return n?.name?n.name:""})(l.key,a),O=C?C.key:"",A=(0,s.useRef)(null),R=(0,s.useRef)(null),H=(0,c.useCallback)((e=>{const t=A.current,n=t?.querySelector(`[data-index="${e}"]`);n&&n.scrollIntoView({block:"nearest"})}),[A]),F=""!==g,W=f({className:"components-country-select-control__menu","aria-hidden":!k,ref:A}),Z=(0,c.useCallback)((e=>{e.stopPropagation(),r(O),E()}),[r,O,E]),U=(0,c.useCallback)((e=>{e.stopPropagation(),"Enter"===e.key&&r(O)}),[r,O]),K=(0,c.useCallback)((e=>{e.preventDefault(),""!==g&&p(""),null!==C&&setTimeout((()=>{H(a.indexOf(C))}),10)}),[g,C]);return(0,c.useEffect)((()=>{if(k&&null!==C){const e=Array.from(w).indexOf(C);H(e)}}),[k]),(0,y.jsxs)("div",{className:(0,S.Z)("woopayments components-country-select-control",t),children:[(0,y.jsxs)(_.Button,{...j({"aria-label":n,"aria-labelledby":void 0,"aria-describedby":i||(I?(0,o.sprintf)((0,o.__)("Currently selected: %s","woocommerce"),I):(0,o.__)("No selection","woocommerce")),className:(0,S.Z)("components-country-select-control__button",{placeholder:!I}),name:e,onKeyDown:U}),children:[(0,y.jsxs)("span",{className:"components-country-select-control__button-value",children:[(0,y.jsx)("span",{className:"components-country-select-control__label",children:n}),I||m]}),(0,y.jsx)(b.Z,{icon:T.Z,className:"components-custom-select-control__button-icon"})]}),(0,y.jsx)("div",{...W,children:k&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"components-country-select-control__search wc-settings-prevent-change-event",children:[(0,y.jsx)("input",{className:"components-country-select-control__search--input",ref:R,type:"text",value:g,onChange:({target:e})=>p(e.value),tabIndex:-1,placeholder:(0,o.__)("Search","woocommerce")}),(0,y.jsx)("button",{className:"components-country-select-control__search--input-suffix",onClick:K,children:(z=F,z?(0,y.jsx)("img",{src:x.vm+"images/icons/clear.svg",alt:(0,o.__)("Clear search","woocommerce")}):(0,y.jsx)("img",{src:x.vm+"images/icons/search.svg",alt:(0,o.__)("Search","woocommerce")}))})]}),(0,y.jsx)("div",{className:"components-country-select-control__list",children:[...w].map(((e,t)=>(0,s.createElement)("div",{...N({item:e,index:t,key:e.key,className:(0,S.Z)(e.className,"components-country-select-control__item",{"is-highlighted":t===P}),"data-index":t,style:e.style}),key:e.key},e.key===O&&(0,y.jsx)(b.Z,{icon:B.Z,className:"components-country-select-control__item-icon"}),d?d(e):e.name)))}),(0,y.jsx)("div",{className:"components-country-select-control__apply",children:(0,y.jsx)("button",{className:"components-button is-primary",onClick:Z,children:(0,o.__)("Apply","woocommerce")})})]})})]});var z};var A=n(4622),R=n(63021),H=n(44698),F=n(9845);const W=({providerId:e,pluginFile:t,isSuggestion:n,suggestionId:s,suggestionHideUrl:r="",onToggle:l,links:m=[],canResetAccount:u=!1,setResetAccountModalVisible:g=()=>{},isEnabled:p=!1})=>{const{deactivatePlugin:h}=(0,a.useDispatch)(i.pluginsStore),[v,w]=(0,c.useState)(!1),[x,j]=(0,c.useState)(!1),[b,f]=(0,c.useState)(!1),{invalidateResolutionForStoreSelector:N,togglePaymentGateway:k,hidePaymentExtensionSuggestion:P}=(0,a.useDispatch)(i.paymentSettingsStore),{createErrorNotice:S,createSuccessNotice:C}=(0,a.useDispatch)("core/notices"),E={pricing:(0,o.__)("See pricing & fees","woocommerce"),about:(0,o.__)("Learn more","woocommerce"),terms:(0,o.__)("See Terms of Service","woocommerce"),support:(0,o.__)("Get support","woocommerce"),documentation:(0,o.__)("View documentation","woocommerce")},I=m.filter((e=>{switch(e._type){case"pricing":return!0;case"terms":case"about":return!p;case"documentation":case"support":return p;default:return!1}}));return(0,y.jsxs)(y.Fragment,{children:[I.map((e=>{const t=E[e._type];return t?(0,y.jsx)("div",{className:"woocommerce-ellipsis-menu__content__item",children:(0,y.jsx)(_.Button,{target:"_blank",href:e.url,children:t})},e._type):null})),!!I.length&&(0,y.jsx)(_.CardDivider,{}),n&&(0,y.jsx)("div",{className:"woocommerce-ellipsis-menu__content__item",children:(0,y.jsx)(_.Button,{onClick:()=>{f(!0),(0,d.recordEvent)("settings_payments_recommendations_dismiss",{pes_id:s}),P(r).then((()=>{N("getPaymentProviders"),f(!1),l()})).catch((()=>{S((0,o.__)("Failed to hide the payment extension suggestion.","woocommerce")),f(!1),l()}))},isBusy:b,disabled:b,children:(0,o.__)("Hide suggestion","woocommerce")})},"hide-suggestion"),u&&(0,y.jsx)("div",{className:"woocommerce-ellipsis-menu__content__item",children:(0,y.jsx)(_.Button,{onClick:()=>{g(!0),l()},className:"components-button__danger",children:(0,o.__)("Reset account","woocommerce")})},"reset-account"),!n&&!p&&(0,y.jsx)("div",{className:"woocommerce-ellipsis-menu__content__item",children:(0,y.jsx)(_.Button,{className:"components-button__danger",onClick:()=>{w(!0),h(t).then((()=>{C((0,o.__)("Plugin was successfully deactivated.","woocommerce")),N("getPaymentProviders"),w(!1),l()})).catch((()=>{S((0,o.__)("Failed to deactivate the plugin.","woocommerce")),w(!1),l()}))},isBusy:v,disabled:v,children:(0,o.__)("Deactivate","woocommerce")})},"deactivate"),!n&&p&&(0,y.jsx)("div",{className:"woocommerce-ellipsis-menu__content__item",children:(0,y.jsx)(_.Button,{className:"components-button__danger",onClick:()=>{(0,d.recordEvent)("settings_payments_provider_disable_click",{provider_id:e});const t=window.woocommerce_admin.nonces?.gateway_toggle||"";t?(j(!0),k(e,window.woocommerce_admin.ajax_url,t).then((()=>{(0,d.recordEvent)("settings_payments_provider_disable",{provider_id:e}),N("getPaymentProviders"),j(!1),l()})).catch((()=>{S((0,o.__)("Failed to disable the plugin.","woocommerce")),j(!1),l()}))):S((0,o.__)("Failed to disable the plugin.","woocommerce"))},isBusy:x,disabled:x,children:(0,o.__)("Disable","woocommerce")})},"disable")]})};var Z=n(44443);const U=({isOpen:e,onClose:t,isTestMode:n})=>{const[s,i]=(0,c.useState)(!1);return(0,y.jsx)(y.Fragment,{children:e&&(0,y.jsxs)(_.Modal,{title:(0,o.__)("Reset your test account","woocommerce"),className:"woocommerce-woopayments-modal",isDismissible:!0,onRequestClose:t,children:[(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content",children:[(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__content__item",children:(0,y.jsx)("div",{children:(0,y.jsx)("span",{children:n?(0,o.sprintf)((0,o.__)("When you reset your test account, all payment data — including your %s account details, test transactions, and payouts history — will be lost. Your order history will remain. This action cannot be undone, but you can create a new test account at any time.","woocommerce"),"WooPayments"):(0,o.sprintf)((0,o.__)("When you reset your account, all payment data — including your %s account details, test transactions, and payouts history — will be lost. Your order history will remain. This action cannot be undone, but you can create a new test account at any time.","woocommerce"),"WooPayments")})})}),(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__content__item",children:(0,y.jsx)("h3",{children:(0,o.__)("Are you sure you'd like to continue?","woocommerce")})})]}),(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__actions",children:(0,y.jsx)(_.Button,{className:"danger",variant:"secondary",isBusy:s,disabled:s,onClick:()=>{i(!0),window.location.href=(0,Z.Pq)()},children:(0,o.__)("Yes, reset account","woocommerce")})})]})})},K=({isOpen:e,devMode:t,onClose:n})=>{const[s,i]=(0,c.useState)(!1),[a,r]=(0,c.useState)(!1);return(0,y.jsx)(y.Fragment,{children:e&&(0,y.jsxs)(_.Modal,{title:(0,o.__)("You're ready to test payments!","woocommerce"),className:"woocommerce-woopayments-modal",isDismissible:!0,onRequestClose:n,children:[(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content",children:[(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__content__item",children:(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__content__item__description",children:(0,y.jsx)("p",{children:(0,I.Z)({mixedString:(0,o.__)("We've created a test account for you so that you can begin testing payments on your store. {{break/}}Not sure what to test? Take a look at {{link}}how to test payments{{/link}}.","woocommerce"),components:{link:(0,y.jsx)(w.Link,{href:"https://woocommerce.com/document/woopayments/testing-and-troubleshooting/sandbox-mode/",target:"_blank",rel:"noreferrer",type:"external"}),break:(0,y.jsx)("br",{})}})})})}),(0,y.jsx)("div",{className:"woocommerce-woopayments-modal__content__item",children:(0,y.jsx)("h2",{children:(0,o.__)("What's next:","woocommerce")})}),(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content__item-flex",children:[(0,y.jsx)("img",{src:x.vm+"images/icons/store.svg",alt:"store icon"}),(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content__item-flex__description",children:[(0,y.jsx)("h3",{children:(0,o.__)("Continue your store setup","woocommerce")}),(0,y.jsx)("div",{children:(0,o.__)("Finish completing the tasks required to launch your store.","woocommerce")})]})]}),!t&&(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content__item-flex",children:[(0,y.jsx)("img",{src:x.vm+"images/icons/dollar.svg",alt:"dollar icon"}),(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__content__item-flex__description",children:[(0,y.jsx)("h3",{children:(0,o.__)("Activate payments","woocommerce")}),(0,y.jsx)("div",{children:(0,y.jsx)("p",{children:(0,I.Z)({mixedString:(0,o.__)("Provide some additional details about your business so you can being accepting real payments. {{link}}Learn more{{/link}}","woocommerce"),components:{link:(0,y.jsx)(w.Link,{href:"https://woocommerce.com/document/woopayments/startup-guide/#sign-up-process",target:"_blank",rel:"noreferrer",type:"external"})}})})})]})]})]}),(0,y.jsxs)("div",{className:"woocommerce-woopayments-modal__actions",children:[(0,y.jsx)(_.Button,{variant:"primary",isBusy:a,disabled:a,onClick:()=>{(0,d.recordEvent)("settings_payments_continue_store_setup_click",{provider_id:"woocommerce_payments"}),r(!0),window.location.href=(0,C.getAdminLink)("admin.php?page=wc-admin")},children:(0,o.__)("Continue store setup","woocommerce")}),!t&&(0,y.jsx)(_.Button,{variant:"secondary",isBusy:s,disabled:s,onClick:()=>{(0,d.recordEvent)("settings_payments_switch_to_live_account_click",{provider_id:"woocommerce_payments"}),i(!0),window.location.href=(0,Z.vA)()},children:(0,o.__)("Activate payments","woocommerce")})]})]})})},z=({provider:e,label:t})=>{const[n,s]=(0,c.useState)(!1),o=(0,Z.mz)(e.id)&&"gateway"===e._type&&e.state?.account_connected&&(e.onboarding?.state.test_mode||!e.onboarding?.state.completed);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(w.EllipsisMenu,{label:t,renderContent:({onToggle:t})=>(0,y.jsx)(W,{providerId:e.id,pluginFile:e.plugin.file,isSuggestion:"suggestion"===e._type,suggestionId:"suggestion"===e._type?e._suggestion_id:void 0,suggestionHideUrl:"suggestion"===e._type?e._links?.hide?.href:"",links:e.links,onToggle:t,isEnabled:e.state?.enabled,canResetAccount:o,setResetAccountModalVisible:s}),focusOnMount:!0}),(0,y.jsx)(U,{isOpen:n,onClose:()=>s(!1),isTestMode:e.onboarding?.state.test_mode})]})},G=({extension:e,installingPlugin:t,setupPlugin:n,pluginInstalled:s,acceptIncentive:i,shouldHighlightIncentive:a,...c})=>{const r=(0,Z.Kr)(e)?e._incentive:null;let l=(0,o.__)("Install","woocommerce");return s?l=(0,o.__)("Enable","woocommerce"):t===e.id&&(l=(0,o.__)("Installing","woocommerce")),(0,y.jsx)("div",{id:e.id,className:"transitions-disabled woocommerce-list__item woocommerce-list__item-enter-done "+((0,Z.Kr)(e)&&a?"has-incentive":""),...c,children:(0,y.jsxs)("div",{className:"woocommerce-list__item-inner",children:[(0,y.jsxs)("div",{className:"woocommerce-list__item-before",children:[(0,y.jsx)(R.mR,{}),e.icon&&(0,y.jsx)("img",{className:"woocommerce-list__item-image",src:e.icon,alt:e.title+" logo"})]}),(0,y.jsxs)("div",{className:"woocommerce-list__item-text",children:[(0,y.jsxs)("span",{className:"woocommerce-list__item-title",children:[e.title," ",!(0,Z.Kr)(e)&&(0,Z.mz)(e.id)&&(0,y.jsx)(N,{status:"recommended"}),r&&(0,y.jsx)(k,{incentive:r}),(0,y.jsx)(j,{variant:"expanded"})]}),(0,y.jsx)("span",{className:"woocommerce-list__item-content",dangerouslySetInnerHTML:(0,F.ZP)((0,p.decodeEntities)(e.description))}),(0,Z.mz)(e.id)&&(0,y.jsx)(H.WooPaymentsMethodsLogos,{maxElements:10,tabletWidthBreakpoint:1080,mobileWidthBreakpoint:768,isWooPayEligible:(0,Z.Gf)(e)})]}),(0,y.jsx)("div",{className:"woocommerce-list__item-buttons",children:(0,y.jsx)("div",{className:"woocommerce-list__item-buttons__actions",children:(0,y.jsx)(_.Button,{variant:"primary",onClick:()=>{var t,o;s&&(0,d.recordEvent)("settings_payments_provider_enable_click",{provider_id:e.id}),r&&i(r.promo_id),n(e.id,e.plugin.slug,null!==(t=e.onboarding?._links.onboard.href)&&void 0!==t?t:null,s?null:null!==(o=e._links?.attach?.href)&&void 0!==o?o:null)},isBusy:t===e.id,disabled:!!t,children:l})})}),(0,y.jsx)("div",{className:"woocommerce-list__item-after",children:(0,y.jsx)("div",{className:"woocommerce-list__item-after__actions",children:(0,y.jsx)(z,{label:(0,o.__)("Payment Provider Options","woocommerce"),provider:e})})})]})})};var $=n(5073);const Y=({buttonText:e=(0,o.__)("Reactivate payments","woocommerce"),settingsHref:t})=>{const[n,s]=(0,c.useState)(!1),{createSuccessNotice:r,createErrorNotice:m}=(0,a.dispatch)("core/notices"),{invalidateResolutionForStoreSelector:d}=(0,a.useDispatch)(i.paymentSettingsStore);return(0,y.jsx)(_.Button,{variant:"primary",isBusy:n,disabled:n,onClick:e=>{e.preventDefault(),s(!0),l()({path:"/wc/v3/payments/settings",method:"POST",data:{is_test_mode_enabled:!1}}).then((()=>{r((0,o.sprintf)((0,o.__)("%s is now processing live payments (real payment methods and charges).","woocommerce"),"WooPayments"),{type:"snackbar",explicitDismiss:!1}),d("getPaymentProviders"),s(!1)})).catch((()=>{s(!1),m((0,o.sprintf)((0,o.__)("An error occurred. You will be redirected to the %s settings page to manage payments processing mode from there.","woocommerce"),"WooPayments"),{type:"snackbar",explicitDismiss:!0}),window.location.href=t}))},href:t,children:e})},q=({gateway:e,installingPlugin:t,acceptIncentive:n,shouldHighlightIncentive:s,...i})=>{var a;const c=(0,Z.mz)(e.id),r=(0,Z.Kr)(e)?e._incentive:null,l=(null!==(a=e.onboarding.recommended_payment_methods)&&void 0!==a?a:[]).length>0,m=!e.state.account_connected||e.state.account_connected&&!e.onboarding.state.started||e.state.account_connected&&e.onboarding.state.started&&!e.onboarding.state.completed;return(0,y.jsx)("div",{id:e.id,className:`transitions-disabled woocommerce-list__item woocommerce-list__item-enter-done woocommerce-item__payment-gateway ${c?"woocommerce-item__woocommerce-payments":""} ${(0,Z.Kr)(e)&&s?"has-incentive":""}`,...i,children:(0,y.jsxs)("div",{className:"woocommerce-list__item-inner",children:[(0,y.jsxs)("div",{className:"woocommerce-list__item-before",children:[(0,y.jsx)(R.mR,{}),e.icon&&(0,y.jsx)("img",{className:"woocommerce-list__item-image",src:e.icon,alt:e.title+" logo"})]}),(0,y.jsxs)("div",{className:"woocommerce-list__item-text",children:[(0,y.jsxs)("span",{className:"woocommerce-list__item-title",children:[e.title,r?(0,y.jsx)(k,{incentive:r}):(0,y.jsx)(N,{status:!e.state.enabled&&e.state.needs_setup?"needs_setup":e.state.enabled?e.onboarding.state.test_mode?"test_account":e.state.test_mode?"test_mode":"active":"inactive"}),e._suggestion_id&&(0,y.jsx)(j,{variant:"expanded"}),e.supports?.includes("subscriptions")&&(0,y.jsx)(_.Tooltip,{placement:"top",text:(0,o.__)("Supports recurring payments","woocommerce"),children:(0,y.jsx)("img",{className:"woocommerce-list__item-recurring-payments-icon",src:x.vm+"images/icons/recurring-payments.svg",alt:(0,o.__)("Icon to indicate support for recurring payments","woocommerce")})})]}),(0,y.jsx)("span",{className:"woocommerce-list__item-content",dangerouslySetInnerHTML:(0,F.ZP)((0,p.decodeEntities)(e.description))}),c&&(0,y.jsx)(H.WooPaymentsMethodsLogos,{maxElements:10,tabletWidthBreakpoint:1080,mobileWidthBreakpoint:768,isWooPayEligible:(0,Z.Gf)(e)})]}),(0,y.jsx)("div",{className:"woocommerce-list__item-buttons",children:(0,y.jsxs)("div",{className:"woocommerce-list__item-buttons__actions",children:[!e.state.enabled&&!m&&(0,y.jsx)($.D2,{gatewayId:e.id,gatewayState:e.state,settingsHref:e.management._links.settings.href,onboardingHref:e.onboarding._links.onboard.href,isOffline:!1,gatewayHasRecommendedPaymentMethods:l,installingPlugin:t,incentive:r,acceptIncentive:n}),!m&&(0,y.jsx)($.ls,{gatewayId:e.id,settingsHref:e.management._links.settings.href,isInstallingPlugin:!!t}),m&&(0,y.jsx)($.My,{gatewayId:e.id,gatewayState:e.state,onboardingState:e.onboarding.state,settingsHref:e.management._links.settings.href,onboardingHref:e.onboarding._links.onboard.href,gatewayHasRecommendedPaymentMethods:l,installingPlugin:t}),(0,Z.mz)(e.id)&&!e.state.dev_mode&&e.state.account_connected&&e.onboarding.state.completed&&e.onboarding.state.test_mode&&(0,y.jsx)($.l$,{acceptIncentive:n,installingPlugin:t,incentive:r}),(0,Z.mz)(e.id)&&!e.state.dev_mode&&e.state.account_connected&&e.onboarding.state.completed&&!e.onboarding.state.test_mode&&e.state.test_mode&&(0,y.jsx)(Y,{settingsHref:e.management._links.settings.href})]})}),(0,y.jsx)("div",{className:"woocommerce-list__item-after",children:(0,y.jsx)("div",{className:"woocommerce-list__item-after__actions",children:(0,y.jsx)(z,{label:(0,o.__)("Payment Provider Options","woocommerce"),provider:e})})})]})})},J=({providers:e,installedPluginSlugs:t,installingPlugin:n,setupPlugin:s,acceptIncentive:o,shouldHighlightIncentive:a,updateOrdering:c})=>(0,y.jsx)(R.JN,{items:e,className:"settings-payment-gateways__list",setItems:c,children:e.map((e=>{switch(e._type){case i.PaymentProviderType.Suggestion:const c=e,r=t.includes(e.plugin.slug);return(0,y.jsx)(R.TR,{id:c.id,children:G({extension:c,installingPlugin:n,setupPlugin:s,pluginInstalled:r,acceptIncentive:o,shouldHighlightIncentive:a})},c.id);case i.PaymentProviderType.Gateway:const l=e;return(0,y.jsx)(R.TR,{id:e.id,children:q({gateway:l,installingPlugin:n,acceptIncentive:o,shouldHighlightIncentive:a})},e.id);case i.PaymentProviderType.OfflinePmsGroup:const m=e;return(0,y.jsx)(R.TR,{id:m.id,children:(0,y.jsx)("div",{id:m.id,className:"transitions-disabled woocommerce-list__item clickable-list-item enter-done",onClick:()=>{window.location.href=m.management._links.settings.href},children:(0,y.jsxs)("div",{className:"woocommerce-list__item-inner",children:[(0,y.jsxs)("div",{className:"woocommerce-list__item-before",children:[(0,y.jsx)(R.mR,{}),(0,y.jsx)("img",{src:m.icon,alt:m.title+" logo"})]}),(0,y.jsxs)("div",{className:"woocommerce-list__item-text",children:[(0,y.jsx)("span",{className:"woocommerce-list__item-title",children:m.title}),(0,y.jsx)("span",{className:"woocommerce-list__item-content",dangerouslySetInnerHTML:{__html:m.description}})]}),(0,y.jsx)("div",{className:"woocommerce-list__item-after centered no-buttons",children:(0,y.jsx)("div",{className:"woocommerce-list__item-after__actions",children:(0,y.jsx)("a",{className:"woocommerce-list__item-after__actions__arrow",href:m.management._links.settings.href,children:(0,y.jsx)(g.Z,{icon:"chevron-right"})})})})]})})},m.id);default:return null}}))}),V=({providers:e,installedPluginSlugs:t,installingPlugin:n,setupPlugin:s,acceptIncentive:r,shouldHighlightIncentive:m,updateOrdering:u,isFetching:g,businessRegistrationCountry:v,setBusinessRegistrationCountry:x})=>{var j;const{invalidateResolution:b}=(0,a.useDispatch)(i.paymentSettingsStore),[f,N]=(0,c.useState)(!1),k=(window.wcSettings?.admin?.preloadSettings?.general?.woocommerce_default_country||"US").split(":")[0],P=(0,c.useMemo)((()=>Object.entries(window.wcSettings.countries||[]).map((([e,t])=>({key:e,name:(0,p.decodeEntities)(t),types:[]}))).sort(((e,t)=>e.name.localeCompare(t.name)))),[]),M=k!==v,T=(0,S.Z)("settings-payment-gateways__header-select-container",{"has-alert":M}),B=(0,h.useDebounce)((()=>{N(!1)}),350);return(0,y.jsxs)("div",{className:"settings-payment-gateways",children:[(0,y.jsxs)("div",{className:"settings-payment-gateways__header",children:[(0,y.jsx)("div",{className:"settings-payment-gateways__header-title",children:(0,o.__)("Payment providers","woocommerce")}),(0,y.jsxs)("div",{className:T,children:[(0,y.jsx)(O,{className:"woocommerce-select-control__country",label:(0,o.__)("Business location:","woocommerce"),placeholder:"",value:null!==(j=P.find((e=>e.key===v)))&&void 0!==j?j:{key:"US",name:"United States (US)"},options:P,onChange:e=>{l()({path:i.WC_ADMIN_NAMESPACE+"/settings/payments/country",method:"POST",data:{location:e}}).then((()=>{const t=v,n=e;(0,d.recordEvent)("settings_payments_business_location_update",{old_location:t,new_location:n}),x(e),b("getPaymentProviders",[e])}))}}),M&&(0,y.jsxs)("div",{className:"settings-payment-gateways__header-select-container--indicator",tabIndex:0,role:"button",onClick:()=>N(!f),onMouseEnter:()=>{N(!0),B.cancel()},onMouseLeave:B,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||N(!f)},children:[(0,y.jsx)("div",{className:"settings-payment-gateways__header-select-container--indicator-icon",children:(0,y.jsx)(E.Z,{})}),f&&(0,y.jsx)(_.Popover,{className:"settings-payment-gateways__header-select-container--indicator-popover",placement:"top-end",offset:4,variant:"unstyled",focusOnMount:!0,noArrow:!0,shift:!0,onClose:B,children:(0,y.jsx)("div",{className:"components-popover__content-container",children:(0,y.jsx)("p",{children:(0,I.Z)({mixedString:(0,o.__)("Your business location does not match your store location. {{link}}Edit store location.{{/link}}","woocommerce"),components:{link:(0,y.jsx)(w.Link,{href:(0,C.getAdminLink)("admin.php?page=wc-settings&tab=general"),target:"_blank",type:"external"})}})})})})]})]})]}),g?(0,y.jsx)(A.a,{rows:5}):(0,y.jsx)(J,{providers:e,installedPluginSlugs:t,installingPlugin:n,setupPlugin:s,acceptIncentive:r,shouldHighlightIncentive:m,updateOrdering:u})]})},Q=({incentive:e,provider:t,onboardingUrl:n,onDismiss:i,onAccept:a,setupPlugin:r})=>{const[l,m]=(0,c.useState)(!1),[u,g]=(0,c.useState)(!1),[p,h]=(0,c.useState)(!1),v="wc_settings_payments__banner";return(0,s.useEffect)((()=>{(0,d.recordEvent)("settings_payments_incentive_show",{incentive_id:e.promo_id,provider_id:t.id,display_context:v})}),[e.promo_id,t.id]),l||(0,Z.o0)(e,v)||u?null:(0,y.jsx)(_.Card,{className:"woocommerce-incentive-banner",isRounded:!0,children:(0,y.jsxs)("div",{className:"woocommerce-incentive-banner__content",children:[(0,y.jsx)("div",{className:"woocommerce-incentive-banner__image",children:(0,y.jsx)("img",{src:x.vm+"images/settings-payments/incentives-illustration.svg",alt:(0,o.__)("Incentive illustration","woocommerce")})}),(0,y.jsxs)(_.CardBody,{className:"woocommerce-incentive-banner__body",children:[(0,y.jsx)(N,{status:"has_incentive",message:(0,o.__)("Limited time offer","woocommerce")}),(0,y.jsxs)("div",{className:"woocommerce-incentive-banner__copy",children:[(0,y.jsx)("h2",{children:e.title}),(0,y.jsx)("p",{children:e.description})]}),(0,y.jsx)("div",{className:"woocommerce-incentive-banner__terms",children:(0,c.createInterpolateElement)((0,o.__)("See <termsLink /> for details.","woocommerce"),{termsLink:(0,y.jsx)(w.Link,{href:e.tc_url,target:"_blank",rel:"noreferrer",type:"external",children:(0,o.__)("Terms and Conditions","woocommerce")})})}),(0,y.jsxs)("div",{className:"woocommerce-incentive-banner__actions",children:[(0,y.jsx)(_.Button,{variant:"primary",isBusy:l,disabled:l,onClick:()=>{var s;(0,d.recordEvent)("settings_payments_incentive_accept",{incentive_id:e.promo_id,provider_id:t.id,display_context:v}),h(!0),a(e.promo_id),i(e._links.dismiss.href,v),m(!0),r(t.id,t.plugin.slug,n,"not_installed"===t.plugin.status&&null!==(s=t._links?.attach?.href)&&void 0!==s?s:null),h(!1)},children:e.cta_label}),(0,y.jsx)(_.Button,{variant:"tertiary",isBusy:p,disabled:p,onClick:()=>{(0,d.recordEvent)("settings_payments_incentive_dismiss",{incentive_id:e.promo_id,provider_id:t.id,display_context:v}),h(!0),i(e._links.dismiss.href,v),h(!1),g(!0)},children:(0,o.__)("Dismiss","woocommerce")})]})]})]})})},X=({incentive:e,provider:t,onboardingUrl:n,onAccept:i,onDismiss:a,setupPlugin:r})=>{const[l,m]=(0,c.useState)(!1),[u,g]=(0,c.useState)(!0),p="wc_settings_payments__modal",h=(0,Z.o0)(e,p);(0,s.useEffect)((()=>{(0,d.recordEvent)("settings_payments_incentive_show",{incentive_id:e.promo_id,provider_id:t.id,display_context:p})}),[e.promo_id,t.id]);const v=()=>{g(!1)};return h?null:(0,y.jsx)(y.Fragment,{children:u&&(0,y.jsx)(_.Modal,{title:"",className:"woocommerce-incentive-modal",onRequestClose:()=>{(0,d.recordEvent)("settings_payments_incentive_dismiss",{incentive_id:e.promo_id,provider_id:t.id,display_context:p}),a(e._links.dismiss.href,p),v()},children:(0,y.jsx)(_.Card,{className:"woocommerce-incentive-modal__card",children:(0,y.jsxs)("div",{className:"woocommerce-incentive-modal__content",children:[(0,y.jsx)(_.CardMedia,{className:"woocommerce-incentive-modal__media",children:(0,y.jsx)("img",{src:x.vm+"images/settings-payments/incentives-illustration.svg",alt:(0,o.__)("Incentive illustration","woocommerce")})}),(0,y.jsxs)(_.CardBody,{className:"woocommerce-incentive-modal__body",children:[(0,y.jsx)("div",{children:(0,y.jsx)(N,{status:"has_incentive",message:(0,o.__)("Limited time offer","woocommerce")})}),(0,y.jsx)("h2",{children:e.title}),(0,y.jsx)("p",{children:e.description}),(0,y.jsx)("p",{className:"woocommerce-incentive-modal__terms",children:(0,c.createInterpolateElement)((0,o.__)("See <termsLink /> for details.","woocommerce"),{termsLink:(0,y.jsx)(w.Link,{href:e.tc_url,target:"_blank",rel:"noreferrer",type:"external",children:(0,o.__)("Terms and Conditions","woocommerce")})})}),(0,y.jsx)("div",{className:"woocommerce-incentive-model__actions",children:(0,y.jsx)(_.Button,{variant:"primary",isBusy:l,disabled:l,onClick:()=>{var s;(0,d.recordEvent)("settings_payments_incentive_accept",{incentive_id:e.promo_id,provider_id:t.id,display_context:p}),m(!0),i(e.promo_id),a(e._links.dismiss.href,p),v(),r(t.id,t.plugin.slug,n,"not_installed"===t.plugin.status&&null!==(s=t._links?.attach?.href)&&void 0!==s?s:null),m(!1)},children:e.cta_label})})]})]})})})})},ee=()=>{var e,t;const[n,r]=(0,c.useState)(null),[g,p]=(0,c.useState)(null),{installAndActivatePlugins:h}=(0,a.useDispatch)(i.pluginsStore),{updateProviderOrdering:v,attachPaymentExtensionSuggestion:w}=(0,a.useDispatch)(i.paymentSettingsStore),[j,b]=(0,c.useState)(null),[f,N]=(0,c.useState)(!1),[k,S]=(0,c.useState)(window.wcSettings?.admin?.woocommerce_payments_nox_profile?.business_country_code||null),C=(0,x.O3)("wcAdminAssetUrl");(0,c.useEffect)((()=>{(0,d.recordEvent)("settings_payments_pageview");const e=new URLSearchParams(window.location.search);"true"===e.get("test_drive_error")&&b((0,o.sprintf)((0,o.__)("%s: An error occurred while setting up your sandbox account — please try again.","woocommerce"),"WooPayments")),"1"===e.get("wcpay-connect-jetpack-error")&&b((0,o.sprintf)((0,o.__)("%s: There was a problem connecting your WordPress.com account — please try again.","woocommerce"),"WooPayments")),"true"===e.get("wcpay-sandbox-success")&&N(!0)}),[]);const E=(0,a.useSelect)((e=>e(i.pluginsStore).getInstalledPlugins()),[]),{invalidateResolutionForStoreSelector:I}=(0,a.useDispatch)(i.paymentSettingsStore),{providers:M,offlinePaymentGateways:T,suggestions:B,suggestionCategories:D,isFetching:L}=(0,a.useSelect)((e=>{const t=e(i.paymentSettingsStore);return{providers:t.getPaymentProviders(k),offlinePaymentGateways:t.getOfflinePaymentGateways(),suggestions:t.getSuggestions(),suggestionCategories:t.getSuggestionCategories(),isFetching:t.isFetching()}}),[k]),O=(0,s.useCallback)(((e,t)=>{l()({url:e,method:"POST",data:{context:t}})}),[]),A=(0,s.useCallback)((e=>{l()({path:`/wc-analytics/admin/notes/experimental-activate-promo/${e}`,method:"POST"})}),[]);(0,c.useEffect)((()=>{p(null)}),[M]);const R=M.find((e=>"_incentive"in e)),H=R?R._incentive:null;let F=!1,W=!1,U=!1;if(R&&H)if((0,Z.NI)(H))if((0,Z.o0)(H,"wc_settings_payments__modal")){if(!(0,Z.o0)(H,"wc_settings_payments__banner")){const e=new Date;e.setDate(e.getDate()-30),(0,Z.Jz)(H,"wc_settings_payments__modal",e.getTime())?W=!0:U=!0}}else F=!0;else(0,Z.Ir)(H)&&((0,Z.o0)(H,"wc_settings_payments__banner")?U=!0:W=!0);const z=(0,s.useRef)(!1);(0,c.useEffect)((()=>{if(L||!M.length||!B.length||z.current)return;z.current=!0;const e={woocommerce_payments_displayed:M.some((e=>(0,Z.mz)(e.id)))};B.forEach((t=>{e[t.id.replace(/-/g,"_")+"_displayed"]=!0})),M.filter((e=>"suggestion"===e._type)).forEach((t=>{t._suggestion_id?e[t._suggestion_id.replace(/-/g,"_")+"_displayed"]=!0:t.plugin&&t.plugin.slug&&(e[t.plugin.slug.replace(/-/g,"_")+"_displayed"]=!0)})),(0,d.recordEvent)("settings_payments_recommendations_pageview",e)}),[B,M,L]);const G=(0,s.useCallback)(((e,t,s,o)=>{n||(!s&&(0,Z.mz)(e)&&(s=(0,Z.SN)()),r(e),(0,d.recordEvent)("settings_payments_recommendations_setup",{extension_selected:t}),h([t]).then((async n=>{var c;o&&w(o),u(n),I("getPaymentProviders"),(0,d.recordEvent)("settings_payments_provider_installed",{provider_id:e});const l=(await(0,a.resolveSelect)(i.paymentSettingsStore).getPaymentProviders(k)).find((n=>n.id===e||n?._suggestion_id===e||n.plugin.slug===t));if((0,d.recordEvent)("settings_payments_provider_enable",{provider_id:e}),(null!==(c=l?.onboarding?.recommended_payment_methods)&&void 0!==c?c:[]).length>0)return(0,m.getHistory)().push((0,m.getNewPath)({},"/payment-methods")),void r(null);r(null),s&&(window.location.href=s)})).catch((e=>{u(e),r(null)})))}),[n,h,I,k]),$=(0,y.jsxs)(_.Button,{variant:"link",target:"_blank",href:"https://woocommerce.com/product-category/woocommerce-extensions/payment-gateways/",className:"more-payment-options-link",onClick:()=>{const e=M.map((e=>e.plugin&&e.plugin.slug?e.plugin.slug.replace(/-/g,"_"):e._suggestion_id?e._suggestion_id.replace(/-/g,"_"):e.id));T.forEach((t=>{e.push(t.id)})),B.forEach((t=>{t.plugin&&t.plugin.slug?e.push(t.plugin.slug.replace(/-/g,"_")):e.push(t.id.replace(/-/g,"_"))}));const t=[...new Set(e)];(0,d.recordEvent)("settings_payments_recommendations_other_options",{available_payment_methods:t.join(", ")})},children:[(0,y.jsx)("img",{src:C+"/icons/external-link.svg",alt:""}),(0,o.__)("More payment options","woocommerce")]});return(0,y.jsxs)(y.Fragment,{children:[F&&R&&H&&(0,y.jsx)(X,{incentive:H,provider:R,onboardingUrl:null!==(e=R.onboarding?._links.onboard.href)&&void 0!==e?e:null,onDismiss:O,onAccept:A,setupPlugin:G}),j&&(0,y.jsxs)("div",{className:"notice notice-error is-dismissible wcpay-settings-notice",children:[(0,y.jsx)("p",{children:j}),(0,y.jsx)("button",{type:"button",className:"notice-dismiss",onClick:()=>{b(null)}})]}),W&&R&&H&&(0,y.jsx)(Q,{incentive:H,provider:R,onboardingUrl:null!==(t=R.onboarding?._links.onboard.href)&&void 0!==t?t:null,onDismiss:O,onAccept:A,setupPlugin:G}),(0,y.jsxs)("div",{className:"settings-payments-main__container",children:[(0,y.jsx)(V,{providers:g||M,installedPluginSlugs:E,installingPlugin:n,setupPlugin:G,acceptIncentive:A,shouldHighlightIncentive:U,updateOrdering:function(e){const t=e.map((e=>e._order)).sort(((e,t)=>e-t)),n={};e.forEach(((e,s)=>{n[e.id]=t[s]})),v(n),p(e)},isFetching:L,businessRegistrationCountry:k,setBusinessRegistrationCountry:S}),!L&&0===B.length&&(0,y.jsx)("div",{className:"more-payment-options",children:$}),(L||B.length>0)&&(0,y.jsx)(P,{suggestions:B,suggestionCategories:D,installingPlugin:n,setupPlugin:G,isFetching:L,morePaymentOptionsLink:$})]}),(0,y.jsx)(K,{isOpen:f&&(0,Z.eP)(M),devMode:(0,Z.Av)(M),onClose:()=>N(!1)})]})},te=ee}}]);
"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[6424],{36736:(e,t,r)=>{r.d(t,{Y:()=>A});var o=r(27723),a=r(38443),s=r(56427),c=r(47143),n=r(40314),l=r(86087),i=r(1455),d=r.n(i);const m=5e3;var u=r(39793);function _(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:i}=function(){const[e,t]=(0,l.useState)(null),[r,a]=(0,l.useState)(!0),[s,c]=(0,l.useState)(null),[n,i]=(0,l.useState)(!1),u=(0,l.useRef)(null),_=(0,l.useCallback)((async()=>{try{const e=await d()({path:"/wc-analytics/imports/status",method:"GET"});t(e),c(null)}catch(e){c(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{a(!1)}}),[]),p=(0,l.useCallback)((async()=>{i(!0);try{await d()({path:"/wc-analytics/imports/trigger",method:"POST"}),await _()}catch(e){throw c(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{i(!1)}}),[_]);return(0,l.useEffect)((()=>{_()}),[_]),(0,l.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(_,m):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,_]),{status:e,isLoading:r,error:s,triggerImport:p,isTriggeringImport:n}}(),{createNotice:_}=(0,c.useDispatch)("core/notices"),{wcAdminSettings:p}=(0,n.useSettings)("wc_admin",["wcAdminSettings"]);if(!p?.woocommerce_analytics_scheduled_import||"no"===p.woocommerce_analytics_scheduled_import)return null;const w=e?.import_in_progress_or_due||i;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||i,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(y=e?.last_processed_date||null,y?(0,a.dateI18n)("M j H:i",y,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(e=>e?(0,a.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(s.Button,{variant:"tertiary",onClick:async()=>{try{await r(),_("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){_("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||w,"aria-disabled":t||w,"aria-busy":w,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":w?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:w?(0,u.jsx)(s.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var y}var p=r(29491),w=r(66087),y=r(27752),h=r(98846),f=r(77374),b=r(83306),g=r(94111),v=r(56109);class S extends l.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,b.recordEvent)("datepicker_update",{report:t,...(0,w.omitBy)(e,w.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const a={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(a.filter_variation=e["filter-variations"]||"all"),(0,b.recordEvent)("analytics_filter",a)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,b.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,b.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,w.snakeCase)(r)]=t[r],e)),{});o(),(0,b.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,b.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,b.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:a,defaultDateRange:s}=this.props,{period:c,compare:n,before:l,after:i}=(0,f.getDateParamsFromQuery)(o,s),{primary:d,secondary:m}=(0,f.getCurrentDates)(o,s),_={period:c,compare:n,before:l,after:i,primaryDate:d,secondaryDate:m},p=this.context;return(0,u.jsx)(h.ReportFilters,{query:o,siteLocale:v.ne.siteLocale,currency:p.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:a,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:_,isoDateFormat:f.isoDateFormat})}}S.contextType=g.CurrencyContext;const x=(0,p.compose)((0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(n.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,c.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(y.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(S);function A(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(x,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(_,{})]})}},80170:(e,t,r)=>{r.d(t,{Qc:()=>l,eg:()=>c,uW:()=>n});var o=r(27723),a=r(52619),s=r(33958);const c=(0,a.applyFilters)("woocommerce_admin_downloads_report_charts",[{key:"download_count",label:(0,o.__)("Downloads","woocommerce"),type:"number"}]),n=(0,a.applyFilters)("woocommerce_admin_downloads_report_filters",[{label:(0,o.__)("Show","woocommerce"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>!0,filters:[{label:(0,o.__)("All downloads","woocommerce"),value:"all"},{label:(0,o.__)("Advanced filters","woocommerce"),value:"advanced"}]}]),l=(0,a.applyFilters)("woocommerce_admin_downloads_report_advanced_filters",{title:(0,o._x)("Downloads match <select/> filters","A sentence describing filters for Downloads. See screen shot for context: https://cloudup.com/ccxhyH2mEDg","woocommerce"),filters:{product:{labels:{add:(0,o.__)("Product","woocommerce"),placeholder:(0,o.__)("Search","woocommerce"),remove:(0,o.__)("Remove product filter","woocommerce"),rule:(0,o.__)("Select a product filter match","woocommerce"),title:(0,o.__)("<title>Product</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select product","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","products","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","products","woocommerce")}],input:{component:"Search",type:"products",getLabels:s.p0}},customer:{labels:{add:(0,o.__)("Username","woocommerce"),placeholder:(0,o.__)("Search customer username","woocommerce"),remove:(0,o.__)("Remove customer username filter","woocommerce"),rule:(0,o.__)("Select a customer username filter match","woocommerce"),title:(0,o.__)("<title>Username</title> <rule/> <filter />","woocommerce"),filter:(0,o.__)("Select customer username","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","customer usernames","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","customer usernames","woocommerce")}],input:{component:"Search",type:"usernames",getLabels:s.wd}},order:{labels:{add:(0,o.__)("Order #","woocommerce"),placeholder:(0,o.__)("Search order number","woocommerce"),remove:(0,o.__)("Remove order number filter","woocommerce"),rule:(0,o.__)("Select an order number filter match","woocommerce"),title:(0,o.__)("<title>Order #</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select order number","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","order numbers","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","order numbers","woocommerce")}],input:{component:"Search",type:"orders",getLabels:async e=>{const t=e.split(",");return await t.map((e=>({id:e,label:"#"+e})))}}},ip_address:{labels:{add:(0,o.__)("IP Address","woocommerce"),placeholder:(0,o.__)("Search IP address","woocommerce"),remove:(0,o.__)("Remove IP address filter","woocommerce"),rule:(0,o.__)("Select an IP address filter match","woocommerce"),title:(0,o.__)("<title>IP Address</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select IP address","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","IP addresses","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","IP addresses","woocommerce")}],input:{component:"Search",type:"downloadIps",getLabels:async e=>{const t=e.split(",");return await t.map((e=>({id:e,label:e})))}}}}})},47939:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var o=r(86087),a=r(80170),s=r(27723),c=r(47143),n=r(66087),l=r(76154),i=r.n(l),d=r(98846),m=r(96476),u=r(43577),_=r(15703),p=r(40314),w=r(77374),y=r(94111),h=r(79899),f=r(56109),b=r(39793);class g extends o.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,s.__)("Date","woocommerce"),key:"date",defaultSort:!0,required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,s.__)("Product title","woocommerce"),key:"product",isSortable:!0,required:!0},{label:(0,s.__)("File name","woocommerce"),key:"file_name"},{label:(0,s.__)("Order #","woocommerce"),screenReaderLabel:(0,s.__)("Order Number","woocommerce"),key:"order_number"},{label:(0,s.__)("Username","woocommerce"),key:"user_id"},{label:(0,s.__)("IP","woocommerce"),key:"ip_address"}]}getRowsContent(e){const{query:t}=this.props,r=(0,m.getPersistedQuery)(t),o=(0,f.Qk)("dateFormat",w.defaultTableDateFormat);return(0,n.map)(e,(e=>{const{_embedded:t,date:a,file_name:c,file_path:n,ip_address:l,order_id:i,order_number:u,product_id:p,username:w}=e,{code:y,name:h}=t.product[0];let f,g;if("woocommerce_rest_product_invalid_id"===y)f=(0,s.__)("(Deleted)","woocommerce"),g=(0,s.__)("(Deleted)","woocommerce");else{const e=(0,m.getNewPath)(r,"/analytics/products",{filter:"single_product",products:p});f=(0,b.jsx)(d.Link,{href:e,type:"wc-admin",children:h}),g=h}return[{display:(0,b.jsx)(d.Date,{date:a,visibleFormat:o}),value:a},{display:f,value:g},{display:(0,b.jsx)(d.Link,{href:n,type:"external",children:c}),value:c},{display:(0,b.jsx)(d.Link,{href:(0,_.getAdminLink)(`post.php?post=${i}&action=edit`),type:"wp-admin",children:u}),value:u},{display:w,value:w},{display:l,value:l}]}))}getSummary(e){const{download_count:t=0}=e,{query:r,defaultDateRange:o}=this.props,a=(0,w.getCurrentDates)(r,o),c=i()(a.primary.after),n=i()(a.primary.before).diff(c,"days")+1,l=this.context.getCurrencyConfig();return[{label:(0,s._n)("day","days",n,"woocommerce"),value:(0,u.formatValue)(l,"number",n)},{label:(0,s._n)("Download","Downloads",t,"woocommerce"),value:(0,u.formatValue)(l,"number",t)}]}render(){const{query:e,filters:t,advancedFilters:r}=this.props;return(0,b.jsx)(h.A,{endpoint:"downloads",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["download_count"],query:e,tableQuery:{_embed:!0},title:(0,s.__)("Downloads","woocommerce"),columnPrefsKey:"downloads_report_columns",filters:t,advancedFilters:r})}}g.contextType=y.CurrencyContext;const v=(0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(p.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}}))(g);var S=r(95272),x=r(55737),A=r(68224),C=r(36736);class k extends o.Component{render(){const{query:e,path:t}=this.props;return(0,b.jsxs)(o.Fragment,{children:[(0,b.jsx)(C.Y,{query:e,path:t,filters:a.uW,advancedFilters:a.Qc,report:"downloads"}),(0,b.jsx)(A.A,{charts:a.eg,endpoint:"downloads",query:e,selectedChart:(0,S.A)(e.chart,a.eg),filters:a.uW,advancedFilters:a.Qc}),(0,b.jsx)(x.A,{charts:a.eg,endpoint:"downloads",path:t,query:e,selectedChart:(0,S.A)(e.chart,a.eg),filters:a.uW,advancedFilters:a.Qc}),(0,b.jsx)(v,{query:e,filters:a.uW,advancedFilters:a.Qc})]})}}},32639:(e,t,r)=>{r.d(t,{H:()=>a});var o=r(27723);function a(e){return[e.country,e.state,e.name||(0,o.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},33958:(e,t,r)=>{r.d(t,{Dn:()=>u,U4:()=>p,aG:()=>_,b8:()=>b,jx:()=>h,p0:()=>y,wd:()=>w,xP:()=>f});var o=r(27723),a=r(93832),s=r(1455),c=r.n(s),n=r(66087),l=r(96476),i=r(40314),d=r(32639),m=r(56109);function u(e,t=n.identity){return function(r="",o){const s="function"==typeof e?e(o):e,n=(0,l.getIdsFromQuery)(r);if(n.length<1)return Promise.resolve([]);const i={include:n.join(","),per_page:n.length};return c()({path:(0,a.addQueryArgs)(s,i)}).then((e=>e.map(t)))}}u(i.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const _=u(i.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),p=u(i.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),w=u(i.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),y=u(i.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),h=u(i.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,d.H)(e)})));function f({attributes:e,name:t}){const r=(0,m.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(r)>-1)return t;const a=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,o.sprintf)((0,o.__)("Any %s","woocommerce"),e)),t))).join(", ");return a?t+r+a:t}const b=u((({products:e})=>e?i.NAMESPACE+`/products/${e}/variations`:i.NAMESPACE+"/variations"),(e=>({key:e.id,label:f(e)})))},95272:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(66087);function a(e,t=[]){return(0,o.find)(t,{key:e})||t[0]}}}]);
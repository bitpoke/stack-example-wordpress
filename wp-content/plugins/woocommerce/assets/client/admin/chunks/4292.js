"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[4292],{36736:(e,t,r)=>{r.d(t,{Y:()=>A});var o=r(27723),s=r(38443),a=r(56427),n=r(47143),i=r(40314),c=r(86087),l=r(1455),d=r.n(l);const m=5e3;var u=r(39793);function p(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:l}=function(){const[e,t]=(0,c.useState)(null),[r,s]=(0,c.useState)(!0),[a,n]=(0,c.useState)(null),[i,l]=(0,c.useState)(!1),u=(0,c.useRef)(null),p=(0,c.useCallback)((async()=>{try{const e=await d()({path:"/wc-analytics/imports/status",method:"GET"});t(e),n(null)}catch(e){n(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{s(!1)}}),[]),_=(0,c.useCallback)((async()=>{l(!0);try{await d()({path:"/wc-analytics/imports/trigger",method:"POST"}),await p()}catch(e){throw n(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[p]);return(0,c.useEffect)((()=>{p()}),[p]),(0,c.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(p,m):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,p]),{status:e,isLoading:r,error:a,triggerImport:_,isTriggeringImport:i}}(),{createNotice:p}=(0,n.useDispatch)("core/notices"),{wcAdminSettings:_}=(0,i.useSettings)("wc_admin",["wcAdminSettings"]);if(!_?.woocommerce_analytics_scheduled_import||"no"===_.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(a.Spinner,{}):(g=e?.last_processed_date||null,g?(0,s.dateI18n)("M j H:i",g,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(a.Spinner,{}):(e=>e?(0,s.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(a.Button,{variant:"tertiary",onClick:async()=>{try{await r(),p("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){p("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,u.jsx)(a.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var g}var _=r(29491),y=r(66087),g=r(27752),h=r(98846),w=r(77374),b=r(83306),f=r(94111),v=r(56109);class S extends c.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,b.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const s={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(s.filter_variation=e["filter-variations"]||"all"),(0,b.recordEvent)("analytics_filter",s)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,b.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,b.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,y.snakeCase)(r)]=t[r],e)),{});o(),(0,b.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,b.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,b.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:s,defaultDateRange:a}=this.props,{period:n,compare:i,before:c,after:l}=(0,w.getDateParamsFromQuery)(o,a),{primary:d,secondary:m}=(0,w.getCurrentDates)(o,a),p={period:n,compare:i,before:c,after:l,primaryDate:d,secondaryDate:m},_=this.context;return(0,u.jsx)(h.ReportFilters,{query:o,siteLocale:v.ne.siteLocale,currency:_.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:s,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:p,isoDateFormat:w.isoDateFormat})}}S.contextType=f.CurrencyContext;const k=(0,_.compose)((0,n.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(i.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,n.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(g.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(S);function A(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(k,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(p,{})]})}},74767:(e,t,r)=>{r.d(t,{A:()=>d});var o=r(86087),s=r(66087),a=r(56427),n=r(18537),i=r(98846),c=r(96476),l=r(39793);class d extends o.Component{getCategoryAncestorIds(e,t){const r=[];let o=e.parent;for(;o;)r.unshift(o),o=t.get(o).parent;return r}getCategoryAncestors(e,t){const r=this.getCategoryAncestorIds(e,t);if(r.length)return 1===r.length?t.get((0,s.first)(r)).name+" › ":2===r.length?t.get((0,s.first)(r)).name+" › "+t.get((0,s.last)(r)).name+" › ":t.get((0,s.first)(r)).name+" … "+t.get((0,s.last)(r)).name+" › "}render(){const{categories:e,category:t,query:r}=this.props,o=(0,c.getPersistedQuery)(r);return t?(0,l.jsxs)("div",{className:"woocommerce-table__breadcrumbs",children:[(0,n.decodeEntities)(this.getCategoryAncestors(t,e)),(0,l.jsx)(i.Link,{href:(0,c.getNewPath)(o,"/analytics/categories",{filter:"single_category",categories:t.id}),type:"wc-admin",children:(0,n.decodeEntities)(t.name)})]}):(0,l.jsx)(a.Spinner,{})}}},94413:(e,t,r)=>{r.d(t,{A:()=>k});var o=r(27723),s=r(86087),a=r(29491),n=r(18537),i=r(47143),c=r(66087),l=r(96476),d=r(98846),m=r(43577),u=r(15703),p=r(40314),_=r(94111),y=r(74767),g=r(43128),h=r(79899),w=r(56109),b=r(39793);const f=(0,w.Qk)("manageStock","no"),v=(0,w.Qk)("stockStatuses",{});class S extends s.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,o.__)("Product title","woocommerce"),key:"product_name",required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,o.__)("SKU","woocommerce"),key:"sku",hiddenByDefault:!0,isSortable:!0},{label:(0,o.__)("Items sold","woocommerce"),key:"items_sold",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0},{label:(0,o.__)("Net sales","woocommerce"),screenReaderLabel:(0,o.__)("Net sales","woocommerce"),key:"net_revenue",required:!0,isSortable:!0,isNumeric:!0},{label:(0,o.__)("Orders","woocommerce"),key:"orders_count",isSortable:!0,isNumeric:!0},{label:(0,o.__)("Category","woocommerce"),key:"product_cat"},{label:(0,o.__)("Variations","woocommerce"),key:"variations",isSortable:!0},"yes"===f?{label:(0,o.__)("Status","woocommerce"),key:"stock_status"}:null,"yes"===f?{label:(0,o.__)("Stock","woocommerce"),key:"stock",isNumeric:!0}:null].filter(Boolean)}getRowsContent(e=[]){const{query:t}=this.props,r=(0,l.getPersistedQuery)(t),{render:s,formatDecimal:a,getCurrencyConfig:i}=this.context,p=i();return(0,c.map)(e,(e=>{const{product_id:i,items_sold:c,net_revenue:_,orders_count:h}=e,w=e.extended_info||{},{category_ids:S,low_stock_amount:k,manage_stock:A,sku:C,stock_status:x,stock_quantity:N,variations:j=[]}=w,E=(0,n.decodeEntities)(w.name),F=(0,l.getNewPath)(r,"/analytics/orders",{filter:"advanced",product_includes:i}),P=(0,l.getNewPath)(r,"/analytics/products",{filter:"single_product",products:i}),{categories:D}=this.props,I=S&&D&&S.map((e=>D.get(e))).filter(Boolean)||[],q=(0,g.n)(x,N,k)?(0,b.jsx)(d.Link,{href:(0,u.getAdminLink)("post.php?action=edit&post="+i),type:"wp-admin",children:(0,o._x)("Low","Indication of a low quantity","woocommerce")}):v[x];return[{display:(0,b.jsx)(d.Link,{href:P,type:"wc-admin",children:E}),value:E},{display:C,value:C},{display:(0,m.formatValue)(p,"number",c),value:c},{display:s(_),value:a(_)},{display:(0,b.jsx)(d.Link,{href:F,type:"wc-admin",children:h}),value:h},{display:(0,b.jsxs)("div",{className:"woocommerce-table__product-categories",children:[I[0]&&(0,b.jsx)(y.A,{category:I[0],categories:D}),I.length>1&&(0,b.jsx)(d.Tag,{label:(0,o.sprintf)((0,o._x)("+%d more","categories","woocommerce"),I.length-1),popoverContents:I.map((e=>(0,b.jsx)(y.A,{category:e,categories:D,query:t},e.id)))})]}),value:I.map((e=>e.name)).join(", ")},{display:(0,m.formatValue)(p,"number",j.length),value:j.length},"yes"===f?{display:A?q:(0,o.__)("N/A","woocommerce"),value:A?v[x]:null}:null,"yes"===f?{display:A?(0,m.formatValue)(p,"number",N):(0,o.__)("N/A","woocommerce"),value:N}:null].filter(Boolean)}))}getSummary(e){const{products_count:t=0,items_sold:r=0,net_revenue:s=0,orders_count:a=0}=e,{formatAmount:n,getCurrencyConfig:i}=this.context,c=i();return[{label:(0,o._n)("Product","Products",t,"woocommerce"),value:(0,m.formatValue)(c,"number",t)},{label:(0,o._n)("Item sold","Items sold",r,"woocommerce"),value:(0,m.formatValue)(c,"number",r)},{label:(0,o.__)("Net sales","woocommerce"),value:n(s)},{label:(0,o._n)("Order","Orders",a,"woocommerce"),value:(0,m.formatValue)(c,"number",a)}]}render(){const{advancedFilters:e,baseSearchQuery:t,filters:r,hideCompare:s,isRequesting:a,query:n}=this.props,i={helpText:(0,o.__)("Check at least two products below to compare","woocommerce"),placeholder:(0,o.__)("Search by product name or SKU","woocommerce")};return(0,b.jsx)(h.A,{compareBy:s?void 0:"products",endpoint:"products",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["products_count","items_sold","net_revenue","orders_count"],itemIdField:"product_id",isRequesting:a,labels:i,query:n,searchBy:"products",baseSearchQuery:t,tableQuery:{orderby:n.orderby||"items_sold",order:n.order||"desc",extended_info:!0,segmentby:n.segmentby},title:(0,o.__)("Products","woocommerce"),columnPrefsKey:"products_report_columns",filters:r,advancedFilters:e})}}S.contextType=_.CurrencyContext;const k=(0,a.compose)((0,i.withSelect)(((e,t)=>{const{query:r,isRequesting:o}=t;if(o||r.search&&(!r.products||!r.products.length))return{};const{getItems:s,getItemsError:a,isResolving:n}=e(p.itemsStore),i={per_page:-1};return{categories:s("categories",i),isError:Boolean(a("categories",i)),isRequesting:n("getItems",["categories",i])}})))(S)},43128:(e,t,r)=>{function o(e,t,r){return!!t&&e&&t<=r==="instock"}r.d(t,{n:()=>o})},32639:(e,t,r)=>{r.d(t,{H:()=>s});var o=r(27723);function s(e){return[e.country,e.state,e.name||(0,o.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},33958:(e,t,r)=>{r.d(t,{Dn:()=>u,U4:()=>_,aG:()=>p,b8:()=>b,jx:()=>h,p0:()=>g,wd:()=>y,xP:()=>w});var o=r(27723),s=r(93832),a=r(1455),n=r.n(a),i=r(66087),c=r(96476),l=r(40314),d=r(32639),m=r(56109);function u(e,t=i.identity){return function(r="",o){const a="function"==typeof e?e(o):e,i=(0,c.getIdsFromQuery)(r);if(i.length<1)return Promise.resolve([]);const l={include:i.join(","),per_page:i.length};return n()({path:(0,s.addQueryArgs)(a,l)}).then((e=>e.map(t)))}}u(l.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const p=u(l.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),_=u(l.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),y=u(l.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),g=u(l.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),h=u(l.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,d.H)(e)})));function w({attributes:e,name:t}){const r=(0,m.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(r)>-1)return t;const s=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,o.sprintf)((0,o.__)("Any %s","woocommerce"),e)),t))).join(", ");return s?t+r+s:t}const b=u((({products:e})=>e?l.NAMESPACE+`/products/${e}/variations`:l.NAMESPACE+"/variations"),(e=>({key:e.id,label:w(e)})))},95272:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(66087);function s(e,t=[]){return(0,o.find)(t,{key:e})||t[0]}}}]);
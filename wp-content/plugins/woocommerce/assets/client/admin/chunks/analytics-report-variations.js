"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[6071],{36736:(e,t,r)=>{r.d(t,{Y:()=>A});var o=r(27723),a=r(38443),s=r(56427),i=r(47143),c=r(40314),n=r(86087),l=r(1455),m=r.n(l);const d=5e3;var u=r(39793);function _(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:l}=function(){const[e,t]=(0,n.useState)(null),[r,a]=(0,n.useState)(!0),[s,i]=(0,n.useState)(null),[c,l]=(0,n.useState)(!1),u=(0,n.useRef)(null),_=(0,n.useCallback)((async()=>{try{const e=await m()({path:"/wc-analytics/imports/status",method:"GET"});t(e),i(null)}catch(e){i(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{a(!1)}}),[]),p=(0,n.useCallback)((async()=>{l(!0);try{await m()({path:"/wc-analytics/imports/trigger",method:"POST"}),await _()}catch(e){throw i(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[_]);return(0,n.useEffect)((()=>{_()}),[_]),(0,n.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(_,d):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,_]),{status:e,isLoading:r,error:s,triggerImport:p,isTriggeringImport:c}}(),{createNotice:_}=(0,i.useDispatch)("core/notices"),{wcAdminSettings:p}=(0,c.useSettings)("wc_admin",["wcAdminSettings"]);if(!p?.woocommerce_analytics_scheduled_import||"no"===p.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(v=e?.last_processed_date||null,v?(0,a.dateI18n)("M j H:i",v,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(e=>e?(0,a.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(s.Button,{variant:"tertiary",onClick:async()=>{try{await r(),_("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){_("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,u.jsx)(s.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var v}var p=r(29491),y=r(66087),v=r(27752),w=r(98846),h=r(77374),b=r(83306),f=r(94111),g=r(56109);class S extends n.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,b.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const a={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(a.filter_variation=e["filter-variations"]||"all"),(0,b.recordEvent)("analytics_filter",a)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,b.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,b.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,y.snakeCase)(r)]=t[r],e)),{});o(),(0,b.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,b.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,b.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:a,defaultDateRange:s}=this.props,{period:i,compare:c,before:n,after:l}=(0,h.getDateParamsFromQuery)(o,s),{primary:m,secondary:d}=(0,h.getCurrentDates)(o,s),_={period:i,compare:c,before:n,after:l,primaryDate:m,secondaryDate:d},p=this.context;return(0,u.jsx)(w.ReportFilters,{query:o,siteLocale:g.ne.siteLocale,currency:p.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:a,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:_,isoDateFormat:h.isoDateFormat})}}S.contextType=f.CurrencyContext;const x=(0,p.compose)((0,i.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(c.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,i.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(v.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(S);function A(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(x,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(_,{})]})}},43128:(e,t,r)=>{function o(e,t,r){return!!t&&e&&t<=r==="instock"}r.d(t,{n:()=>o})},32639:(e,t,r)=>{r.d(t,{H:()=>a});var o=r(27723);function a(e){return[e.country,e.state,e.name||(0,o.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},96703:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var o=r(27723),a=r(86087),s=r(98846),i=r(52619),c=r(47143),n=r(27752),l=r(33958);const{addCesSurveyForAnalytics:m}=(0,c.dispatch)(n.STORE_KEY),d=(0,i.applyFilters)("woocommerce_admin_variations_report_charts",[{key:"items_sold",label:(0,o.__)("Items sold","woocommerce"),order:"desc",orderby:"items_sold",type:"number"},{key:"net_revenue",label:(0,o.__)("Net sales","woocommerce"),order:"desc",orderby:"net_revenue",type:"currency"},{key:"orders_count",label:(0,o.__)("Orders","woocommerce"),order:"desc",orderby:"orders_count",type:"number"}]),u=(0,i.applyFilters)("woocommerce_admin_variations_report_filters",[{label:(0,o.__)("Show","woocommerce"),staticParams:["chartType","paged","per_page"],param:"filter-variations",showFilters:()=>!0,filters:[{label:(0,o.__)("All variations","woocommerce"),chartMode:"item-comparison",value:"all"},{label:(0,o.__)("Single variation","woocommerce"),value:"select_variation",subFilters:[{component:"Search",value:"single_variation",path:["select_variation"],settings:{type:"variations",param:"variations",getLabels:l.b8,labels:{placeholder:(0,o.__)("Type to search for a variation","woocommerce"),button:(0,o.__)("Single variation","woocommerce")}}}]},{label:(0,o.__)("Comparison","woocommerce"),chartMode:"item-comparison",value:"compare-variations",settings:{type:"variations",param:"variations",getLabels:l.b8,labels:{helpText:(0,o.__)("Check at least two variations below to compare","woocommerce"),placeholder:(0,o.__)("Search for variations to compare","woocommerce"),title:(0,o.__)("Compare Variations","woocommerce"),update:(0,o.__)("Compare","woocommerce")},onClick:m}},{label:(0,o.__)("Advanced filters","woocommerce"),value:"advanced"}]}]),_=(0,i.applyFilters)("woocommerce_admin_variations_report_advanced_filters",{title:(0,o._x)("Variations match <select/> filters","A sentence describing filters for Variations. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce"),filters:{attribute:{allowMultiple:!0,labels:{add:(0,o.__)("Product attribute","woocommerce"),placeholder:(0,o.__)("Search product attributes","woocommerce"),remove:(0,o.__)("Remove product attribute filter","woocommerce"),rule:(0,o.__)("Select a product attribute filter match","woocommerce"),title:(0,o.__)("<title>Product attribute</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select product attributes","woocommerce")},rules:[{value:"is",label:(0,o._x)("Is","product attribute","woocommerce")},{value:"is_not",label:(0,o._x)("Is Not","product attribute","woocommerce")}],input:{component:"ProductAttribute"}},category:{labels:{add:(0,o.__)("Product category","woocommerce"),placeholder:(0,o.__)("Search product categories","woocommerce"),remove:(0,o.__)("Remove product category filter","woocommerce"),rule:(0,o.__)("Select a product category filter match","woocommerce"),title:(0,o.__)("<title>Product category</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select product categories","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","categories","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","categories","woocommerce")}],input:{component:"Search",type:"categories",getLabels:l.aG}},product:{labels:{add:(0,o.__)("Product","woocommerce"),placeholder:(0,o.__)("Search products","woocommerce"),remove:(0,o.__)("Remove product filter","woocommerce"),rule:(0,o.__)("Select a product filter match","woocommerce"),title:(0,o.__)("<title>Product</title> <rule/> <filter/>","woocommerce"),filter:(0,o.__)("Select products","woocommerce")},rules:[{value:"includes",label:(0,o._x)("Includes","products","woocommerce")},{value:"excludes",label:(0,o._x)("Excludes","products","woocommerce")}],input:{component:"Search",type:"variableProducts",getLabels:l.p0}}}});var p=r(95272),y=r(55737),v=r(68224),w=r(86771),h=r(36736),b=r(39793);const f=e=>{const{itemsLabel:t,mode:r}=(({query:e})=>{const t="compare-variations"===e["filter-variations"]&&e.variations&&e.variations.split(",").length>1;return{compareObject:"variations",itemsLabel:(0,o.__)("%d variations","woocommerce"),mode:t?"item-comparison":"time-comparison"}})(e),{path:i,query:c,isError:n,isRequesting:l}=e;if(n)return(0,b.jsx)(s.AnalyticsError,{});const m={...c};return"item-comparison"===r&&(m.segmentby="variation"),(0,b.jsxs)(a.Fragment,{children:[(0,b.jsx)(h.Y,{query:c,path:i,filters:u,advancedFilters:_,report:"variations"}),(0,b.jsx)(v.A,{mode:r,charts:d,endpoint:"variations",query:m,selectedChart:(0,p.A)(c.chart,d),filters:u,advancedFilters:_}),(0,b.jsx)(y.A,{charts:d,mode:r,filters:u,advancedFilters:_,endpoint:"variations",isRequesting:l,itemsLabel:t,path:i,query:m,selectedChart:(0,p.A)(m.chart,d)}),(0,b.jsx)(w.A,{isRequesting:l,query:c,filters:u,advancedFilters:_})]})}},86771:(e,t,r)=>{r.d(t,{A:()=>f});var o=r(27723),a=r(52619),s=r(86087),i=r(66087),c=r(98846),n=r(96476),l=r(43577),m=r(15703),d=r(94111),u=r(79899),_=r(43128),p=r(33958),y=r(56109),v=r(39793);const w=(0,y.Qk)("manageStock","no"),h=(0,y.Qk)("stockStatuses",{});class b extends s.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,o.__)("Product / Variation title","woocommerce"),key:"name",required:!0,isLeftAligned:!0},{label:(0,o.__)("SKU","woocommerce"),key:"sku",hiddenByDefault:!0,isSortable:!0},{label:(0,o.__)("Items sold","woocommerce"),key:"items_sold",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0},{label:(0,o.__)("Net sales","woocommerce"),screenReaderLabel:(0,o.__)("Net sales","woocommerce"),key:"net_revenue",required:!0,isSortable:!0,isNumeric:!0},{label:(0,o.__)("Orders","woocommerce"),key:"orders_count",isSortable:!0,isNumeric:!0},"yes"===w?{label:(0,o.__)("Status","woocommerce"),key:"stock_status"}:null,"yes"===w?{label:(0,o.__)("Stock","woocommerce"),key:"stock",isNumeric:!0}:null].filter(Boolean)}getRowsContent(e=[]){const{query:t}=this.props,r=(0,n.getPersistedQuery)(t),{formatAmount:a,formatDecimal:s,getCurrencyConfig:d}=this.context;return(0,i.map)(e,(e=>{const{items_sold:t,net_revenue:i,orders_count:u,product_id:y,variation_id:b}=e,f=e.extended_info||{},{stock_status:g,stock_quantity:S,low_stock_amount:x,deleted:A,sku:k}=f,C=(F=e,(0,p.xP)(F.extended_info||{}));var F;const E=(0,n.getNewPath)(r,"/analytics/orders",{filter:"advanced",variation_includes:b}),j=(0,m.getAdminLink)(`post.php?post=${y}&action=edit`);return[{display:A?C+" "+(0,o.__)("(Deleted)","woocommerce"):(0,v.jsx)(c.Link,{href:j,type:"wp-admin",children:C}),value:C},{display:k,value:k},{display:(0,l.formatValue)(d(),"number",t),value:t},{display:a(i),value:s(i)},{display:(0,v.jsx)(c.Link,{href:E,type:"wc-admin",children:u}),value:u},"yes"===w?{display:(0,_.n)(g,S,x)?(0,v.jsx)(c.Link,{href:j,type:"wp-admin",children:(0,o._x)("Low","Indication of a low quantity","woocommerce")}):h[g],value:h[g]}:null,"yes"===w?{display:S,value:S}:null].filter(Boolean)}))}getSummary(e){const{query:t}=this.props,{variations_count:r=0,items_sold:s=0,net_revenue:i=0,orders_count:c=0}=e,{formatAmount:n,getCurrencyConfig:m}=this.context,d=m();return[{label:(0,a.applyFilters)("experimental_woocommerce_admin_variations_report_table_summary_variations_count_label",(0,o._n)("variation sold","variations sold",r,"woocommerce"),r,t),value:(0,l.formatValue)(d,"number",r)},{label:(0,o._n)("item sold","items sold",s,"woocommerce"),value:(0,l.formatValue)(d,"number",s)},{label:(0,o.__)("net sales","woocommerce"),value:n(i)},{label:(0,o._n)("orders","orders",c,"woocommerce"),value:(0,l.formatValue)(d,"number",c)}]}render(){const{advancedFilters:e,baseSearchQuery:t,filters:r,isRequesting:s,query:i}=this.props,c={helpText:(0,o.__)("Check at least two variations below to compare","woocommerce"),placeholder:(0,o.__)("Search by variation name or SKU","woocommerce")};return(0,v.jsx)(u.A,{baseSearchQuery:t,compareBy:"variations",compareParam:"filter-variations",endpoint:"variations",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,isRequesting:s,itemIdField:"variation_id",labels:c,query:i,getSummary:this.getSummary,summaryFields:["variations_count","items_sold","net_revenue","orders_count"],tableQuery:{orderby:i.orderby||"items_sold",order:i.order||"desc",extended_info:!0,product_includes:i.product_includes,variations:i.variations},title:(0,a.applyFilters)("experimental_woocommerce_admin_variations_report_table_title",(0,o.__)("Variations","woocommerce"),i),columnPrefsKey:"variations_report_columns",filters:r,advancedFilters:e})}}b.contextType=d.CurrencyContext;const f=b},33958:(e,t,r)=>{r.d(t,{Dn:()=>u,U4:()=>p,aG:()=>_,b8:()=>b,jx:()=>w,p0:()=>v,wd:()=>y,xP:()=>h});var o=r(27723),a=r(93832),s=r(1455),i=r.n(s),c=r(66087),n=r(96476),l=r(40314),m=r(32639),d=r(56109);function u(e,t=c.identity){return function(r="",o){const s="function"==typeof e?e(o):e,c=(0,n.getIdsFromQuery)(r);if(c.length<1)return Promise.resolve([]);const l={include:c.join(","),per_page:c.length};return i()({path:(0,a.addQueryArgs)(s,l)}).then((e=>e.map(t)))}}u(l.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const _=u(l.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),p=u(l.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),y=u(l.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),v=u(l.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),w=u(l.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,m.H)(e)})));function h({attributes:e,name:t}){const r=(0,d.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(r)>-1)return t;const a=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,o.sprintf)((0,o.__)("Any %s","woocommerce"),e)),t))).join(", ");return a?t+r+a:t}const b=u((({products:e})=>e?l.NAMESPACE+`/products/${e}/variations`:l.NAMESPACE+"/variations"),(e=>({key:e.id,label:h(e)})))},95272:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(66087);function a(e,t=[]){return(0,o.find)(t,{key:e})||t[0]}}}]);
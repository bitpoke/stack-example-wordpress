"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[5113],{36736:(e,t,r)=>{r.d(t,{Y:()=>x});var o=r(27723),a=r(38443),s=r(56427),c=r(47143),i=r(40314),n=r(86087),l=r(1455),m=r.n(l);const d=5e3;var u=r(39793);function _(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:l}=function(){const[e,t]=(0,n.useState)(null),[r,a]=(0,n.useState)(!0),[s,c]=(0,n.useState)(null),[i,l]=(0,n.useState)(!1),u=(0,n.useRef)(null),_=(0,n.useCallback)((async()=>{try{const e=await m()({path:"/wc-analytics/imports/status",method:"GET"});t(e),c(null)}catch(e){c(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{a(!1)}}),[]),p=(0,n.useCallback)((async()=>{l(!0);try{await m()({path:"/wc-analytics/imports/trigger",method:"POST"}),await _()}catch(e){throw c(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[_]);return(0,n.useEffect)((()=>{_()}),[_]),(0,n.useEffect)((()=>(e?.import_in_progress_or_due?u.current=window.setInterval(_,d):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)})),[e?.import_in_progress_or_due,_]),{status:e,isLoading:r,error:s,triggerImport:p,isTriggeringImport:i}}(),{createNotice:_}=(0,c.useDispatch)("core/notices"),{wcAdminSettings:p}=(0,i.useSettings)("wc_admin",["wcAdminSettings"]);if(!p?.woocommerce_analytics_scheduled_import||"no"===p.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,u.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,u.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(w=e?.last_processed_date||null,w?(0,a.dateI18n)("M j H:i",w,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,u.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,u.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,u.jsx)(s.Spinner,{}):(e=>e?(0,a.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,u.jsx)(s.Button,{variant:"tertiary",onClick:async()=>{try{await r(),_("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){_("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,u.jsx)(s.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var w}var p=r(29491),y=r(66087),w=r(27752),h=r(98846),b=r(77374),g=r(83306),f=r(94111),v=r(56109);class k extends n.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,g.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const a={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(a.filter_variation=e["filter-variations"]||"all"),(0,g.recordEvent)("analytics_filter",a)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,g.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,g.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,y.snakeCase)(r)]=t[r],e)),{});o(),(0,g.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,g.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,g.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:a,defaultDateRange:s}=this.props,{period:c,compare:i,before:n,after:l}=(0,b.getDateParamsFromQuery)(o,s),{primary:m,secondary:d}=(0,b.getCurrentDates)(o,s),_={period:c,compare:i,before:n,after:l,primaryDate:m,secondaryDate:d},p=this.context;return(0,u.jsx)(h.ReportFilters,{query:o,siteLocale:v.ne.siteLocale,currency:p.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:a,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:_,isoDateFormat:b.isoDateFormat})}}k.contextType=f.CurrencyContext;const S=(0,p.compose)((0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(i.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,c.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(w.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(k);function x(e){return(0,u.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,u.jsx)(S,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,u.jsx)(_,{})]})}},4584:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var o=r(86087),a=r(27723),s=r(52619);const c=(0,s.applyFilters)("woocommerce_admin_stock_report_advanced_filters",{filters:{},title:(0,a._x)("Products Match <select/> Filters","A sentence describing filters for Products. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce")}),i=(0,s.applyFilters)("woocommerce_admin_stock_report_filters",[{label:(0,a.__)("Show","woocommerce"),staticParams:["paged","per_page"],param:"type",showFilters:()=>!0,filters:[{label:(0,a.__)("All products","woocommerce"),value:"all"},{label:(0,a.__)("Out of stock","woocommerce"),value:"outofstock"},{label:(0,a.__)("Low stock","woocommerce"),value:"lowstock"},{label:(0,a.__)("In stock","woocommerce"),value:"instock"},{label:(0,a.__)("On backorder","woocommerce"),value:"onbackorder"}]},{label:(0,a.__)("Filter by","woocommerce"),staticParams:["paged","per_page"],param:"filter",showFilters:()=>Object.keys(c.filters).length,filters:[{label:(0,a.__)("All Products","woocommerce"),value:"all"},{label:(0,a.__)("Advanced Filters","woocommerce"),value:"advanced"}]}]);var n=r(18537),l=r(98846),m=r(96476),d=r(43577),u=r(15703),_=r(94111),p=r(79899),y=r(56109),w=r(39793);const h=(0,y.Qk)("stockStatuses",{});class b extends o.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,a.__)("Product / Variation","woocommerce"),key:"title",required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,a.__)("SKU","woocommerce"),key:"sku",isSortable:!0},{label:(0,a.__)("Status","woocommerce"),key:"stock_status",isSortable:!0,defaultSort:!0},{label:(0,a.__)("Stock","woocommerce"),key:"stock_quantity",isSortable:!0}]}getRowsContent(e=[]){const{query:t}=this.props,r=(0,m.getPersistedQuery)(t);return e.map((e=>{const{id:t,manage_stock:o,parent_id:s,sku:c,stock_quantity:i,stock_status:_,low_stock_amount:p}=e,y=(0,n.decodeEntities)(e.name),b=(0,m.getNewPath)(r,"/analytics/products",{filter:"single_product",products:s||t}),g=(0,w.jsx)(l.Link,{href:b,type:"wc-admin",children:y}),f=(0,u.getAdminLink)("post.php?action=edit&post="+(s||t));var v,k,S;return[{display:g,value:y},{display:c,value:c},{display:(v=_,S=p,(k=i)&&v&&k<=S==="instock"?(0,w.jsx)(l.Link,{href:f,type:"wp-admin",children:(0,a._x)("Low","Indication of a low quantity","woocommerce")}):(0,w.jsx)(l.Link,{href:f,type:"wp-admin",children:h[_]})),value:h[_]},{display:o?(0,d.formatValue)(this.context.getCurrencyConfig(),"number",i):(0,a.__)("N/A","woocommerce"),value:i}]}))}getSummary(e){const{products:t=0,outofstock:r=0,lowstock:o=0,instock:s=0,onbackorder:c=0}=e,i=this.context.getCurrencyConfig();return[{label:(0,a._n)("Product","Products",t,"woocommerce"),value:(0,d.formatValue)(i,"number",t)},{label:(0,a.__)("Out of stock","woocommerce"),value:(0,d.formatValue)(i,"number",r)},{label:(0,a.__)("Low stock","woocommerce"),value:(0,d.formatValue)(i,"number",o)},{label:(0,a.__)("On backorder","woocommerce"),value:(0,d.formatValue)(i,"number",c)},{label:(0,a.__)("In stock","woocommerce"),value:(0,d.formatValue)(i,"number",s)}]}render(){const{advancedFilters:e,filters:t,query:r}=this.props;return(0,w.jsx)(p.A,{endpoint:"stock",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["products","outofstock","lowstock","instock","onbackorder"],query:r,tableQuery:{orderby:r.orderby||"stock_status",order:r.order||"asc",type:r.type||"all"},title:(0,a.__)("Stock","woocommerce"),filters:t,advancedFilters:e})}}b.contextType=_.CurrencyContext;const g=b;var f=r(36736);class v extends o.Component{render(){const{query:e,path:t}=this.props;return(0,w.jsxs)(o.Fragment,{children:[(0,w.jsx)(f.Y,{query:e,path:t,showDatePicker:!1,filters:i,advancedFilters:c,report:"stock"}),(0,w.jsx)(g,{query:e,filters:i,advancedFilters:c})]})}}}}]);
"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[7983],{56739:(e,t,r)=>{r.d(t,{Z:()=>b});var a=r(69307),o=r(94333),s=r(69596),n=r.n(s),i=r(92819),c=r(9818),l=r(75606),d=r(86020),u=r(67221),m=r(81921),p=r(14599),h=r(17844),g=r(91978),y=r(81514);class _ extends a.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,p.recordEvent)("datepicker_update",{report:t,...(0,i.omitBy)(e,i.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,a=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(a)&&r();const o={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(o.filter_variation=e["filter-variations"]||"all"),(0,p.recordEvent)("analytics_filter",o)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:a}=this.props;switch(e){case"add":(0,p.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,p.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,i.snakeCase)(r)]=t[r],e)),{});a(),(0,p.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,p.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,p.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:a,showDatePicker:o,defaultDateRange:s}=this.props,{period:n,compare:i,before:c,after:l}=(0,m.getDateParamsFromQuery)(a,s),{primary:u,secondary:p}=(0,m.getCurrentDates)(a,s),h={period:n,compare:i,before:c,after:l,primaryDate:u,secondaryDate:p},_=this.context;return(0,y.jsx)(d.ReportFilters,{query:a,siteLocale:g.MV.siteLocale,currency:_.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:o,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:h,isoDateFormat:m.isoDateFormat})}}_.contextType=h.CurrencyContext;const b=(0,o.compose)((0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(u.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,c.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(l.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(_);_.propTypes={advancedFilters:n().object,filters:n().array,path:n().string.isRequired,query:n().object,showDatePicker:n().bool,report:n().string.isRequired}},66777:(e,t,r)=>{r.d(t,{Z:()=>x});var a=r(55609),o=r(92694),s=r(69307),n=r(94333),i=r(45904),c=r(9818),l=r(92819),d=r(65736),u=r(69596),m=r.n(u),p=r(75606),h=r(86020),g=r(10431),y=r(49742),_=r(67221),b=r(14599),f=r(81514);const w=()=>(0,f.jsx)("svg",{role:"img","aria-hidden":"true",focusable:"false",version:"1.1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 24 24",children:(0,f.jsx)("path",{d:"M18,9c-0.009,0-0.017,0.002-0.025,0.003C17.72,5.646,14.922,3,11.5,3C7.91,3,5,5.91,5,9.5c0,0.524,0.069,1.031,0.186,1.519 C5.123,11.016,5.064,11,5,11c-2.209,0-4,1.791-4,4c0,1.202,0.541,2.267,1.38,3h18.593C22.196,17.089,23,15.643,23,14 C23,11.239,20.761,9,18,9z M12,16l-4-5h3V8h2v3h3L12,16z"})}),S=e=>{const{getHeadersContent:t,getRowsContent:r,getSummary:n,isRequesting:c,primaryData:u={},tableData:m={items:{data:[],totalResults:0},query:{}},endpoint:p,itemIdField:S,tableQuery:C={},compareBy:v,compareParam:x="filter",searchBy:F,labels:E={},...R}=e,{query:D,columnPrefsKey:k}=e,{items:q,query:A}=m,T=D[x]?(0,g.getIdsFromQuery)(D[v]):[],[j,N]=(0,s.useState)(T),P=(0,s.useRef)(null),{updateUserPreferences:Q,...B}=(0,_.useUserPreferences)();if(m.isError||u.isError)return(0,f.jsx)(h.AnalyticsError,{});let I=[];k&&(I=B&&B[k]?B[k]:I);const O=(e,a,s)=>{const i=n?n(a,s):null;return(0,o.applyFilters)("woocommerce_admin_report_table",{endpoint:p,headers:t(),rows:r(e),totals:a,summary:i,items:q})},M=t=>{const{ids:r}=e;N(t?r:[])},V=(t,r)=>{const{ids:a}=e;if(r)N((0,l.uniq)([a[t],...j]));else{const e=j.indexOf(a[t]);N([...j.slice(0,e),...j.slice(e+1)])}},L=t=>{const{ids:r=[]}=e,o=-1!==j.indexOf(r[t]);return{display:(0,f.jsx)(a.CheckboxControl,{onChange:(0,l.partial)(V,t),checked:o}),value:!1}},U=c||m.isRequesting||u.isRequesting,K=(0,l.get)(u,["data","totals"],{}),Y=q.totalResults||0,z=Y>0,G=(0,g.getSearchWords)(D).map((e=>({key:e,label:e}))),{data:H}=q,J=O(H,K,Y);let{headers:Z,rows:W}=J;const{summary:X}=J;v&&(W=W.map(((e,t)=>[L(t),...e])),Z=[(()=>{const{ids:t=[]}=e,r=t.length>0,o=r&&t.length===j.length;return{cellClassName:"is-checkbox-column",key:"compare",label:(0,f.jsx)(a.CheckboxControl,{onChange:M,"aria-label":(0,d.__)("Select All","woocommerce"),checked:o,disabled:!r}),required:!0}})(),...Z]);const $=((e,t)=>t?e.map((e=>({...e,visible:e.required||!t.includes(e.key)}))):e.map((e=>({...e,visible:e.required||!e.hiddenByDefault}))))(Z,I);return(0,f.jsxs)(s.Fragment,{children:[(0,f.jsx)("div",{className:"woocommerce-report-table__scroll-point",ref:P,"aria-hidden":!0}),(0,f.jsx)(h.TableCard,{className:"woocommerce-report-table",hasSearch:!!F,actions:[v&&(0,f.jsx)(h.CompareButton,{className:"woocommerce-table__compare",count:j.length,helpText:E.helpText||(0,d.__)("Check at least two items below to compare","woocommerce"),onClick:()=>{v&&(0,g.onQueryChange)("compare")(v,x,j.join(","))},disabled:!z,children:E.compareButton||(0,d.__)("Compare","woocommerce")},"compare"),F&&(0,f.jsx)(h.Search,{allowFreeTextSearch:!0,inlineTags:!0,onChange:t=>{const{baseSearchQuery:r={},addCesSurveyForCustomerSearch:a}=e,o=t.map((e=>e.label.replace(",","%2C")));o.length?((0,g.updateQueryString)({filter:void 0,[x]:void 0,[F]:void 0,...r,search:(0,l.uniq)(o).join(",")}),a()):(0,g.updateQueryString)({search:void 0}),(0,b.recordEvent)("analytics_table_filter",{report:p})},placeholder:E.placeholder||(0,d.__)("Search by item name","woocommerce"),selected:G,showClearButton:!0,type:F,disabled:!z},"search"),z&&(0,f.jsxs)(a.Button,{className:"woocommerce-table__download-button",disabled:U,onClick:()=>{const{createNotice:t,startExport:r,title:a}=e,o=Object.assign({},D),{data:s,totalResults:n}=q;let i="browser";if(delete o.extended_info,o.search&&delete o[F],s&&s.length===n){const{headers:e,rows:t}=O(s,n);(0,y.downloadCSVFile)((0,y.generateCSVFileName)(a,o),(0,y.generateCSVDataFromTable)(e,t))}else i="email",r(p,A).then((()=>t("success",(0,d.sprintf)((0,d.__)("Your %s Report will be emailed to you.","woocommerce"),a)))).catch((e=>t("error",e.message||(0,d.sprintf)((0,d.__)("There was a problem exporting your %s Report. Please try again.","woocommerce"),a))));(0,b.recordEvent)("analytics_table_download",{report:p,rows:n,download_type:i})},children:[(0,f.jsx)(w,{}),(0,f.jsx)("span",{className:"woocommerce-table__download-button__label",children:E.downloadButton||(0,d.__)("Download","woocommerce")})]},"download")],headers:$,isLoading:U,onQueryChange:g.onQueryChange,onColumnsChange:(e,t)=>{const r=Z.map((e=>e.key)).filter((t=>!e.includes(t)));if(k&&Q({[k]:r}),t){const r={report:p,column:t,status:e.includes(t)?"on":"off"};(0,b.recordEvent)("analytics_table_header_toggle",r)}},onSort:(e,t)=>{(0,g.onQueryChange)("sort")(e,t);const r={report:p,column:e,direction:t};(0,b.recordEvent)("analytics_table_sort",r)},onPageChange:(e,t)=>{P.current.scrollIntoView();const r=P.current.nextSibling.querySelector(".woocommerce-table__table"),a=i.focus.focusable.find(r);a.length&&a[0].focus(),t&&("goto"===t?(0,b.recordEvent)("analytics_table_go_to_page",{report:p,page:e}):(0,b.recordEvent)("analytics_table_page_click",{report:p,direction:t}))},rows:W,rowsPerPage:parseInt(A.per_page,10)||_.QUERY_DEFAULTS.pageSize,summary:X,totalRows:Y,...R})]})};S.propTypes={baseSearchQuery:m().object,compareBy:m().string,compareParam:m().string,columnPrefsKey:m().string,endpoint:m().string,extendItemsMethodNames:m().shape({getError:m().string,isRequesting:m().string,load:m().string}),extendedItemsStoreName:m().string,getHeadersContent:m().func.isRequired,getRowsContent:m().func.isRequired,getSummary:m().func,itemIdField:m().string,labels:m().shape({compareButton:m().string,downloadButton:m().string,helpText:m().string,placeholder:m().string}),primaryData:m().object,searchBy:m().string,summaryFields:m().arrayOf(m().string),tableData:m().object,tableQuery:m().object,title:m().string.isRequired};const C=[],v={},x=(0,n.compose)((0,c.withSelect)(((e,t)=>{const{endpoint:r,getSummary:a,isRequesting:o,itemIdField:s,query:n,tableData:i,tableQuery:c,filters:d,advancedFilters:u,summaryFields:m,extendedItemsStoreName:p}=t,h=e(_.REPORTS_STORE_NAME),g=p?e(p):null,{woocommerce_default_date_range:y}=e(_.SETTINGS_STORE_NAME).getSetting("wc_admin","wcAdminSettings"),b=n.search&&!(n[r]&&n[r].length);if(o||b)return v;const f="categories"===r?"products":r,w=a?(0,_.getReportChartData)({endpoint:f,selector:h,dataType:"primary",query:n,filters:d,advancedFilters:u,defaultDateRange:y,fields:m}):v,S=i||(0,_.getReportTableData)({endpoint:r,query:n,selector:h,tableQuery:c,filters:d,advancedFilters:u,defaultDateRange:y}),x=g?function(e,t,r){const{extendItemsMethodNames:a,itemIdField:o}=t,s=r.items.data;if(!(Array.isArray(s)&&s.length&&a&&o))return r;const{[a.getError]:n,[a.isRequesting]:i,[a.load]:c}=e,d={include:s.map((e=>e[o])).join(","),per_page:s.length},u=c(d),m=!!i&&i(d),p=!!n&&n(d),h=s.map((e=>{const t=(0,l.first)(u.filter((t=>e.id===t.id)));return{...e,...t}})),g=r.isRequesting||m,y=r.isError||p;return{...r,isRequesting:g,isError:y,items:{...r.items,data:h}}}(g,t,S):S;return{primaryData:w,ids:s&&x.items.data?x.items.data.map((e=>e[s])):C,tableData:x,query:n}})),(0,c.withDispatch)((e=>{const{startExport:t}=e(_.EXPORT_STORE_NAME),{createNotice:r}=e("core/notices"),{addCesSurveyForCustomerSearch:a}=e(p.STORE_KEY);return{createNotice:r,startExport:t,addCesSurveyForCustomerSearch:a}})))(S)}}]);
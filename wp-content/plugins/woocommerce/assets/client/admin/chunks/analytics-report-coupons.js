"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[8286],{36736:(e,t,o)=>{o.d(t,{Y:()=>S});var r=o(27723),a=o(38443),s=o(56427),c=o(47143),n=o(40314),i=o(86087),l=o(1455),m=o.n(l);const u=5e3;var d=o(39793);function p(){const{status:e,isLoading:t,triggerImport:o,isTriggeringImport:l}=function(){const[e,t]=(0,i.useState)(null),[o,a]=(0,i.useState)(!0),[s,c]=(0,i.useState)(null),[n,l]=(0,i.useState)(!1),d=(0,i.useRef)(null),p=(0,i.useCallback)((async()=>{try{const e=await m()({path:"/wc-analytics/imports/status",method:"GET"});t(e),c(null)}catch(e){c(e instanceof Error?e.message:(0,r.__)("Failed to fetch status","woocommerce"))}finally{a(!1)}}),[]),_=(0,i.useCallback)((async()=>{l(!0);try{await m()({path:"/wc-analytics/imports/trigger",method:"POST"}),await p()}catch(e){throw c(e instanceof Error?e.message:(0,r.__)("Failed to trigger import","woocommerce")),e}finally{l(!1)}}),[p]);return(0,i.useEffect)((()=>{p()}),[p]),(0,i.useEffect)((()=>(e?.import_in_progress_or_due?d.current=window.setInterval(p,u):d.current&&(clearInterval(d.current),d.current=null),()=>{d.current&&(clearInterval(d.current),d.current=null)})),[e?.import_in_progress_or_due,p]),{status:e,isLoading:o,error:s,triggerImport:_,isTriggeringImport:n}}(),{createNotice:p}=(0,c.useDispatch)("core/notices"),{wcAdminSettings:_}=(0,n.useSettings)("wc_admin",["wcAdminSettings"]);if(!_?.woocommerce_analytics_scheduled_import||"no"===_.woocommerce_analytics_scheduled_import)return null;const y=e?.import_in_progress_or_due||l;return(0,d.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,d.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,r.__)("Data status:","woocommerce")}),(0,d.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||l,children:(0,d.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,d.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,r.__)("Last updated","woocommerce")}),(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,d.jsx)(s.Spinner,{}):(h=e?.last_processed_date||null,h?(0,a.dateI18n)("M j H:i",h,void 0):(0,r.__)("Never","woocommerce"))})]}),(0,d.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,r.__)("Next update","woocommerce")}),(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,d.jsx)(s.Spinner,{}):(e=>e?(0,a.dateI18n)((0,r.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,r.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,d.jsx)(s.Button,{variant:"tertiary",onClick:async()=>{try{await o(),p("success",(0,r.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){p("error",e instanceof Error?e.message:(0,r.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||y,"aria-disabled":t||y,"aria-busy":y,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":y?(0,r.__)("Analytics data import in progress","woocommerce"):(0,r.__)("Manually trigger analytics data import","woocommerce"),children:y?(0,d.jsx)(s.Spinner,{}):(0,r.__)("Update now","woocommerce")})]})})]});var h}var _=o(29491),y=o(66087),h=o(27752),g=o(98846),w=o(77374),b=o(83306),f=o(94111),v=o(56109);class C extends i.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:o}=this.props;o(),(0,b.recordEvent)("datepicker_update",{report:t,...(0,y.omitBy)(e,y.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:o}=this.props,r=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(r)&&o();const a={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(a.filter_variation=e["filter-variations"]||"all"),(0,b.recordEvent)("analytics_filter",a)}onAdvancedFilterAction(e,t){const{report:o,addCesSurveyForAnalytics:r}=this.props;switch(e){case"add":(0,b.recordEvent)("analytics_filters_add",{report:o,filter:t.key});break;case"remove":(0,b.recordEvent)("analytics_filters_remove",{report:o,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,o)=>(e[(0,y.snakeCase)(o)]=t[o],e)),{});r(),(0,b.recordEvent)("analytics_filters_filter",{report:o,...e});break;case"clear_all":(0,b.recordEvent)("analytics_filters_clear_all",{report:o});break;case"match":(0,b.recordEvent)("analytics_filters_all_any",{report:o,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:o,query:r,showDatePicker:a,defaultDateRange:s}=this.props,{period:c,compare:n,before:i,after:l}=(0,w.getDateParamsFromQuery)(r,s),{primary:m,secondary:u}=(0,w.getCurrentDates)(r,s),p={period:c,compare:n,before:i,after:l,primaryDate:m,secondaryDate:u},_=this.context;return(0,d.jsx)(g.ReportFilters,{query:r,siteLocale:v.ne.siteLocale,currency:_.getCurrencyConfig(),path:o,filters:t,advancedFilters:e,showDatePicker:a,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:p,isoDateFormat:w.isoDateFormat})}}C.contextType=f.CurrencyContext;const A=(0,_.compose)((0,c.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(n.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,c.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(h.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(C);function S(e){return(0,d.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,d.jsx)(A,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,d.jsx)(p,{})]})}},620:(e,t,o)=>{o.d(t,{Qc:()=>m,eg:()=>l,uW:()=>d});var r=o(27723),a=o(52619),s=o(47143),c=o(27752),n=o(33958);const{addCesSurveyForAnalytics:i}=(0,s.dispatch)(c.STORE_KEY),l=(0,a.applyFilters)("woocommerce_admin_coupons_report_charts",[{key:"orders_count",label:(0,r.__)("Discounted orders","woocommerce"),order:"desc",orderby:"orders_count",type:"number"},{key:"amount",label:(0,r.__)("Amount","woocommerce"),order:"desc",orderby:"amount",type:"currency"}]),m=(0,a.applyFilters)("woocommerce_admin_coupon_report_advanced_filters",{filters:{},title:(0,r._x)("Coupons match <select/> filters","A sentence describing filters for Coupons. See screen shot for context: https://cloudup.com/cSsUY9VeCVJ","woocommerce")}),u=[{label:(0,r.__)("All coupons","woocommerce"),value:"all"},{label:(0,r.__)("Single coupon","woocommerce"),value:"select_coupon",chartMode:"item-comparison",subFilters:[{component:"Search",value:"single_coupon",chartMode:"item-comparison",path:["select_coupon"],settings:{type:"coupons",param:"coupons",getLabels:n.U4,labels:{placeholder:(0,r.__)("Type to search for a coupon","woocommerce"),button:(0,r.__)("Single Coupon","woocommerce")}}}]},{label:(0,r.__)("Comparison","woocommerce"),value:"compare-coupons",settings:{type:"coupons",param:"coupons",getLabels:n.U4,labels:{title:(0,r.__)("Compare Coupon Codes","woocommerce"),update:(0,r.__)("Compare","woocommerce"),helpText:(0,r.__)("Check at least two coupon codes below to compare","woocommerce")},onClick:i}}];Object.keys(m.filters).length&&u.push({label:(0,r.__)("Advanced filters","woocommerce"),value:"advanced"});const d=(0,a.applyFilters)("woocommerce_admin_coupons_report_filters",[{label:(0,r.__)("Show","woocommerce"),staticParams:["chartType","paged","per_page"],param:"filter",showFilters:()=>!0,filters:u}])},35301:(e,t,o)=>{o.r(t),o.d(t,{default:()=>C});var r=o(86087),a=o(27723),s=o(620),c=o(66087),n=o(98846),i=o(96476),l=o(43577),m=o(77374),u=o(94111),d=o(79899),p=o(56109),_=o(39793);class y extends r.Component{constructor(){super(),this.getHeadersContent=this.getHeadersContent.bind(this),this.getRowsContent=this.getRowsContent.bind(this),this.getSummary=this.getSummary.bind(this)}getHeadersContent(){return[{label:(0,a.__)("Coupon code","woocommerce"),key:"code",required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,a.__)("Orders","woocommerce"),key:"orders_count",required:!0,defaultSort:!0,isSortable:!0,isNumeric:!0},{label:(0,a.__)("Amount discounted","woocommerce"),key:"amount",isSortable:!0,isNumeric:!0},{label:(0,a.__)("Created","woocommerce"),key:"created"},{label:(0,a.__)("Expires","woocommerce"),key:"expires"},{label:(0,a.__)("Type","woocommerce"),key:"type"}]}getRowsContent(e){const{query:t}=this.props,o=(0,i.getPersistedQuery)(t),r=(0,p.Qk)("dateFormat",m.defaultTableDateFormat),{formatAmount:s,formatDecimal:u,getCurrencyConfig:d}=this.context;return(0,c.map)(e,(e=>{const{amount:t,coupon_id:c,orders_count:m}=e,p=e.extended_info||{},{code:y,date_created:h,date_expires:g,discount_type:w}=p,b=c>0?(0,i.getNewPath)(o,"/analytics/coupons",{filter:"single_coupon",coupons:c}):null,f=null===b?y:(0,_.jsx)(n.Link,{href:b,type:"wc-admin",children:y}),v=c>0?(0,i.getNewPath)(o,"/analytics/orders",{filter:"advanced",coupon_includes:c}):null;return[{display:f,value:y},{display:null===v?m:(0,_.jsx)(n.Link,{href:v,type:"wc-admin",children:(0,l.formatValue)(d(),"number",m)}),value:m},{display:s(t),value:u(t)},{display:h?(0,_.jsx)(n.Date,{date:h,visibleFormat:r}):(0,a.__)("N/A","woocommerce"),value:h},{display:g?(0,_.jsx)(n.Date,{date:g,visibleFormat:r}):(0,a.__)("N/A","woocommerce"),value:g},{display:this.getCouponType(w),value:w}]}))}getSummary(e){const{coupons_count:t=0,orders_count:o=0,amount:r=0}=e,{formatAmount:s,getCurrencyConfig:c}=this.context,n=c();return[{label:(0,a._n)("Coupon","Coupons",t,"woocommerce"),value:(0,l.formatValue)(n,"number",t)},{label:(0,a._n)("Order","Orders",o,"woocommerce"),value:(0,l.formatValue)(n,"number",o)},{label:(0,a.__)("Amount discounted","woocommerce"),value:s(r)}]}getCouponType(e){return{percent:(0,a.__)("Percentage","woocommerce"),fixed_cart:(0,a.__)("Fixed cart","woocommerce"),fixed_product:(0,a.__)("Fixed product","woocommerce")}[e]||(0,a.__)("N/A","woocommerce")}render(){const{advancedFilters:e,filters:t,isRequesting:o,query:r}=this.props;return(0,_.jsx)(d.A,{compareBy:"coupons",endpoint:"coupons",getHeadersContent:this.getHeadersContent,getRowsContent:this.getRowsContent,getSummary:this.getSummary,summaryFields:["coupons_count","orders_count","amount"],isRequesting:o,itemIdField:"coupon_id",query:r,searchBy:"coupons",tableQuery:{orderby:r.orderby||"orders_count",order:r.order||"desc",extended_info:!0},title:(0,a.__)("Coupons","woocommerce"),columnPrefsKey:"coupons_report_columns",filters:t,advancedFilters:e})}}y.contextType=u.CurrencyContext;const h=y;var g=o(95272),w=o(55737),b=o(68224),f=o(36736);class v extends r.Component{getChartMeta(){const{query:e}=this.props,t="compare-coupons"===e.filter&&e.coupons&&e.coupons.split(",").length>1?"item-comparison":"time-comparison";return{itemsLabel:(0,a.__)("%d coupons","woocommerce"),mode:t}}render(){const{isRequesting:e,query:t,path:o}=this.props,{mode:a,itemsLabel:c}=this.getChartMeta(),n={...t};return"item-comparison"===a&&(n.segmentby="coupon"),(0,_.jsxs)(r.Fragment,{children:[(0,_.jsx)(f.Y,{query:t,path:o,filters:s.uW,advancedFilters:s.Qc,report:"coupons"}),(0,_.jsx)(b.A,{charts:s.eg,endpoint:"coupons",query:n,selectedChart:(0,g.A)(t.chart,s.eg),filters:s.uW,advancedFilters:s.Qc}),(0,_.jsx)(w.A,{charts:s.eg,filters:s.uW,advancedFilters:s.Qc,mode:a,endpoint:"coupons",path:o,query:n,isRequesting:e,itemsLabel:c,selectedChart:(0,g.A)(t.chart,s.eg)}),(0,_.jsx)(h,{isRequesting:e,query:t,filters:s.uW,advancedFilters:s.Qc})]})}}const C=v},32639:(e,t,o)=>{o.d(t,{H:()=>a});var r=o(27723);function a(e){return[e.country,e.state,e.name||(0,r.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},33958:(e,t,o)=>{o.d(t,{Dn:()=>d,U4:()=>_,aG:()=>p,b8:()=>b,jx:()=>g,p0:()=>h,wd:()=>y,xP:()=>w});var r=o(27723),a=o(93832),s=o(1455),c=o.n(s),n=o(66087),i=o(96476),l=o(40314),m=o(32639),u=o(56109);function d(e,t=n.identity){return function(o="",r){const s="function"==typeof e?e(r):e,n=(0,i.getIdsFromQuery)(o);if(n.length<1)return Promise.resolve([]);const l={include:n.join(","),per_page:n.length};return c()({path:(0,a.addQueryArgs)(s,l)}).then((e=>e.map(t)))}}d(l.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const p=d(l.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),_=d(l.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),y=d(l.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),h=d(l.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),g=d(l.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,m.H)(e)})));function w({attributes:e,name:t}){const o=(0,u.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(o)>-1)return t;const a=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,r.sprintf)((0,r.__)("Any %s","woocommerce"),e)),t))).join(", ");return a?t+o+a:t}const b=d((({products:e})=>e?l.NAMESPACE+`/products/${e}/variations`:l.NAMESPACE+"/variations"),(e=>({key:e.id,label:w(e)})))},95272:(e,t,o)=>{o.d(t,{A:()=>a});var r=o(66087);function a(e,t=[]){return(0,r.find)(t,{key:e})||t[0]}}}]);
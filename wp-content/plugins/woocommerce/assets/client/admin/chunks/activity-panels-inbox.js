"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[8851],{13913:(e,o,s)=>{s.d(o,{U:()=>x,e:()=>p});var t=s(80225),a=s(69307),n=s(96169),c=s(76292),i=s.n(c),r=s(69596),l=s.n(r),d=s(86020),m=s(55609),_=s(81514),h=s(92819);class u extends a.Component{render(){const{className:e,hasAction:o,hasDate:s,hasSubtitle:a,lines:n}=this.props,c=(0,t.Z)("woocommerce-activity-card is-loading",e);return(0,_.jsxs)("div",{className:c,"aria-hidden":!0,children:[(0,_.jsx)("span",{className:"woocommerce-activity-card__icon",children:(0,_.jsx)("span",{className:"is-placeholder"})}),(0,_.jsxs)("div",{className:"woocommerce-activity-card__header",children:[(0,_.jsx)("div",{className:"woocommerce-activity-card__title is-placeholder"}),a&&(0,_.jsx)("div",{className:"woocommerce-activity-card__subtitle is-placeholder"}),s&&(0,_.jsx)("div",{className:"woocommerce-activity-card__date",children:(0,_.jsx)("span",{className:"is-placeholder"})})]}),(0,_.jsx)("div",{className:"woocommerce-activity-card__body",children:(0,h.range)(n).map((e=>(0,_.jsx)("span",{className:"is-placeholder"},e)))}),o&&(0,_.jsx)("div",{className:"woocommerce-activity-card__actions",children:(0,_.jsx)("span",{className:"is-placeholder"})})]})}}u.propTypes={className:l().string,hasAction:l().bool,hasDate:l().bool,hasSubtitle:l().bool,lines:l().number},u.defaultProps={hasAction:!1,hasDate:!1,hasSubtitle:!1,lines:1};const p=2143==s.j?u:null;class x extends a.Component{getCard(){const{actions:e,className:o,children:s,date:n,icon:c,subtitle:r,title:l,unread:m}=this.props,h=(0,t.Z)("woocommerce-activity-card",o),u=Array.isArray(e)?e:[e],p=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(n)?i().utc(n).fromNow():n;return(0,_.jsxs)("section",{className:h,children:[m&&(0,_.jsx)("span",{className:"woocommerce-activity-card__unread"}),c&&(0,_.jsx)("span",{className:"woocommerce-activity-card__icon","aria-hidden":!0,children:c}),l&&(0,_.jsxs)("header",{className:"woocommerce-activity-card__header",children:[(0,_.jsx)(d.H,{className:"woocommerce-activity-card__title",children:l}),r&&(0,_.jsx)("div",{className:"woocommerce-activity-card__subtitle",children:r}),p&&(0,_.jsx)("span",{className:"woocommerce-activity-card__date",children:p})]}),s&&(0,_.jsx)(d.Section,{className:"woocommerce-activity-card__body",children:s}),e&&(0,_.jsx)("footer",{className:"woocommerce-activity-card__actions",children:u.map(((e,o)=>(0,a.cloneElement)(e,{key:o})))})]})}render(){const{onClick:e}=this.props;return e?(0,_.jsx)(m.Button,{className:"woocommerce-activity-card__button",onClick:e,children:this.getCard()}):this.getCard()}}x.propTypes={actions:l().oneOfType([l().arrayOf(l().element),l().element]),onClick:l().func,className:l().string,children:l().node,date:l().string,icon:l().node,subtitle:l().node,title:l().oneOfType([l().string,l().node]),unread:l().bool},x.defaultProps={icon:(0,_.jsx)(n.Z,{size:48}),unread:!1}},60201:(e,o,s)=>{s.r(o),s.d(o,{InboxPanel:()=>c,default:()=>i});var t=s(58474),a=s(32381),n=s(81514);const c=({hasAbbreviatedNotifications:e,thingsToDoNextCount:o})=>(0,n.jsxs)("div",{className:"woocommerce-notification-panels",children:[e&&(0,n.jsx)(a.vn,{thingsToDoNextCount:o}),(0,n.jsx)(t.Z,{showHeader:!1})]}),i=c},58474:(e,o,s)=>{s.d(o,{Z:()=>f});var t=s(65736),a=s(69307),n=s(86020),c=s(55609),i=s(67221),r=s(9818),l=s(14599),d=s(29779),m=s(24058),_=s(14812),h=s(76292),u=s.n(h),p=s(13913),x=s(73909),N=s(31586),w=s(81514);const g=({onClose:e})=>{const{createNotice:o}=(0,r.useDispatch)("core/notices"),{batchUpdateNotes:s,removeAllNotes:a}=(0,r.useDispatch)(i.notesStore);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(c.Modal,{title:(0,t.__)("Dismiss all messages","woocommerce"),className:"woocommerce-inbox-dismiss-all-modal",onRequestClose:e,children:(0,w.jsxs)("div",{className:"woocommerce-inbox-dismiss-all-modal__wrapper",children:[(0,w.jsx)("div",{className:"woocommerce-usage-modal__message",children:(0,t.__)("Are you sure? Inbox messages will be dismissed forever.","woocommerce")}),(0,w.jsxs)("div",{className:"woocommerce-usage-modal__actions",children:[(0,w.jsx)(c.Button,{onClick:e,children:(0,t.__)("Cancel","woocommerce")}),(0,w.jsx)(c.Button,{isPrimary:!0,onClick:()=>{(async()=>{(0,l.recordEvent)("wcadmin_inbox_action_dismissall",{});try{const e=await a({status:"unactioned"});o("success",(0,t.__)("All messages dismissed","woocommerce"),{actions:[{label:(0,t.__)("Undo","woocommerce"),onClick:()=>{s(e.map((e=>e.id)),{is_deleted:0})}}]})}catch(s){o("error",(0,t.__)("Messages could not be dismissed","woocommerce")),e()}})(),e()},children:(0,t.__)("Yes, dismiss all","woocommerce")})]})]})})})},b={page:1,per_page:5,status:"unactioned",type:i.QUERY_DEFAULTS.noteTypes,orderby:"date",order:"desc",_fields:["id","name","title","content","type","status","actions","date_created","date_created_gmt","layout","image","is_deleted","is_read","locale"]},v=["en_US","en_AU","en_CA","en_GB","en_ZA"],j=u()("2022-01-11","YYYY-MM-DD").valueOf(),y=(e,o)=>{(0,l.recordEvent)("inbox_action_click",{note_name:e.name,note_title:e.title,note_content_inner_link:o})};let C=!1;const k=({hasNotes:e,isBatchUpdating:o,notes:s,onDismiss:a,onNoteActionClick:i,onNoteVisible:r,setShowDismissAllModal:h,showHeader:u=!0,loadMoreNotes:x,allNotesFetched:N,notesHaveResolved:g,unreadNotesCount:v})=>{if(o)return;if(!e)return(0,w.jsx)(p.U,{className:"woocommerce-empty-activity-card",title:(0,t.__)("Your inbox is empty","woocommerce"),icon:!1,children:(0,t.__)("As things begin to happen in your store your inbox will start to fill up. Youâ€™ll see things like achievements, new feature announcements, extension recommendations and more!","woocommerce")});C||((0,l.recordEvent)("inbox_panel_view",{total:s.length}),C=!0);const j=Object.keys(s).map((e=>s[e]));return(0,w.jsxs)(c.Card,{size:"large",children:[u&&(0,w.jsxs)(c.CardHeader,{size:"medium",children:[(0,w.jsxs)("div",{className:"woocommerce-inbox-card__header",children:[(0,w.jsx)(_.Text,{size:"20",lineHeight:"28px",variant:"title.small",children:(0,t.__)("Inbox","woocommerce")}),(0,w.jsx)(n.Badge,{count:v})]}),(0,w.jsx)(n.EllipsisMenu,{label:(0,t.__)("Inbox Notes Options","woocommerce"),renderContent:({onToggle:e})=>(0,w.jsx)("div",{className:"woocommerce-inbox-card__section-controls",children:(0,w.jsx)(c.Button,{onClick:()=>{h(!0),e()},children:(0,t.__)("Dismiss all","woocommerce")})})})]}),(0,w.jsx)(d.Z,{role:"menu",children:j.map((e=>{const{id:o,is_deleted:s}=e;return s?null:(0,w.jsx)(m.Z,{timeout:500,classNames:"woocommerce-inbox-message",children:(0,w.jsx)(_.InboxNoteCard,{note:e,onDismiss:a,onNoteActionClick:i,onBodyLinkClick:y,onNoteVisible:r},o)},o)}))}),N?null:g?(0,w.jsx)(c.CardFooter,{className:"woocommerce-inbox-card__footer",size:"medium",children:(0,w.jsx)(c.Button,{isPrimary:!0,onClick:()=>{x()},children:j.length>b.per_page?(0,t.__)("Show more","woocommerce"):(0,t.__)("Show older","woocommerce")})}):(0,w.jsx)(_.InboxNotePlaceholder,{className:"banner message-is-unread"})]})},f=({showHeader:e=!0})=>{const[o,s]=(0,a.useState)(b.per_page),[c,d]=(0,a.useState)(!1),[m,h]=(0,a.useState)([]),[p,y]=(0,a.useState)({}),{createNotice:C}=(0,r.useDispatch)("core/notices"),{removeNote:f,updateNote:S,triggerNoteAction:A,invalidateResolutionForStoreSelector:D}=(0,r.useDispatch)(i.notesStore),U=(0,N.GG)(),E=(0,a.useMemo)((()=>({...b,per_page:o})),[o]),{isError:M,notes:T,notesHaveResolved:B,isBatchUpdating:Y,unreadNotesCount:H}=(0,r.useSelect)((e=>{const{getNotes:o,getNotesError:s,isNotesRequesting:t,hasFinishedResolution:a}=e(i.notesStore);return{notes:o(E),unreadNotesCount:o({...b,is_read:!1,per_page:-1}).length,isError:Boolean(s("getNotes",[E])),isBatchUpdating:t("batchUpdateNotes"),notesHaveResolved:!t("batchUpdateNotes")&&a("getNotes",[E])}}));(0,a.useEffect)((()=>{B&&T.length<o&&d(!0),B&&T.length&&h(T.map((e=>{const o=u()(e.date_created_gmt,"YYYY-MM-DD").valueOf();return v.includes(e.locale)&&o>=j?{...e,content:(0,x.r7)(e.content,320)}:e})))}),[T,B]);const[R,F]=(0,a.useState)(!1);if(M){const e=(0,t.__)("There was an error getting your inbox. Please try again.","woocommerce"),o=(0,t.__)("Reload","woocommerce"),s=()=>{window.location.reload()};return(0,w.jsx)(n.EmptyContent,{title:e,actionLabel:o,actionURL:null,actionCallback:s})}return B&&!m.length?null:(0,w.jsxs)(w.Fragment,{children:[R&&(0,w.jsx)(g,{onClose:()=>{F(!1)}}),(0,w.jsxs)("div",{className:"woocommerce-homepage-notes-wrapper",children:[!B&&!m.length&&(0,w.jsx)(n.Section,{children:(0,w.jsx)(_.InboxNotePlaceholder,{className:"banner message-is-unread"})}),(0,w.jsx)(n.Section,{children:Boolean(m.length)&&k({loadMoreNotes:()=>{(0,l.recordEvent)("inbox_action_load_more",{quantity_shown:m.length}),s(o+10)},hasNotes:(0,x.kS)(m),isBatchUpdating:Y,notes:m,onDismiss:async e=>{(0,l.recordEvent)("inbox_action_dismiss",{note_name:e.name,note_title:e.title,note_name_dismiss_all:!1,note_name_dismiss_confirmation:!0,screen:U});const o=e.id;try{await f(o),D("getNotes"),C("success",(0,t.__)("Message dismissed","woocommerce"),{actions:[{label:(0,t.__)("Undo","woocommerce"),onClick:async()=>{await S(o,{is_deleted:0}),D("getNotes")}}]})}catch(e){C("error",(0,t._n)("Message could not be dismissed","Messages could not be dismissed",1,"woocommerce"))}},onNoteActionClick:(e,o)=>{A(e.id,o.id)},onNoteVisible:e=>{p[e.id]||e.is_read||(y({...p,[e.id]:!0}),setTimeout((()=>{S(e.id,{is_read:!0})}),3e3)),(0,l.recordEvent)("inbox_note_view",{note_content:e.content,note_name:e.name,note_title:e.title,note_type:e.type,screen:U})},setShowDismissAllModal:F,showHeader:e,allNotesFetched:c,notesHaveResolved:B,unreadNotesCount:H})})]})]})}}}]);
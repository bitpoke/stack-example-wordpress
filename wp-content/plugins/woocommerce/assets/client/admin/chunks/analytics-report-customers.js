"use strict";(globalThis.webpackChunk_wcAdmin_webpackJsonp=globalThis.webpackChunk_wcAdmin_webpackJsonp||[]).push([[3256],{36736:(e,t,r)=>{r.d(t,{Y:()=>A});var o=r(27723),a=r(38443),c=r(56427),l=r(47143),s=r(40314),i=r(86087),m=r(1455),n=r.n(m);const u=5e3;var d=r(39793);function _(){const{status:e,isLoading:t,triggerImport:r,isTriggeringImport:m}=function(){const[e,t]=(0,i.useState)(null),[r,a]=(0,i.useState)(!0),[c,l]=(0,i.useState)(null),[s,m]=(0,i.useState)(!1),d=(0,i.useRef)(null),_=(0,i.useCallback)((async()=>{try{const e=await n()({path:"/wc-analytics/imports/status",method:"GET"});t(e),l(null)}catch(e){l(e instanceof Error?e.message:(0,o.__)("Failed to fetch status","woocommerce"))}finally{a(!1)}}),[]),p=(0,i.useCallback)((async()=>{m(!0);try{await n()({path:"/wc-analytics/imports/trigger",method:"POST"}),await _()}catch(e){throw l(e instanceof Error?e.message:(0,o.__)("Failed to trigger import","woocommerce")),e}finally{m(!1)}}),[_]);return(0,i.useEffect)((()=>{_()}),[_]),(0,i.useEffect)((()=>(e?.import_in_progress_or_due?d.current=window.setInterval(_,u):d.current&&(clearInterval(d.current),d.current=null),()=>{d.current&&(clearInterval(d.current),d.current=null)})),[e?.import_in_progress_or_due,_]),{status:e,isLoading:r,error:c,triggerImport:p,isTriggeringImport:s}}(),{createNotice:_}=(0,l.useDispatch)("core/notices"),{wcAdminSettings:p}=(0,s.useSettings)("wc_admin",["wcAdminSettings"]);if(!p?.woocommerce_analytics_scheduled_import||"no"===p.woocommerce_analytics_scheduled_import)return null;const w=e?.import_in_progress_or_due||m;return(0,d.jsxs)("div",{className:"woocommerce-analytics-import-status-bar-wrapper",children:[(0,d.jsx)("div",{className:"woocommerce-analytics-import-status-bar-wrapper__label",children:(0,o.__)("Data status:","woocommerce")}),(0,d.jsx)("div",{className:"woocommerce-analytics-import-status-bar",role:"status","aria-live":"polite","aria-atomic":"true","aria-busy":t||m,children:(0,d.jsxs)("div",{className:"woocommerce-analytics-import-status-bar__content",children:[(0,d.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Last updated","woocommerce")}),(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,d.jsx)(c.Spinner,{}):(v=e?.last_processed_date||null,v?(0,a.dateI18n)("M j H:i",v,void 0):(0,o.__)("Never","woocommerce"))})]}),(0,d.jsxs)("span",{className:"woocommerce-analytics-import-status-bar__item",children:[(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__label",children:(0,o.__)("Next update","woocommerce")}),(0,d.jsx)("span",{className:"woocommerce-analytics-import-status-bar__value",children:t?(0,d.jsx)(c.Spinner,{}):(e=>e?(0,a.dateI18n)((0,o.__)("M j \\a\\t H:i","woocommerce"),e,void 0):(0,o.__)("Never","woocommerce"))(e?.next_scheduled||null)})]}),(0,d.jsx)(c.Button,{variant:"tertiary",onClick:async()=>{try{await r(),_("success",(0,o.__)("Analytics import has started. Your store data will be updated soon.","woocommerce"),{type:"snackbar",isDismissible:!0})}catch(e){_("error",e instanceof Error?e.message:(0,o.__)("Failed to trigger analytics update.","woocommerce"),{isDismissible:!0})}},disabled:t||w,"aria-disabled":t||w,"aria-busy":w,className:"woocommerce-analytics-import-status-bar__trigger","aria-label":w?(0,o.__)("Analytics data import in progress","woocommerce"):(0,o.__)("Manually trigger analytics data import","woocommerce"),children:w?(0,d.jsx)(c.Spinner,{}):(0,o.__)("Update now","woocommerce")})]})})]});var v}var p=r(29491),w=r(66087),v=r(27752),y=r(98846),b=r(77374),f=r(83306),g=r(94111),h=r(56109);class S extends i.Component{constructor(){super(),this.onDateSelect=this.onDateSelect.bind(this),this.onFilterSelect=this.onFilterSelect.bind(this),this.onAdvancedFilterAction=this.onAdvancedFilterAction.bind(this)}onDateSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props;r(),(0,f.recordEvent)("datepicker_update",{report:t,...(0,w.omitBy)(e,w.isUndefined)})}onFilterSelect(e){const{report:t,addCesSurveyForAnalytics:r}=this.props,o=e.filter||e["filter-variations"];["single_product","single_category","single_coupon","single_variation"].includes(o)&&r();const a={report:t,filter:e.filter||"all"};"single_product"===e.filter&&(a.filter_variation=e["filter-variations"]||"all"),(0,f.recordEvent)("analytics_filter",a)}onAdvancedFilterAction(e,t){const{report:r,addCesSurveyForAnalytics:o}=this.props;switch(e){case"add":(0,f.recordEvent)("analytics_filters_add",{report:r,filter:t.key});break;case"remove":(0,f.recordEvent)("analytics_filters_remove",{report:r,filter:t.key});break;case"filter":const e=Object.keys(t).reduce(((e,r)=>(e[(0,w.snakeCase)(r)]=t[r],e)),{});o(),(0,f.recordEvent)("analytics_filters_filter",{report:r,...e});break;case"clear_all":(0,f.recordEvent)("analytics_filters_clear_all",{report:r});break;case"match":(0,f.recordEvent)("analytics_filters_all_any",{report:r,value:t.match})}}render(){const{advancedFilters:e,filters:t,path:r,query:o,showDatePicker:a,defaultDateRange:c}=this.props,{period:l,compare:s,before:i,after:m}=(0,b.getDateParamsFromQuery)(o,c),{primary:n,secondary:u}=(0,b.getCurrentDates)(o,c),_={period:l,compare:s,before:i,after:m,primaryDate:n,secondaryDate:u},p=this.context;return(0,d.jsx)(y.ReportFilters,{query:o,siteLocale:h.ne.siteLocale,currency:p.getCurrencyConfig(),path:r,filters:t,advancedFilters:e,showDatePicker:a,onDateSelect:this.onDateSelect,onFilterSelect:this.onFilterSelect,onAdvancedFilterAction:this.onAdvancedFilterAction,dateQuery:_,isoDateFormat:b.isoDateFormat})}}S.contextType=g.CurrencyContext;const x=(0,p.compose)((0,l.withSelect)((e=>{const{woocommerce_default_date_range:t}=e(s.settingsStore).getSetting("wc_admin","wcAdminSettings");return{defaultDateRange:t}})),(0,l.withDispatch)((e=>{const{addCesSurveyForAnalytics:t}=e(v.STORE_KEY);return{addCesSurveyForAnalytics:t}})))(S);function A(e){return(0,d.jsxs)("div",{className:"woocommerce-analytics-report-header",children:[(0,d.jsx)(x,{...e}),!!window.wcAdminFeatures?.["analytics-scheduled-import"]&&(0,d.jsx)(_,{})]})}},2592:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var o=r(86087),a=r(27723),c=r(18537),l=r(52619),s=r(47143),i=r(40314),m=r(33958);const n=(0,l.applyFilters)("woocommerce_admin_customers_report_filters",[{label:(0,a.__)("Show","woocommerce"),staticParams:["paged","per_page"],param:"filter",showFilters:()=>!0,filters:[{label:(0,a.__)("All Customers","woocommerce"),value:"all"},{label:(0,a.__)("Single Customer","woocommerce"),value:"select_customer",chartMode:"item-comparison",subFilters:[{component:"Search",value:"single_customer",chartMode:"item-comparison",path:["select_customer"],settings:{type:"customers",param:"customers",getLabels:m.wd,labels:{placeholder:(0,a.__)("Type to search for a customer","woocommerce"),button:(0,a.__)("Single Customer","woocommerce")}}}]},{label:(0,a.__)("Advanced filters","woocommerce"),value:"advanced"}]}]),u=(0,l.applyFilters)("woocommerce_admin_customers_report_advanced_filters",{title:(0,a._x)("Customers match <select/> filters","A sentence describing filters for Customers. See screen shot for context: https://cloudup.com/cCsm3GeXJbE","woocommerce"),filters:{name:{labels:{add:(0,a.__)("Name","woocommerce"),placeholder:(0,a.__)("Search","woocommerce"),remove:(0,a.__)("Remove customer name filter","woocommerce"),rule:(0,a.__)("Select a customer name filter match","woocommerce"),title:(0,a.__)("<title>Name</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select customer name","woocommerce")},rules:[{value:"includes",label:(0,a._x)("Includes","customer names","woocommerce")},{value:"excludes",label:(0,a._x)("Excludes","customer names","woocommerce")}],input:{component:"Search",type:"customers",getLabels:(0,m.Dn)(i.NAMESPACE+"/customers",(e=>({id:e.id,label:e.name})))}},country:{labels:{add:(0,a.__)("Country / Region","woocommerce"),placeholder:(0,a.__)("Search","woocommerce"),remove:(0,a.__)("Remove country / region filter","woocommerce"),rule:(0,a.__)("Select a country / region filter match","woocommerce"),title:(0,a.__)("<title>Country / Region</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select country / region","woocommerce")},rules:[{value:"includes",label:(0,a._x)("Includes","countries","woocommerce")},{value:"excludes",label:(0,a._x)("Excludes","countries","woocommerce")}],input:{component:"Search",type:"countries",getLabels:async e=>{const t=(await(0,s.resolveSelect)(i.COUNTRIES_STORE_NAME).getCountries()).map((e=>({key:e.code,label:(0,c.decodeEntities)(e.name)}))),r=e.split(",");return await t.filter((e=>r.includes(e.key)))}}},username:{labels:{add:(0,a.__)("Username","woocommerce"),placeholder:(0,a.__)("Search customer username","woocommerce"),remove:(0,a.__)("Remove customer username filter","woocommerce"),rule:(0,a.__)("Select a customer username filter match","woocommerce"),title:(0,a.__)("<title>Username</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select customer username","woocommerce")},rules:[{value:"includes",label:(0,a._x)("Includes","customer usernames","woocommerce")},{value:"excludes",label:(0,a._x)("Excludes","customer usernames","woocommerce")}],input:{component:"Search",type:"usernames",getLabels:m.wd}},email:{labels:{add:(0,a.__)("Email","woocommerce"),placeholder:(0,a.__)("Search customer email","woocommerce"),remove:(0,a.__)("Remove customer email filter","woocommerce"),rule:(0,a.__)("Select a customer email filter match","woocommerce"),title:(0,a.__)("<title>Email</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select customer email","woocommerce")},rules:[{value:"includes",label:(0,a._x)("Includes","customer emails","woocommerce")},{value:"excludes",label:(0,a._x)("Excludes","customer emails","woocommerce")}],input:{component:"Search",type:"emails",getLabels:(0,m.Dn)(i.NAMESPACE+"/customers",(e=>({id:e.id,label:e.email})))}},orders_count:{labels:{add:(0,a.__)("No. of Orders","woocommerce"),remove:(0,a.__)("Remove order filter","woocommerce"),rule:(0,a.__)("Select an order count filter match","woocommerce"),title:(0,a.__)("<title>No. of Orders</title> <rule/> <filter/>","woocommerce")},rules:[{value:"max",label:(0,a._x)("Less Than","number of orders","woocommerce")},{value:"min",label:(0,a._x)("More Than","number of orders","woocommerce")},{value:"between",label:(0,a._x)("Between","number of orders","woocommerce")}],input:{component:"Number"}},total_spend:{labels:{add:(0,a.__)("Total Spend","woocommerce"),remove:(0,a.__)("Remove total spend filter","woocommerce"),rule:(0,a.__)("Select a total spend filter match","woocommerce"),title:(0,a.__)("<title>Total Spend</title> <rule/> <filter/>","woocommerce")},rules:[{value:"max",label:(0,a._x)("Less Than","total spend by customer","woocommerce")},{value:"min",label:(0,a._x)("More Than","total spend by customer","woocommerce")},{value:"between",label:(0,a._x)("Between","total spend by customer","woocommerce")}],input:{component:"Currency"}},avg_order_value:{labels:{add:(0,a.__)("AOV","woocommerce"),remove:(0,a.__)("Remove average order value filter","woocommerce"),rule:(0,a.__)("Select an average order value filter match","woocommerce"),title:(0,a.__)("<title>AOV</title> <rule/> <filter/>","woocommerce")},rules:[{value:"max",label:(0,a._x)("Less Than","average order value of customer","woocommerce")},{value:"min",label:(0,a._x)("More Than","average order value of customer","woocommerce")},{value:"between",label:(0,a._x)("Between","average order value of customer","woocommerce")}],input:{component:"Currency"}},registered:{labels:{add:(0,a.__)("Registered","woocommerce"),remove:(0,a.__)("Remove registered filter","woocommerce"),rule:(0,a.__)("Select a registered filter match","woocommerce"),title:(0,a.__)("<title>Registered</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select registered date","woocommerce")},rules:[{value:"before",label:(0,a._x)("Before","date","woocommerce")},{value:"after",label:(0,a._x)("After","date","woocommerce")},{value:"between",label:(0,a._x)("Between","date","woocommerce")}],input:{component:"Date"}},last_active:{labels:{add:(0,a.__)("Last active","woocommerce"),remove:(0,a.__)("Remove last active filter","woocommerce"),rule:(0,a.__)("Select a last active filter match","woocommerce"),title:(0,a.__)("<title>Last active</title> <rule/> <filter/>","woocommerce"),filter:(0,a.__)("Select registered date","woocommerce")},rules:[{value:"before",label:(0,a._x)("Before","date","woocommerce")},{value:"after",label:(0,a._x)("After","date","woocommerce")},{value:"between",label:(0,a._x)("Between","date","woocommerce")}],input:{component:"Date"}}}});var d=r(56427),_=r(98846),p=r(43577),w=r(15703),v=r(77374),y=r(94111),b=r(79899),f=r(56109),g=r(39793);const h=function({isRequesting:e,query:t,filters:r,advancedFilters:c}){const l=(0,o.useContext)(y.CurrencyContext),{countries:m,loadingCountries:n}=(0,s.useSelect)((e=>{const{getCountries:t,hasFinishedResolution:r}=e(i.COUNTRIES_STORE_NAME);return{countries:t(),loadingCountries:!r("getCountries")}}));return(0,g.jsx)(b.A,{endpoint:"customers",getHeadersContent:()=>[{label:(0,a.__)("Name","woocommerce"),key:"name",required:!0,isLeftAligned:!0,isSortable:!0},{label:(0,a.__)("Username","woocommerce"),key:"username",hiddenByDefault:!0},{label:(0,a.__)("Last active","woocommerce"),key:"date_last_active",defaultSort:!0,isSortable:!0},{label:(0,a.__)("Date registered","woocommerce"),key:"date_registered",isSortable:!0},{label:(0,a.__)("Email","woocommerce"),key:"email"},{label:(0,a.__)("Orders","woocommerce"),key:"orders_count",isSortable:!0,isNumeric:!0},{label:(0,a.__)("Total spend","woocommerce"),key:"total_spend",isSortable:!0,isNumeric:!0},{label:(0,a.__)("AOV","woocommerce"),screenReaderLabel:(0,a.__)("Average order value","woocommerce"),key:"avg_order_value",isNumeric:!0},{label:(0,a.__)("Country / Region","woocommerce"),key:"country",isSortable:!0},{label:(0,a.__)("City","woocommerce"),key:"city",hiddenByDefault:!0,isSortable:!0},{label:(0,a.__)("Region","woocommerce"),key:"state",hiddenByDefault:!0,isSortable:!0},{label:(0,a.__)("Postal code","woocommerce"),key:"postcode",hiddenByDefault:!0,isSortable:!0}],getRowsContent:e=>{const t=(0,f.Qk)("dateFormat",v.defaultTableDateFormat),{formatAmount:r,formatDecimal:c,getCurrencyConfig:s}=l;return e?.map((e=>{const{avg_order_value:l,date_last_active:i,date_registered:n,email:u,name:v,user_id:y,orders_count:b,username:f,total_spend:h,postcode:S,city:x,state:A,country:C}=e,E=void 0!==m[k=C]?m[k]:null;var k;const F=""!==v?.trim()?v:(0,g.jsx)(_.Pill,{children:(0,a.__)("Guest","woocommerce")}),N=y?(0,g.jsx)(_.Link,{href:(0,w.getAdminLink)("user-edit.php?user_id="+y),type:"wp-admin",children:v}):F,j=i?(0,g.jsx)(_.Date,{date:i,visibleFormat:t}):"—",D=n?(0,g.jsx)(_.Date,{date:n,visibleFormat:t}):"—",R=(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)(d.Tooltip,{text:E,children:(0,g.jsx)("span",{"aria-hidden":"true",children:C})}),(0,g.jsx)("span",{className:"screen-reader-text",children:E})]});return[{display:N,value:v},{display:f,value:f},{display:j,value:i},{display:D,value:n},{display:(0,g.jsx)("a",{href:"mailto:"+u,children:u}),value:u},{display:(0,p.formatValue)(s(),"number",b),value:b},{display:r(h),value:c(h)},{display:r(l),value:c(l)},{display:R,value:C},{display:x,value:x},{display:A,value:A},{display:S,value:S}]}))},getSummary:e=>{const{customers_count:t=0,avg_orders_count:r=0,avg_total_spend:o=0,avg_avg_order_value:c=0}=e,{formatAmount:s,getCurrencyConfig:i}=l,m=i();return[{label:(0,a._n)("customer","customers",t,"woocommerce"),value:(0,p.formatValue)(m,"number",t)},{label:(0,a._n)("Average order","Average orders",r,"woocommerce"),value:(0,p.formatValue)(m,"number",r)},{label:(0,a.__)("Average lifetime spend","woocommerce"),value:s(o)},{label:(0,a.__)("Average order value","woocommerce"),value:s(c)}]},summaryFields:["customers_count","avg_orders_count","avg_total_spend","avg_avg_order_value"],isRequesting:e||n,itemIdField:"id",query:t,labels:{placeholder:(0,a.__)("Search by customer name","woocommerce")},searchBy:"customers",title:(0,a.__)("Customers","woocommerce"),columnPrefsKey:"customers_report_columns",filters:r,advancedFilters:c})};var S=r(36736);class x extends o.Component{render(){const{isRequesting:e,query:t,path:r}=this.props,a={orderby:"date_last_active",order:"desc",...t};return(0,g.jsxs)(o.Fragment,{children:[(0,g.jsx)(S.Y,{query:t,path:r,filters:n,showDatePicker:!1,advancedFilters:u,report:"customers"}),(0,g.jsx)(h,{isRequesting:e,query:a,filters:n,advancedFilters:u})]})}}},32639:(e,t,r)=>{r.d(t,{H:()=>a});var o=r(27723);function a(e){return[e.country,e.state,e.name||(0,o.__)("TAX","woocommerce"),e.priority].map((e=>e.toString().toUpperCase().trim())).filter(Boolean).join("-")}},33958:(e,t,r)=>{r.d(t,{Dn:()=>d,U4:()=>p,aG:()=>_,b8:()=>f,jx:()=>y,p0:()=>v,wd:()=>w,xP:()=>b});var o=r(27723),a=r(93832),c=r(1455),l=r.n(c),s=r(66087),i=r(96476),m=r(40314),n=r(32639),u=r(56109);function d(e,t=s.identity){return function(r="",o){const c="function"==typeof e?e(o):e,s=(0,i.getIdsFromQuery)(r);if(s.length<1)return Promise.resolve([]);const m={include:s.join(","),per_page:s.length};return l()({path:(0,a.addQueryArgs)(c,m)}).then((e=>e.map(t)))}}d(m.NAMESPACE+"/products/attributes",(e=>({key:e.id,label:e.name})));const _=d(m.NAMESPACE+"/products/categories",(e=>({key:e.id,label:e.name}))),p=d(m.NAMESPACE+"/coupons",(e=>({key:e.id,label:e.code}))),w=d(m.NAMESPACE+"/customers",(e=>({key:e.id,label:e.name}))),v=d(m.NAMESPACE+"/products",(e=>({key:e.id,label:e.name}))),y=d(m.NAMESPACE+"/taxes",(e=>({key:e.id,label:(0,n.H)(e)})));function b({attributes:e,name:t}){const r=(0,u.Qk)("variationTitleAttributesSeparator"," - ");if(t&&t.indexOf(r)>-1)return t;const a=(e||[]).map((({name:e,option:t})=>(t||(e=e.charAt(0).toUpperCase()+e.slice(1),t=(0,o.sprintf)((0,o.__)("Any %s","woocommerce"),e)),t))).join(", ");return a?t+r+a:t}const f=d((({products:e})=>e?m.NAMESPACE+`/products/${e}/variations`:m.NAMESPACE+"/variations"),(e=>({key:e.id,label:b(e)})))}}]);
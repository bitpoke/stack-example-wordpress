"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Edit=void 0;const i18n_1=require("@wordpress/i18n"),element_1=require("@wordpress/element"),block_editor_1=require("@wordpress/block-editor"),compose_1=require("@wordpress/compose"),url_1=require("@wordpress/url"),data_1=require("@wordpress/data"),data_2=require("@woocommerce/data"),classnames_1=__importDefault(require("classnames")),components_1=require("@wordpress/components"),core_data_1=require("@wordpress/core-data"),utils_1=require("../../utils"),edit_product_link_modal_1=require("../../components/edit-product-link-modal"),validation_context_1=require("../../contexts/validation-context");function Edit(){const e=(0,block_editor_1.useBlockProps)(),{editEntityRecord:t,saveEntityRecord:r}=(0,data_1.useDispatch)("core"),[o,n]=(0,element_1.useState)(!1),a=(0,core_data_1.useEntityId)("postType","product"),i=(0,data_1.useSelect)((e=>e("core").getEditedEntityRecord("postType","product",a))),[l,c]=(0,core_data_1.useEntityProp)("postType","product","sku"),[s,_]=(0,core_data_1.useEntityProp)("postType","product","name"),{permalinkPrefix:u,permalinkSuffix:d}=(0,data_1.useSelect)((e=>{const{getPermalinkParts:t}=e(data_2.PRODUCTS_STORE_NAME);if(a){const e=t(a);return{permalinkPrefix:null==e?void 0:e.prefix,permalinkSuffix:null==e?void 0:e.suffix}}return{}})),{ref:m,error:p,validate:f}=(0,validation_context_1.useValidation)("name",(async function(){return s&&s!==utils_1.AUTO_DRAFT_NAME?s.length>120?(0,i18n_1.__)("Please enter a product name shorter than 120 characters.","woocommerce"):void 0:(0,i18n_1.__)("This field is required.","woocommerce")}),[s]),E=null!=p?p:a&&["publish","draft"].includes(i.status)&&u&&(0,element_1.createElement)("span",{className:"woocommerce-product-form__secondary-text product-details-section__product-link"},(0,i18n_1.__)("Product link","woocommerce"),":Â ",(0,element_1.createElement)("a",{href:i.permalink,target:"_blank",rel:"noreferrer"},u,i.slug||(0,url_1.cleanForSlug)(s),d),(0,element_1.createElement)(components_1.Button,{variant:"link",onClick:()=>n(!0)},(0,i18n_1.__)("Edit","woocommerce"))),k=(0,compose_1.useInstanceId)(components_1.BaseControl,"product_name");return(0,element_1.createElement)(element_1.Fragment,null,(0,element_1.createElement)("div",{...e},(0,element_1.createElement)(components_1.BaseControl,{id:k,label:(0,element_1.createInterpolateElement)((0,i18n_1.__)("Name <required />","woocommerce"),{required:(0,element_1.createElement)("span",{className:"woocommerce-product-form__required-input"},(0,i18n_1.__)("*","woocommerce"))}),className:(0,classnames_1.default)({"has-error":p}),help:E},(0,element_1.createElement)(components_1.__experimentalInputControl,{id:k,ref:m,name:"name",placeholder:(0,i18n_1.__)("e.g. 12 oz Coffee Mug","woocommerce"),onChange:_,value:s&&s!==utils_1.AUTO_DRAFT_NAME?s:"",onBlur:()=>{l||p||c((0,url_1.cleanForSlug)(s)),f()}})),o&&(0,element_1.createElement)(edit_product_link_modal_1.EditProductLinkModal,{permalinkPrefix:u||"",permalinkSuffix:d||"",product:i,onCancel:()=>n(!1),onSaved:()=>n(!1),saveHandler:async e=>{const{slug:o,permalink:n}=await r("postType","product",{id:i.id,slug:e});if(o&&n)return t("postType","product",i.id,{slug:o,permalink:n}),{slug:o,permalink:n}}})))}exports.Edit=Edit;